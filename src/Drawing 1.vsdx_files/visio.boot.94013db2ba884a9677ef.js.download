var Microsoft;!function(){"use strict";var t,i,e,s,o={d:function(t,i){for(var e in i)o.o(i,e)&&!o.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},o:function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};o.r(n),o.d(n,{Application:function(){return fs},ApplicationEvents:function(){return Ji},CommandIds:function(){return Ft},DocRebootSupportMode:function(){return ws},EventIds:function(){return ce},createApplication:function(){return gs},createCancellationToken:function(){return Ve}}),(i=t||(t={}))[i.t=0]="msoulscat_ES_EWAJS",i[i.i=1]="msoulscat_ES_EWAJSGrid",i[i.h=6]="msoulscat_ES_EWAJSChart",i[i.l=202]="msoulscat_MSOSP_FileMenuCommands",i[i.u=220]="msoulscat_MSOSP_AddInCommands",i[i.p=225]="msoulscat_MSOSP_OTelJS",i[i.m=227]="msoulscat_MSOSP_OTelJSInWebWoker",i[i.v=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",i[i._=301]="msoulscat_Wac_WordViewer",i[i.A=306]="msoulscat_Wac_BrowserGeneral",i[i.F=320]="msoulscat_Wac_TaskPane",i[i.P=339]="msoulscat_Wac_OneNoteGeneral",i[i.R=340]="msoulscat_Wac_Ribbon",i[i.U=356]="msoulscat_Wac_WacFeedback",i[i.k=379]="msoulscat_Wac_WopiPendingApplication",i[i.O=383]="msoulscat_Wac_Telemetry",i[i.B=391]="msoulscat_Wac_WacCatchUpActivities",i[i.$=394]="msoulscat_Wac_Dictation",i[i.N=395]="msoulscat_Wac_OneNoteSync",i[i.H=700]="msoulscat_Wac_VisioApp",i[i.J=1601]="msoulscat_OneNoteOnline_EditableCache",i[i.j=800]="msoulscat_Wac_PptAnimation",i[i.q=833]="msoulscat_Wac_PptLive",i[i.K=834]="msoulscat_Wac_PptMWeb",i[i.X=835]="msoulscat_Wac_PptGc2General",i[i.Z=836]="msoulscat_Wac_PptGc2GraphicHost",i[i.Y=837]="msoulscat_Wac_PptGc2Operation",i[i.tt=852]="msoulscat_Wac_PptGc2EditCanvas",i[i.it=844]="msoulscat_Wac_PptDataSync",i[i.et=848]="msoulscat_Wac_PptFluidRuntime",i[i.st=815]="msoulscat_Wac_PptShape",i[i.ot=817]="msoulscat_Wac_PptSession",i[i.nt=830]="msoulscat_Wac_PptSlideshow",i[i.rt=822]="msoulscat_Wac_PptView",i[i.ht=846]="msoulscat_Wac_PptVideos",i[i.ct=1303]="msoulscat_Uci_Insights",i[i.dt=2300]="msoulscat_Wac_VersionHistory",i[i.lt=302]="msoulscat_Wac_WordPresence",i[i.ut=3e3]="msoulscat_Wac_OAuth",i[i.wt=3005]="msoulscat_Wac_WordVersionHistory",i[i.ft=3006]="msoulscat_Wac_LivePersonaCard",i[i.gt=3012]="msoulscat_Wac_CatchUpFlyout",i[i.vt=3016]="msoulscat_Wac_WordDesigner",i[i.St=3021]="msoulscat_Wac_ModernFontPicker",i[i.It=3027]="msoulscat_Wac_UnifiedUiHost",i[i.bt=3033]="msoulscat_Wac_EquationTools",i[i._t=1401]="msoulscat_Osf_Latency",i[i.Tt=1402]="msoulscat_Osf_Notification",i[i.Ct=1403]="msoulscat_Osf_Runtime",i[i.At=3041]="msoulscat_Wac_AiMaker",i[i.Et=3043]="msoulscat_Wac_AiRewrite",i[i.Ft=3044]="msoulscat_Wac_AiInsert",i[i.yt=3047]="msoulscat_Wac_AiSummarize",i[i.Vt=3048]="msoulscat_Wac_CopilotCompose",i[i.Pt=3049]="msoulscat_Wac_Skittles",i[i.Rt=3050]="msoulscat_Wac_CopilotChat",i[i.xt=3051]="msoulscat_Wac_Syntex",i[i.Wt=3052]="msoulscat_Wac_WireGraph",i[i.Ut=3053]="msoulscat_Wac_CshCopilot",i[i.Mt=3055]="msoulscat_Wac_CopilotProactiveSummary",i[i.Dt=3056]="msoulscat_Wac_CopilotProactiveShared",i[i.kt=3057]="msoulscat_Wac_CopilotCursor",i[i.Ot=3059]="msoulscat_Wac_WasmGeneral",i[i.Bt=3060]="msoulscat_Wac_WasmTextLayout",i[i.$t=3061]="msoulscat_Wac_WasmSmartArt",i[i.Nt=3062]="msoulscat_Wac_WasmClient",i[i.Ht=3063]="msoulscat_Wac_WasmNative",i[i.Lt=3068]="msoulscat_Wac_UniversalPrint",i[i.Jt=4e3]="msoulscat_AIHub_CreateModuleTelemetry",i[i.Gt=4001]="msoulscat_AIHub_CreateModuleAugloop",i[i.jt=4002]="msoulscat_AIHub_CreateModuleDAS",i[i.zt=4003]="msoulscat_AIHub_CreateModuleConfig",i[i.qt=4004]="msoulscat_AIHub_CreateModuleContext",i[i.Kt=4005]="msoulscat_AIHub_CreateModuleGraph",i[i.Xt=4006]="msoulscat_AIHub_CreateModuleExperiences",i[i.Zt=4007]="msoulscat_AIHub_CreateModuleHttp",i[i.Yt=4008]="msoulscat_AIHub_CreateModuleRouting",i[i.Qt=4009]="msoulscat_AIHub_CreateModuleStorage",i[i.ti=4010]="msoulscat_AIHub_CreateModuleStore",i[i.ii=4011]="msoulscat_AIHub_CreateModuleUI",i[i.ei=4012]="msoulscat_AIHub_CreateModuleSharePoint",i[i.si=4013]="msoulscat_AIHub_CreateModuleLicensing",i[i.oi=4100]="msoulscat_AIHub_CreateModuleUI_Artifacts",i[i.ni=4101]="msoulscat_AIHub_CreateModuleUI_BrandKit",i[i.ri=4102]="msoulscat_AIHub_CreateModuleUI_Forms",i[i.ai=4103]="msoulscat_AIHub_CreateModuleUI_Homepage",i[i.hi=4104]="msoulscat_AIHub_CreateModuleUI_Text",i[i.ci=4105]="msoulscat_AIHub_CreateModuleUI_Video",(s=e||(e={}))[s.Error=10]="Error",s[s.Warning=15]="Warning",s[s.Important=20]="Important",s[s.Info=50]="Info",s[s.Verbose=100]="Verbose",s[s.Spam=200]="Spam";const r=["eurppc"],a="RemoteUls.ashx",h="RemoteTelemetry.ashx";function c(t){return 8===t.toLowerCase().indexOf("ffc")}function d(t){return 8===t.toLowerCase().indexOf("ppc")}function l(t){const i=t.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return i&&i[1]?i[1]:"public"}function u(t){const i=t.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}function p(t,i){const e=t.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!e)throw new Error("Invalid URL");const s=e[2];if(void 0===i)return s;if(i<0)throw new Error("subDomainParts should be at least 1");return s.split(".").slice(-(i+1)).join(".")}function m(t,i,e){e&&(t[i.toLowerCase()]=e)}function w(t,i){t[i.toLowerCase()]=""}function f(t,i){const e=t.toLowerCase(),s=i.toLowerCase();let o=e.indexOf("&"+s+"=");if(-1===o&&(o=e.indexOf("?"+s+"=")),-1===o)return"";const n=o+(i.length+2),r=t.indexOf("&",n);return t.substring(n,-1===r?void 0:r)}function g(t,i,e,s){if(!e)return t;let o=t;const n=o.indexOf("?");let r="&";n===o.length-1||"&"===o.slice(-1)||"&>"===o.slice(-2)?r="":-1===n&&(r="?");const a=i.toLowerCase()+"=",h=new RegExp("\\W"+a,"i").exec(o);if("?"!==r&&h){if(s){const t=h.index+1,i=o.indexOf("&",t);o=o.substring(0,t)+a+e+(-1===i?"":o.substring(i))}return o}return o.concat(r,a,e)}function v(t){const i={},e=t.indexOf("?");return-1===e||e===t.length-1||t.substring(e+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach((t=>{if(t){const e=t.indexOf("=");-1!==e&&e!==t.length-1&&(i[t.substring(0,e).toLowerCase()]=t.substring(e+1))}})),i}function S(t,i){if(!t)return t;let e=t;const s=e.indexOf("?"),o=i.toLowerCase()+"=",n=e.toLowerCase().indexOf(o,s);if(n>=0){const t=e.indexOf("&",n);return e=e.substring(0,n)+(-1===t?"":e.substring(t+1)),"&"===e.slice(-1)&&(e=e.slice(0,-1)),e}return t}function I(t){const i=new RegExp("(c[1-5])h?(-)");return t.replace(i,"$1h$2")}function b(t,i,e){const s=new RegExp("[?&]"+i+"=("+(e||"1")+")\\b","i"),o=t.match(s);return!(!o||e&&o[1]!==e)}function _(t,i){const e=f(t,i);return e?decodeURI(e):e}function T(t){return t?t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0]:""}const C={BUILD_NUMBER:"###VERSION###",BUILD_NUMBER_MINOR:-1};function A(){try{return C.BUILD_NUMBER}catch(t){return C.BUILD_NUMBER}}function E(t){if(t){const i=t.lastIndexOf(".");if(-1!==i)return t.substring(i+1).toLowerCase()}return""}function F(t){if(!t)return"";const i=Object.getOwnPropertyNames(t),e=Object.getOwnPropertyNames(Object.getPrototypeOf(t));return JSON.stringify(t,[...i,...e])}function y(){const t=new Uint8Array(31),i=function(t){const i={crypto:!1,perfNow:!1,exceptions:[]},e=window.crypto||window.msCrypto;if(e){i.crypto=!0;try{return e.getRandomValues(t),i}catch(t){i.exceptions.push(`crypto: ${F(t)}`)}}i.perfNow=!0;for(let e=0;e<t.length;e+=1){try{let t=Math.floor(100*window.performance.now())%10;(t<0||t>9)&&(t=0);for(let i=0;i<t;i+=1)Math.random()}catch(t){i.exceptions.push(`Math.random: ${F(t)}`)}t[e]=Math.floor(16*Math.random())}return i}(t);let e=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(i=>{const s=15&t[e];return e+=1,("x"===i?s:3&s|8).toString(16)})),i]}function V(t,i,e){if(!i)return;const s=window.navigator;if(s&&s.sendBeacon)try{return void s.sendBeacon(i,t)}catch{}!function(t,i,e){const s=new XMLHttpRequest;s.readyState!==XMLHttpRequest.UNSENT&&s.readyState!==XMLHttpRequest.DONE||(s.open("POST",i,e),s.send(t))}(t,i,e)}var P,R;function x(t,i,e){!function(t,i,e,s=!0){const o={type:i.toString(),payloadJson:JSON.stringify(e)};V(JSON.stringify(o),t,s)}(t,P.JSAPI_STATE,{application:i,build:A(),state:e})}!function(t){t.JSAPI_STATE="JSAPI_STATE",t.H_V2="H_V2"}(P||(P={})),function(t){t[t.Trace=0]="Trace",t[t.Assert=1]="Assert"}(R||(R={}));const W=1e3;function U(){return window.performance.now()}function M(){return Math.round(window.performance.now()+window.performance.timeOrigin)}class D{getTimeSpentLogging(){return this.di}addLoggingTime(t){this.di+=t}configure(t){const i=U();if(t.uploadCadenceInMs&&(this.li=t.uploadCadenceInMs),t.uploadTriggerSize&&(this.pi=t.uploadTriggerSize),t.sessionId&&(this.mi=t.sessionId),t.remoteUlsEndpoint){if(!t.sessionId&&this.wi)throw new Error("Remote ULS endpoint is already set");this.wi=this.fi(t.remoteUlsEndpoint),this.gi=M(),this.vi()}this.di+=U()-i}handleTrace(t){const i=U();t.message.length>3072&&(t.message=t.message.substring(0,3059)+"... [Trimmed]"),this.Si.push(t),(this.Si.length>this.pi||t.level===e.Error)&&this.vi(),this.di+=U()-i}getUserSessionId(){return this.mi}constructor(t){this.li=3e4,this.pi=30,this.Ii=0,this.Si=[],this.gi=M(),this.bi=[],this.mi="",this.di=0,this.flushOnClose=()=>{this._i(!1,!1)},this.flush=()=>{this.vi()},this.flushAndSetNewEndpoint=(t,i)=>{const e=this.fi(t);e.localeCompare(this.wi??"",void 0,{sensitivity:"accent"})&&(this.bi.push((()=>{this.wi=e,i&&i()})),this._i(!0,!0))},this.updateEndpointAndFlush=t=>{this.wi=this.fi(t),this._i(!0,!0)},this.fi=t=>t+"?usid="+this.mi+"&officeserverversion="+A(),this.vi=()=>{window.setTimeout((()=>this._i(!0,!0)),0)},this._i=(t,i)=>{const e=U();window.clearTimeout(this.Ti),this.wi&&(this.Si.length>0&&(this.Ii+=1,V(function(t,i,e,s){const o=[],n=t.map((t=>function(t,i,e){const s={};if(s.G=t.tag,s.T=t.timestamp-i,s.M=t.message,s.C=t.category,t.correlationId){let i=e.findIndex((i=>i===t.correlationId));i<0&&(i=e.push(t.correlationId)-1),s.I=i}const o=t.type*W+t.level;return s.D=o,s}(t,s,o))),r=function(t,i,e,s,o){const n={};return n.T=t,n.L=i,n.S=e,n.I=s,o&&o.length>0&&(n.W=o),n.V=1,n}(s,n,i,e,o);return JSON.stringify(r)}(this.Si.splice(0,t?this.pi:this.Si.length),this.mi,this.Ii,this.gi),this.wi,i),this.gi=M()),0===this.Si.length&&this.bi.length>0&&(this.bi.forEach((t=>{"requestIdleCallback"in window?window.requestIdleCallback(t):window.setTimeout(t,0)})),this.bi=[]),t&&(this.Ti=window.setTimeout((()=>{this.vi()}),this.Si.length>this.pi||this.bi.length>0?1e3:this.li)),this.di+=U()-e)},t&&this.configure(t)}}let k,O=[];var B,$;function N(t){const i=new D(t);function s(t,e,s,o){const n=U();if(function(t){return 1===O[t]}(t))return;const r={timestamp:M(),category:e,tag:t,level:s,type:R.Trace,message:o,correlationId:""};i.addLoggingTime(U()-n),i.handleTrace(r)}return{ULS:{Ci:(t,i,e,o)=>{s(t,i,e,o)},shipAssertTag:(t,i,o,n)=>{o&&s(t,i,e.Error,n)},debugAssertTag:(t,i,e,s)=>{throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:i.flush,flushOnClose:i.flushOnClose,setCorrelationId:()=>{}},configure:t=>{i.configure(t)},settingsChangeHandler:t=>{var e,s;e=t.Ai.getValue(B.Ei,""),s=t.Ai.getValue(B.Fi,""),k&&s===k||(O=[],k=s,e&&e.split(",").forEach((t=>{const i=parseInt(t,10);i&&(O[i]=1)}))),i.configure({uploadCadenceInMs:t.Ai.getValue(B.yi,6e4)});const o=t.Ai.getValue(B.Vi,"").toString();""!==o&&i.flushAndSetNewEndpoint(o)},getTimeSpentLogging:()=>i.getTimeSpentLogging(),getUserSessionId:()=>i.getUserSessionId(),flushAndSetNewEndpoint:(t,e)=>{i.flushAndSetNewEndpoint(t,e)},updateEndpointAndFlush:t=>{i.updateEndpointAndFlush(t)}}}!function(t){t.Pi="BootstrapperMaxUlsHeartbeatTime",t.Ri="BootstrapperNoCompleteWarning1Time",t.xi="BootstrapperNoCompleteWarning2Time",t.Wi="BootstrapperNoCompleteWarning3Time",t.Fi="RemoteUlsETag",t.Ei="RemoteUlsSuppressions",t.Ui="BootstrapperSettingsFetchPeriod",t.Mi="timestamp",t.Di="BootstrapperUlsHeartbeatIntervalMs",t.ki="BootstrapperUlsHeartBeatIsEnabled",t.yi="BootstrapperUlsUploadCadenceMs",t.Oi="RequestedCallThrottlingDefaultToViewMinimumValue",t.Vi="BulsEndpointUrl",t.Bi="EnableCommonHostDiagnosticsParams",t.$i="EnableICNForWord",t.Ni="EnableModernEmbedViewForPowerPoint",t.Hi="EnableModernEmbedViewInOneUpForPowerPoint",t.Li="EnableModernEmbedViewForPowerPointGlobalAppUrl",t.Ji="EnableModernReadingViewForPowerPoint",t.Gi="EnableModernViewForPowerPointIPad",t.ji="EnableEarlyFormSubmitMWeb",t.zi="EnableIpadAndTabletRedirection",t.qi="EnableM365IpadRedirection",t.Ki="EnablePassingCustomFontCatalogToViewer",t.Xi="EnableDefaultToModernForPowerPoint",t.Zi="ShouldLogJsApiKpisForWord",t.Yi="WordSwitchToViewInTeamsJsapiV1Enabled",t.Qi="EnableWordSessionRefreshTelemetry",t.te="PowerPointUseEssDCHint",t.ie="PowerPointUseAFDSupportedEssDCHint",t.ee="PowerPointEnableControl24DCsExcludeFromESS",t.se="PowerPointListOfControl24DCsExcludedFromESS",t.oe="ModernEmbedViewBootstrapperFeatureGatesForPowerPoint",t.ne="ModernReadingViewBootstrapperFeatureGatesForPowerPoint",t.re="ModernEmbedViewForPowerPointEnabledPercentage",t.ae="PowerPointESSCookieLookbackThresholdHour",t.he="PowerPointSetESSCookieLookbackExpEnabled",t.ce="ExcelForceViewOnlyInTeamsJsapiV1",t.de="EnableWordSessionRefreshLoggingCleanup",t.le="WordRefreshTelemetryExpirationInDays",t.ue="IsSpoSandboxFixEnabled",t.pe="WordConsumptionViewToEditRedirectIsEnabled",t.me="WordEditorBizchatSideBySideUnifiedReadIsEnabled",t.we="IPadPreviewerExpEnabled",t.fe="MwacWordEditorExperimentExperienceIsEnabled",t.ge="IPadTeamsPreviewerEnabled",t.ve="IPadOutlookPreviewerEnabled",t.Se="IPadOneDrivePreviewerEnabled",t.Ie="IPadM365PreviewerEnabled"}(B||(B={})),function(t){t[t.Firefox=0]="Firefox",t[t.Opera=1]="Opera",t[t.IE=2]="IE",t[t.Edge=3]="Edge",t[t.Chrome=4]="Chrome",t[t.Safari=5]="Safari",t[t.TeamsElectron=6]="TeamsElectron",t[t.AndroidWebView=7]="AndroidWebView",t[t.Unknown=8]="Unknown"}($||($={}));const H=window.navigator,L=H?H.userAgent:void 0;function J(){if(L){if(L.indexOf("Firefox")>-1)return $.Firefox;if(L.indexOf("Opera")>-1||L.indexOf("OPR")>-1)return $.Opera;if(L.indexOf("Trident")>-1)return $.IE;if(L.indexOf("Electron")>-1&&L.indexOf("Teams")>-1)return $.TeamsElectron;if(L.indexOf("Android")>-1&&L.indexOf("wv")>-1)return $.AndroidWebView;if(L.indexOf("Edg")>-1)return $.Edge;if(L.indexOf("Chrome")>-1)return $.Chrome;if(L.indexOf("Safari")>-1)return $.Safari}return $.Unknown}function G(){try{return!!L&&L.indexOf("iPad")>=0||!!L&&L.indexOf("Macintosh")>=0&&K()&&!(L&&L.indexOf("iPhone")>=0)||!!L&&L.indexOf("Android")>=0||K()}catch{return!1}}function j(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}function z(){return J()===$.IE&&!(J()===$.IE&&null!=document.documentMode&&void 0!==document.documentMode&&document.documentMode>=11)}function q(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(t){return!1}}function K(){return!!H&&H.maxTouchPoints>0}function X(t,i){i&&Object.keys(i).forEach((e=>{t[e]=i[e]}))}function Z(i,s){try{if(void 0===window.performance)return void s.ULS.Ci(595948609,t.k,e.Info,"Performance not supported");const o=window.performance.getEntriesByType("resource");if(void 0===o||o.length<=0)return void s.ULS.Ci(595948610,t.k,e.Info,"No resources under performance");const n=new RegExp(i+"(-boot\\.min|(\\.(app|preview))?\\.boot)(\\.[0-9a-f]{20})?\\.js","i");for(let i=o.length-1;i>=0;i-=1){const r=o[i],a=r.name.match(n);if(a){let i=JSON.stringify(r);return i=i.replace(new RegExp(r.name,"g"),a[0]),void s.ULS.Ci(595948616,t.k,e.Info,i)}}s.ULS.Ci(595948484,t.k,e.Info,"Could not find JSAPI resource timing entry")}catch(i){s.ULS.Ci(595948617,t.k,e.Info,`Could not trace the resource timing: ${F(i)}`)}}function Y(t){const i={...t.host,sessionId:t.hostSessionId,domain:location?location.host:void 0};delete i.siteId,delete i.webId,delete i.uiHostTabId;const e={};if(t.wdParams){const i=JSON.parse(JSON.stringify(t.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((t=>{i[t]&&(e[t]=i[t])}));const s=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;e.wdprevioussession&&!s.test(e.wdprevioussession)&&delete e.wdprevioussession,e.wdpreviouscorrelation&&!s.test(e.wdpreviouscorrelation)&&delete e.wdpreviouscorrelation}const s={...t.rebootOverride};delete s.ackExpected,delete s["ui-language"],delete s.wdUserSession,delete s.rebootMode,delete s.documentUrl;const o=t.wopi;return{accessToken:o?{length:o.accessToken.length,expiry:o.expiry}:"N/A",wacToken:o&&o.wacToken?{length:o.wacToken.length}:void 0,bootParams:t.bootParams,build:A(),host:i,intent:t.intent,jsApiVersion:"v2",rebootOverride:s,region:l(t.appBaseUrl),sessionOrigin:t.hostInitDiagnostics?t.hostInitDiagnostics.entryPoint:void 0,sessionContext:t.sessionContext,throttling:t.throttling,ui:t.ui,viewMode:t.viewMode,meeting:t.meeting?{id:t.meeting?.id,isPresenter:t.meeting?.isPresenter}:void 0,wdParams:e}}function Q(){const t={perfNowSupported:!0,browser:$[J()],touchMode:G(),highContrast:j(),windows10x:q()};try{const i=window.navigator,e=i.connection||i.mozConnection||i.webkitConnection;e&&(t.netOnline=i.onLine,t.netDownlink=e.downlink,t.netDownlinkMax=e.downlinkMax,t.netEffectiveType=e.effectiveType,t.netRtt=e.rtt,t.netSaveData=e.saveData,t.netType=e.type),t.deviceMemory=i.deviceMemory,t.logicalProcessors=i.hardwareConcurrency}catch{}return t}var tt,it,et;function st(t=!1,i){return{shouldPreconnect:t=>ot&&(!i||i(t)),preconnect:i=>function(t){const i=document.createElement("link");i.rel="preconnect",i.href=t,i.crossOrigin="anonymous",document.head.appendChild(i)}(t?I(i):i)}}!function(t){t[t.Unknown=0]="Unknown",t[t.Normal=1]="Normal",t[t.Minor=2]="Minor",t[t.Medium=3]="Medium",t[t.Major=4]="Major",t[t.Critical=5]="Critical"}(tt||(tt={})),(et=it||(it={})).be="App_AccessibilityLoopComplete",et._e="Wac_ActionComplete",et.Te="WacInitialize_Ready",et.Ce="Wac_AppFailed",et.Ae="Wac_AppBootState",et.Ee="Wac_AppCompleted",et.Fe="BrowserEvent",et.ye="UI_Close",et.Ve="App_CloseTab",et.Pe="UI_Conversation",et.Re="UI_CopyAndEdit",et.xe="App_CreateNewDocument",et.We="Wac_AppDataSavedStatus",et.Ue="UI_Download",et.Me="UI_PreDownloadFileInClient",et.De="UI_Edit",et.ke="Error",et.Oe="UI_FileEmbed",et.Be="UI_FileProperties",et.$e="File_Rename",et.Ne="File_RenameFailed",et.He="UI_FileVersions",et.Le="StateChanged",et.Je="App_IsFrameTrusted",et.Ge="GetAccessToken",et.je="App_GetAuthToken",et.ze="App_GetCustomAuthConfig",et.qe="App_GetHostKeyValue",et.Ke="App_WopiInfoFromUrl",et.Xe="App_DavUrlFromIds",et.Ze="App_LoadingStatus",et.Ye="App_SwitchMode",et.Qe="App_MoveToFolder",et.ts="UI_OpenInMobileApp",et.es="UI_OpenInBrowser",et.ss="UI_OpenInClient",et.os="PageChanged",et.ns="App_PushCommentContext",et.hs="App_PushState",et.cs="App_DocReboot",et.ds="UI_RedeemForCommenting",et.ls="App_RefreshSessionInfo",et.us="UI_ReplyWithChanges",et.ps="UI_ReportAbuse",et.ws="App_FilePicker",et.fs="UI_SaveStatus",et.gs="WopiSession_Complete_Ack",et.vs="SetOverlayContent",et.Ss="UI_Sharing",et.Is="UI_ShareForm",et.bs="UI_SignIn",et._s="App_StoreHostKeyValue",et.Ts="App_Unloaded",et.Cs="App_UlsLog",et.As="Wac_UnloadingApp",et.Es="App_UpdateBootComplete",et.Fs="PageCount",et.ys="UI_CheckUserAccessAndGrantPermissions",et.Vs="User_Activity",et.Ps="Edit_Notification",et.Rs="UI_Workflow",et.xs="ZoomChanged",et.Ws="CAAEMessage",et.Us="Excel_HostFrameCacheSave",et.Ms="Excel_HostFrameCacheEvict",et.Ds="Excel_RegenerateFileBundle",et.ks="App_SwitchToWacFrame",et.Os="App_SaveSSRData",et.Bs="App_PurgeDataInHostCache",et.$s="App_SaveHostRenderingV2Data",et.Ns="App_SaveHostUtilsData",et.Hs="AcquireOAuthTokenTeams",et.Ls="App_SwitchNotebook",et.Js="FailedBoot_CheckFileInfo",et.Gs="GetTeamsUsers",et.js="SendTeamsUserMention",et.zs="NavigateBackToHost",et.qs="App_GetClientUrlComplete",et.Ks="App_GetWebUrlComplete",et.Xs="App_CopyLinkComplete",et.Zs="App_SendConversationId",et.Ys="CloseTeamsConversation",et.Qs="PageLoaded",et.io="Visio_BRS",et.eo="Visio_SendLicenseInfo",et.so="Visio_Consumption_CLTComplete",et.oo="Visio_SwitchMode_FromViewFrame",et.no="Visio_ModeSwitch_ToHost_Ack",et.ro="Visio_UpdateEditUrl",et.ao="Visio_PageViewLoaded",et.ho="Visio_ActiveAppFrameLoadFailed",et.co="Visio_DisposeBkgFrame",et.do="Visio_ReadyToReceiveDocData",et.lo="Visio_DocReboot_HostNav",et.uo="Visio_SwitchToVisioFrame",et.po="WacAppPerfMetric",et.mo="App_ModifyURLState",et.wo="App_WacTokenAck",et.fo="App_InitEnd",et.vo="App_SplashScreenShown",et.So="App_SetWacFlightValue",et.Io="App_PrintRedirect",et.bo="App_RequestFullScreen",et._o="App_ShowCopilotBottomBar",et.To="UI_ExternalDocumentShare",et.Co="AddNAATrustedOrigins";const ot=!0,nt=["https://augloop.office.com/v2","api://visio.officeapps.live.com/va/00695ed2-3202-4156-8da1-69f60065e255","394866fc-eedb-4f01-8536-3ff84b16be2a","https://officescripting.microsoft.com","https://officescripting-int.microsoft.com","https://nleditor.osi.office.net/nleditor","https://editor.svc.cloud.microsoft/nleditor","e03a13ee-9730-4cae-8525-47559c8cf18a","https://powerquery.microsoft.com","api://app.powerbi.com/00000009-0000-0000-c000-000000000000","https://immersivereader.cloud.microsoft","https://forms.office.com"],rt="AddinTrustedOrigin";class at{async isResourceTrustedForMessage(i){if(!i||!i.Resource)return!1;const s=i.Resource,o=i.AddinTrustId,n=function(t){if(!t)return!1;const i=t.toLowerCase();for(const t of nt)if(t===i||`${t}/`===i)return!0;return!1}(s);if(n||!o)return n;if(this.Ao[o])return ht(s,this.Ao[o]);let r;const a=new Promise((t=>{r=(i,e)=>{o===i&&t(ht(s,e))},this.Eo.push(r)}));let h=-1;const c=new Promise((i=>{h=window.setTimeout((()=>{this.Fo.ULS.Ci(560754786,t.k,e.Warning,`isResourceTrustedForMessage - timeout waiting for addinTrustId: ${o}`),i(!1)}),2e3)})),d=await Promise.race([a,c]);return this.Eo=this.Eo.filter((t=>t!==r)),window.clearTimeout(h),d}dispose(){this.Ao={},this.Eo=[],window.removeEventListener("message",this.yo)}constructor(i){this.Ao={},this.Eo=[],this.yo=i=>{if(i&&i.origin)try{const s=i.data;if("string"==typeof s&&s.includes(rt)){const o=JSON.parse(s),n=o.AddinTrustId;n&&o.MessageId===rt&&(this.Fo.ULS.Ci(560754784,t.k,e.Info,`didReceiveMessage addinTrustId ${n}`),this.Ao[n]=i.origin,this.Eo.forEach((t=>{t(n,i.origin)})))}}catch(i){this.Fo.ULS.Ci(560754785,t.k,e.Error,"AuthTokenTrustValidator didReceiveMessage failed")}},this.Fo=i,window.addEventListener("message",this.yo)}}function ht(t,i){try{if(!t||!i)return!1;const e=33,s=126,o=/[?&#%\\]/;for(let i=0;i<t.length;i+=1){const n=t.charCodeAt(i);if(n<e||n>s)return!1;const r=t.charAt(i);if(o.test(r))return!1}const n="api:",r="https:";let a=t;a.substring(0,n.length).toLowerCase()===n&&(a=`${r}${a.substring(n.length)}`);const h=new URL(a);return h.protocol===r&&i.toLowerCase()===h.origin.toLowerCase()}catch{return!1}}var ct,dt;(dt=ct||(ct={})).AppInitError="AppInitError",dt.ApiDisabledError="ApiDisabledError",dt.CannotLoadFirstPage="CannotLoadFirstPage",dt.InvalidWopiInfo="InvalidWopiInfo",dt.TimeoutWacReady="TimeoutWacReady",dt.WacFailed="WacFailed";class lt{add(t){t&&this.Vo.push(t)}remove(t){if(!t)return;const i=this.Vo.indexOf(t);i>-1&&this.Vo.splice(i,1)}removeAll(){this.Vo=[]}dispatch(t,i){this.Vo.forEach((e=>{try{e(t)}catch(t){i&&i(t)}}))}constructor(){this.Vo=[]}}const ut="Prod",pt="Settings";class mt{updateEnvironment(t){this.Po=(c(t)?"FF":ut)+this.Ro+pt,this.xo()}initializePeriodicFetch(t,i){this.Po=(c(t)?"FF":ut)+this.Ro+pt,this.xo(),this.Wo=t+"AppSettingsHandler.ashx?app="+this.Ro+"&usid="+i+"&build="+A(),this.Uo||(this.Uo=window.setTimeout(this.Mo,3e4))}getValue(t,i){if(this.Do||this.xo(),!this.Do||!this.Do.hasOwnProperty(t))return i;const e=this.Do[t],s=typeof i;if(typeof e===s)return e;if("string"==typeof e){if("number"===s)return parseInt(e,10);if("boolean"===s)return"true"===e}return i}addSettingsChangeListener(t){this.ko.add(t)}removeSettingsChangeListener(t){this.ko.remove(t)}dispose(){this.Uo&&window.clearTimeout(this.Uo),this.Oo&&self.cancelIdleCallback(this.Oo),this.Uo=void 0,this.Oo=void 0,this.Do=void 0,this.ko.removeAll()}constructor(i,s){this.Bo=0,this.xo=()=>{try{if(!window||!window.localStorage)return;const t=window.localStorage.getItem(this.Po);if(!t)return;const i=JSON.parse(t);this.$o(i)}catch(i){this.Fo.ULS.Ci(592836768,t.k,e.Warning,"Failed to get settings from localStorage: "+F(i))}},this.$o=i=>!!this.No(i)&&(this.Do=i,this.ko.dispatch({Ai:this},(i=>{this.Fo.ULS.Ci(592836769,t.k,e.Error,"Settings listener error: "+F(i))})),!0),this.No=i=>{if(i&&"object"==typeof i){if(i.hasOwnProperty(B.Mi)&&!isNaN(i.timestamp))return!0;this.Fo.ULS.Ci(592836770,t.k,e.Error,"Received invalid settings")}return!1},this.Mo=()=>{if(!this.Wo)return;const i=new XMLHttpRequest;window.location.href.indexOf("wdnetcorerouting=true")>-1?i.setRequestHeader("X-NetCoreRouting","true"):window.location.href.indexOf("wdnetcorerouting=false")>-1&&i.setRequestHeader("X-NetCoreRouting","false"),i.open("GET",this.Wo),i.responseType="json",i.timeout=5e3,i.send(),i.onload=()=>{if(200===i.status&&i.response?(this.Ho(i.response),this.Bo=0):(this.Fo.ULS.Ci(592836771,t.k,e.Error,`Fetch settings error. Status: ${i.status}, curErrors: ${this.Bo}`),this.Bo+=1),this.Bo>7)return;let s=this.getValue(B.Ui,3e5);this.Bo>3&&(s+=(this.Bo-3+1)*(s/2)),this.Uo=window.setTimeout(this.Mo,s)}},this.Ho=t=>{"requestIdleCallback"in window?(this.Oo&&self.cancelIdleCallback(this.Oo),this.Oo=window.requestIdleCallback((()=>this.Lo(t)),{timeout:1e4})):window.setTimeout((()=>this.Lo(t)),0)},this.Lo=i=>{if(!this.$o(i)||!window||!window.localStorage)return;const s=JSON.stringify(i);try{window.localStorage.setItem(this.Po,s)}catch(i){this.Fo.ULS.Ci(592836800,t.k,e.Warning,"Failed to set localStorage: "+F(i))}},this.Ro=i,this.Po=ut+i+pt,this.Fo=s,this.ko=new lt,this.xo()}}var wt;function ft(i,s){return{isFeatureEnabled:o=>function(i,s,o){if(s)try{return s(i)}catch(i){o&&o.ULS.Ci(594883024,t.k,e.Error,"IsFeatureEnabled callback error: "+F(i))}}(o,i,s)}}function gt(t,i){const e={};if(Object.keys(wt).forEach((i=>{const s=t.isFeatureEnabled(wt[i]);void 0!==s&&(e[wt[i]]=s?"1":"0")})),i&&i.wdFlights){const t=i.wdFlights.toLowerCase();for(const i of t.split(","))"et-treatment"!==i&&"et-control"!==i||(e[wt.Jo]="et-treatment"===i?"1":"0")}return JSON.stringify(e)}!function(t){t.Jo="EnterpriseTemplates",t.Go="ExcelAdaptiveLayoutDownload",t.jo="ExcelLandingPageOfflineTelemetry",t.zo="ExcelLandingPageObserverRetry",t.qo="H2StaticContent",t.Ko="HashedUrl",t.Xo="ODCShareLinkPreload",t.Zo="OfficeComExcelJsApiV2",t.Yo="OfficeComPptJsApiV2",t.Qo="OfficeComUiHost",t.tn="OfficeComWordJsApiV2",t.en="OfficeHwaUiHost",t.sn="OfficeUnifiedUiHostTeams",t.on="WordViewToUnifiedRead",t.nn="DocAspxMsalLoad",t.rn="WordWebInteractiveReadOnlyMode"}(wt||(wt={}));class vt{dispose(){window.removeEventListener("beforeunload",this.an,{capture:!0}),window.removeEventListener("pagehide",this.hn,{capture:!0}),window.removeEventListener("visibilitychange",this.cn,{capture:!0}),window.removeEventListener("unload",this.dn,{capture:!0})}constructor(t,i){this.an=()=>St(t,"OnBeforeUnload",i),this.hn=()=>St(t,"OnPageHide",i),this.cn=()=>St(t,"VisibilityChange_"+document.visibilityState,i),this.dn=()=>St(t,"OnUnload",i),window.addEventListener("beforeunload",this.an,{capture:!0,once:!0}),window.addEventListener("pagehide",this.hn,{capture:!0}),window.addEventListener("visibilitychange",this.cn,{capture:!0}),window.addEventListener("unload",this.dn,{capture:!0,once:!0})}}function St(i,s,o){i.ULS.Ci(595957843,t.k,e.Important,`Page lifecycle: ${s} fired`+(o?", flushing logger":"")),o&&i.ULS.flush()}class It{}It.logger=N();class bt{constructor(i){this.ln={},this.resetCache=()=>{if(!this.un)return!1;try{return localStorage.removeItem(this.dataSettingsCacheKey),!0}catch(i){return It.logger.ULS.Ci(557114832,t.k,e.Error,`${this.dataSettingsCacheKey}: Failure trying to Delete data in localStorage: ${F(i)}`),!1}},this.setCache=i=>{if(i&&this.un)try{localStorage.setItem(this.dataSettingsCacheKey,JSON.stringify(i))}catch(i){It.logger.ULS.Ci(557114833,t.k,e.Error,`${this.dataSettingsCacheKey}: Error while saving settings in cache: ${F(i)}`)}},this.getIntegerSetting=t=>{const i=this.pn(t);if(null!=i&&"number"==typeof i){const t=i;if(!isNaN(t))return t}return null},this.getBooleanSetting=t=>{const i=this.pn(t);return null!=i&&"boolean"==typeof i?i:null},this.getStringSetting=t=>{const i=this.pn(t);return null!=i&&"string"==typeof i?i:null},this.pn=i=>{if(!this.un)return null;try{if(i in this.ln)return this.ln[i];const t=localStorage.getItem(this.dataSettingsCacheKey);if(null!==t){const e=JSON.parse(t)[i];return this.ln[i]=e,e}}catch(s){It.logger.ULS.Ci(557114834,t.k,e.Error,`${this.dataSettingsCacheKey}: Failure trying to find ${i} setting in localStorage: ${F(s)}`)}return null},this.dataSettingsCacheKey=i,this.un=!1;try{localStorage&&(this.un=!0)}catch(i){It.logger.ULS.Ci(538018719,t.k,e.Warning,`Local storage not supported: ${F(i)}`)}}}class _t extends bt{static get Instance(){return _t.mn||(_t.mn=new _t)}constructor(){super(_t.wn)}}_t.wn="OneNote_hostUtilsSettingsCache";const Tt="Visio";function Ct(t,i){return t+h+(i?"?usid="+i:"")}function At(t,i){return Ct(Et(t),i)}function Et(t){const i=t.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!i)throw new Error("Invalid URL");return i[1]}var Ft,yt,Vt;!function(t){t.blurFocus="blurFocus",t.boot="boot",t.completeCreateNew="completeCreateNew",t.continueAccessibilityLoop="continueAccessibilityLoop",t.createNew="createNew",t.dispose="dispose",t.grabFocus="grabFocus",t.moveToFolder="moveToFolder",t.popState="popState",t.sendChannelId="sendChannelId",t.sendConvId="sendConvId",t.teamsUsersReply="teamsUsersReply",t.teamsUserMentionReply="teamsUserMentionReply",t.backButtonPressed="backButtonPressed",t.searchInvoked="searchInvoked",t.bootInterrupted="bootInterrupted",t.getClientUrl="getClientUrl",t.getWebUrl="getWebUrl",t.rename="rename",t.completeSharedFilePicker="completeSharedFilePicker",t.sendAccessToken="sendAccessToken",t.sendAuthToken="sendAuthToken",t.sendCustomAuthConfig="sendCustomAuthConfig",t.sendEmbeddedViewUrl="sendEmbeddedViewUrl",t.sendFrameTrustResult="sendFrameTrustResult",t.sendHWRTelemetry="sendHWRTelemetry",t.sendSessionInfo="sendSessionInfo",t.sendUserAccessAndPermissions="sendUserAccessAndPermissions",t.sendWopiInfo="sendWopiInfo",t.sendDavUrl="sendDavUrl",t.switchMode="switchMode",t.signalShared="signalShared",t.postWacToken="postWacToken"}(Ft||(Ft={})),(Vt=yt||(yt={})).fn="Ack",Vt.gn="WacInitialize_Ready_Ack",Vt.vn="Wac_BeforeUnloadApp",Vt.Sn="Blur_Focus",Vt.In="Wac_AppFailed_Ack",Vt.bn="Wac_AppCompleted_Ack",Vt._n="WopiStartSession_Complete",Vt.Tn="WopiPendingSession_Complete",Vt.Cn="Host_AccessibilityLoopComplete",Vt.Je="Host_IsFrameTrusted",Vt.An="Grab_Focus",Vt.En="HostCacheDiagnostic",Vt.Fn="Host_KeyValue",Vt.yn="JsApiDiagnostics",Vt.Qe="Host_MoveToFolder",Vt.Vn="PageChanged_Ack",Vt.Pn="App_PopState",Vt.Rn="Host_SendChannelId",Vt.xn="Host_SendConversationId",Vt.Wn="GetTeamsUsers_Reply",Vt.Un="SendTeamsUserMention_Reply",Vt.Mn="Host_BackButtonPressed",Vt.Dn="Host_SearchInvoked",Vt.kn="BootInterrupted",Vt.On="Host_GetClientUrl",Vt.Bn="Host_GetWebUrl",Vt.$n="File_Rename",Vt.ws="Host_FilePicker",Vt.Nn="PostAccessToken",Vt.Hn="Host_SetAuthToken",Vt.Ln="Host_SetCustomAuthConfig",Vt.Jn="App_PushCommentContext",Vt.Gn="CanEmbed",Vt.jn="Host_RefreshSessionInfo",Vt.zn="CheckUserAccessAndGrantPermissions_Result",Vt.qn="Host_WopiInfoFromUrl",Vt.Kn="Host_DavUrlFromIds",Vt.Xn="SetCurrentPage",Vt.Zn="SetZoomLevel",Vt.Yn="WopiPendingSession_Fail",Vt.Qn="SetOverlayContent",Vt.tr="WopiPendingApplicationComplete_Received",Vt.ir="Host_SwitchMode",Vt.er="Host_Unload",Vt.sr="PageCount_Ack",Vt.nr="ZoomChanged_Ack",Vt.rr="Host_ShareUI",Vt.ar="Host_Telemetry",Vt.hr="Visio_ConsumptionCLTComplete_Ack",Vt.cr="Visio_SwitchMode_FromHF_Ack",Vt.dr="Visio_SwitchMode_FromHostFrame",Vt.lr="Visio_FallbackToLegacySwitch",Vt.ur="Visio_DocumentData",Vt.pr="Host_PostWacToken";const Pt=365,Rt=864e5;function xt(t){if(!t)return"";const i=""+document.cookie,e=new RegExp("(?:^|; )"+t+"=([^;]*)"),s=i.match(e);return!s||s.length<2?"":s[1]}function Wt(t,i,e,s=Ut.none,o){const n=t+"="+i;let r="";const a=new Date;a.setTime(a.getTime()+Pt*Rt);let h=new Date;h.setTime(h.getTime()+e*Rt),h>a&&(h=a),h&&(r=";expires="+h.toUTCString());const c=n+r+";SameSite="+Ut[s];return document.cookie=o?c+"; Secure":c,!(!document.cookie||-1===document.cookie.indexOf(n))||s===Ut.none&&Wt(t,i,e,Ut.doNotSet,o)}var Ut;!function(t){t[t.doNotSet=0]="doNotSet",t[t.none=1]="none",t[t.lax=2]="lax",t[t.strict=3]="strict"}(Ut||(Ut={}));const Mt={[Ft.blurFocus]:yt.Sn,[Ft.continueAccessibilityLoop]:yt.Cn,[Ft.grabFocus]:yt.An,[Ft.moveToFolder]:yt.Qe,[Ft.popState]:yt.Pn,[Ft.rename]:yt.$n,[Ft.sendAccessToken]:yt.Nn,[Ft.sendAuthToken]:yt.Hn,[Ft.sendCustomAuthConfig]:yt.Ln,[Ft.sendEmbeddedViewUrl]:yt.Gn,[Ft.sendSessionInfo]:yt.jn,[Ft.sendUserAccessAndPermissions]:yt.zn,[Ft.sendWopiInfo]:yt.qn,[Ft.sendDavUrl]:yt.Kn,[Ft.completeSharedFilePicker]:yt.ws,[Ft.switchMode]:yt.ir,[Ft.signalShared]:yt.rr};class Dt{registerMessagePayloadHandler(t,i){if(this.mr[t])throw new Error("Duplicate registration!");this.mr[t]=i}removeMessageHandler(t){delete this.mr[t]}sendPostMessage(i,s,o){if(!i||!i.contentWindow)return void this.Fo.ULS.Ci(595948308,t.k,e.Info,"Missing target for SendPostMessage");this.Fo.ULS.Ci(596464334,t.k,e.Info,"Sending message: "+s);const n={MessageId:s,SendTime:M(),Values:o};this.wr(i.contentWindow,JSON.stringify(n),this.gr)}activate(t,i){this.vr=t,this.Sr=!!i,this.Ir||(window.addEventListener("message",this.br,!1),this.Ir=!0)}postMessageForCommand(i,s,o){const n=Mt[s];n?(this.Fo.ULS.Ci(595702598,t.k,e.Info,`Sending message ${n} for command ${s}`),this.sendPostMessage(i,n,o)):this.Fo.ULS.Ci(595702599,t.k,e.Warning,`No mapping for command ${s}`)}dispose(){this.mr={},this.Ir&&(window.removeEventListener("message",this.br,!1),this.Ir=!1)}constructor(i,s){if(this.Ir=!1,this.mr={},this.gr="",this._r="",this.Sr=!1,this.Tr=!1,this.Cr=!1,this.Ar=!1,this.Er=[],this.Fr=!0,this.yr=(i,s,o)=>{if(!i)return void this.Fo.ULS.Ci(595736136,t.k,e.Info,"Missing target to send Ack back");const n={MessageId:yt.fn,CorrelationId:o,SendTime:M()};this.Fo.ULS.Ci(595732176,t.k,e.Info,"Sending Ack back"),i.postMessage(JSON.stringify(n),s)},this.br=i=>{let s,o=!1,n=!0,r="",a=!1;if(this.vr&&this.vr.contentWindow&&(o=!0,n=i.source===this.vr.contentWindow),i.origin&&(r=p(i.origin,2).toLowerCase(),a=r===this._r,!a&&this.Vr&&(r=p(i.origin).toLowerCase(),a=this.Vr.includes(r))),!this.Tr&&(!this.Cr||a&&n)||this.Fo.ULS.Ci(595730526,t.k,e.Info,`Window is available: ${o}, window is valid: ${n}, origin is valid: ${a}, expected origin: ${this._r}, actual origin: ${r}`),!a||this.Sr&&!n)return;try{s=JSON.parse(i.data)}catch(i){return void this.Fo.ULS.Ci(596464282,t.k,e.Info,`Failed to parse event data: ${F(i)}.`)}const h=s.MessageId;if(!h)return void((this.Tr||this.Cr)&&this.Fo.ULS.Ci(595730520,t.k,e.Info,"Could not find message id"));if(this.Fo.ULS.Ci(595714715,t.k,e.Info,`Received messageId: ${h}, correlation: ${s.CorrelationId}`),h!==it.Ee&&h!==it.Ze||this.Pr(i.origin),this.Ar&&h===it.po)return window._pageTimings=window._pageTimings??{},void(window._pageTimings[s.Values.name]=s.Values.time);s.Values&&s.Values.ackExpected&&this.yr(i.source,i.origin,s.CorrelationId);const c=this.mr[h];if(!c)return this.Fo.ULS.Ci(596464289,t.k,e.Info,`No handler found for message id: ${h}`),void(this.Fr&&h===it.je&&(this.Er.push(s),this.Fo.ULS.Ci(543207888,t.k,e.Info,`Kept for later process: ${h}`)));this.Fo.ULS.Ci(596464288,t.k,e.Info,`Processing message: ${h}`),h===it.Ss&&(s.Values={...s.Values||{},sendTimeAsClickTime:s.SendTime});try{c(s.Values||{})}catch(i){this.Fo.ULS.Ci(593773704,t.k,e.Error,`Handler error: ${F(i)}`)}this.Fr&&h===it.Ee&&this.Rr()},this.Rr=()=>{this.Fr=!1,this.Er.forEach((i=>{const s=i.MessageId,o=this.mr[s];if(o){this.Fo.ULS.Ci(543207890,t.k,e.Info,`Processing message after boot complete: ${s}`);try{o(i.Values||{})}catch(i){this.Fo.ULS.Ci(543207891,t.k,e.Error,`Handler error: ${F(i)}`)}}else this.Fo.ULS.Ci(543207889,t.k,e.Info,`No handler found after boot complete: ${s}`)})),this.Er=[]},this.wr=(t,i,e)=>{t.postMessage(i,e)},this.Pr=i=>{const s=i.toLowerCase();this.gr&&this.gr!==s&&this.Fo.ULS.Ci(596128131,t.k,e.Warning,`Updating origin: [${T(this.gr)}]->[${T(s)}]`),this.gr=s,this._r=p(s,2),this.Tr=c(s),this.Cr=d(s)},!i)throw new Error("Missing origin for PostMessageHandler");this.Tr=c(i),this.Cr=d(i),this.Fo=s,this.Pr(i),this.Ar=!!window.location?.search?.match(/wdpa=1/gi)||"1"===xt("EnableMetricLogging")}}function kt(i,s,o,n,r,a){const h=M();n.ULS.Ci(507774684,t.k,e.Important,"postWacToken flow initiated");const c=()=>{a&&a.flush&&a.flush()};r?r.then((r=>{const d=()=>o.sendPostMessage(r,yt.pr,{wacToken:i,postWacTokenStart:s});d();const l=window.setInterval(d,100);o.registerMessagePayloadHandler(it.wo,(i=>{n.ULS.Ci(507597019,t.k,e.Info,`postWacToken flow completed in ${M()-h} ms`),window.clearInterval(l),window.clearTimeout(u),a&&(a.PostWacTokenResult="success",a.PostWacTokenEndTime=M(),i&&void 0!==i.TokenAlreadySet&&(a.TokenAlreadySet=i.TokenAlreadySet),c())}));const u=window.setTimeout((()=>{n.ULS.Ci(507597018,t.k,e.Warning,"postWacToken flow timed out after 60000 ms"),window.clearInterval(l),a&&(a.PostWacTokenResult="timeout",a.PostWacTokenEndTime=M(),c())}),6e4)})).catch((i=>{n.ULS.Ci(507873094,t.k,e.Warning,`This should never reject, error: ${F(i)}`),a&&(a.PostWacTokenResult="Unexpected JSAPI V1 error",a.PostWacTokenEndTime=M(),c())})):(n.ULS.Ci(507846862,t.k,e.Warning,"`Promise` does not exist natively for this browser."),a&&(a.PostWacTokenResult="JSAPI V1 error: Promise not supported in browser",a.PostWacTokenEndTime=M(),c()))}class Ot{static sendXmlHttpRequest(i,s,o,n,r,a,h,c=!1){if(!i)throw new TypeError("method");if(!s)throw new TypeError("requestUrl");const d=M();if("GET"!==i)throw Error("Not Implemented");{const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(4===l.readyState)if(200===l.status){const i=M()-d;h.ULS.Ci(595985034,t.H,e.Info,`Success: ${a}, time spent in getting XHR response: ${i}(ms)`),n&&n(l.responseText)}else h.ULS.Ci(595985035,t.H,e.Error,`Failed request: ${a} with status code: ${l.status.toString()}`),r&&r();c&&2===l.readyState&&l.abort()},l.open(i,s,o),l.send()}}}const Bt="wdreloadsessionid",$t="wdreloadcount",Nt=12e4,Ht="VisioView",Lt="ConsumptionView",Jt="EditView",Gt="edit",jt="view",zt="action",qt="wdToastUser",Kt="wdToastForUnsupported",Xt="wdActivePageId",Zt="wdPreviousSessionDct",Yt="wdPageScale",Qt="wdPageCenterX",ti="wdPageCenterY",ii="enableToolbarInTeams",ei="wdIsModeSwitch",si="backgroundsession",oi="hostDuration",ni="bootStrapperStartToVisioFrameCreateDuration",ri="fastViewDuration",ai="visioFrameToAppCompleteDuration",hi="bootPerf",ci="constGuid",di=15e3,li=3,ui=1e3,pi=10,mi="wdvsdedit";class wi{}wi.HeaderHeight=50,wi.ToolbarHeightConsumption=40,wi.ToolbarLowerHeightEdit=46,wi.ToolbarUpperHeightEdit=26,wi.StatusbarHeight=50,wi.StatusbarBorderTop=1,wi.ProgressImageHeight=4,wi.FishbowlBorderTop=1,wi.FishbowlMarginInches=.4,wi.RibbonHeightConsumption=wi.HeaderHeight+wi.ToolbarHeightConsumption,wi.RibbonHeightEdit=wi.HeaderHeight+wi.ToolbarLowerHeightEdit+wi.ToolbarUpperHeightEdit,wi.RibbonHeightNoChrome=wi.ToolbarLowerHeightEdit+wi.ToolbarUpperHeightEdit,wi.ShapePanelBorderWidth=1,wi.ShapePanelWidthWithoutBorder=312,wi.ShapePanelWidthWithBorder=wi.ShapePanelWidthWithoutBorder+2*wi.ShapePanelBorderWidth;class fi{}var gi,vi,Si,Ii;fi.FastViewImage="fpd.png",fi.FastViewJson="fv.json",fi.docInfoNormal="di2.json",fi.docInfoHighDpi="di4.json",function(t){t[t.INVALID=0]="INVALID",t[t.VIEW=1]="VIEW",t[t.EMBED_VIEW=2]="EMBED_VIEW",t[t.INTERACTIVE_PREVIEW=3]="INTERACTIVE_PREVIEW",t[t.EDIT=4]="EDIT",t[t.EDIT_NEW=5]="EDIT_NEW"}(gi||(gi={})),function(t){t.BOOTSTART="BOOTSTART",t.BACKGROUND_MODESWITCH_BOOTSTART="BACKGROUND_MODESWITCH_BOOTSTART",t.BOOTSUCCESS="BOOTSUCCESS",t.BOOTFAILED="BOOTFAILED",t.BOOTEXCEPTION="BOOTEXCEPTION",t.BOOTTIMEOUT="BOOTTIMEOUT"}(vi||(vi={})),function(t){t.JSAPIV2="JSAPIV2"}(Si||(Si={})),function(t){t[t.Fastfood=0]="Fastfood",t[t.MSITandFastfood=1]="MSITandFastfood",t[t.AllRings=2]="AllRings",t[t.None=3]="None"}(Ii||(Ii={}));class bi{static initialize(i,s){bi.Wr=i,bi.Fo=s,void 0===bi.Wr&&bi.Fo&&bi.Fo.ULS.Ci(592975122,t.H,e.Warning,"Environment is undefined")}static getIntegerBRSValue(t,i){let e=bi.Ur[t];return e&&!isNaN(parseInt(e,10))?parseInt(e,10):window.localStorage?(e=localStorage.getItem(t),e&&!isNaN(parseInt(e,10))?(bi.Ur[t]=e,parseInt(e,10)):i):i}static getBRSValue(i,s=!1){try{const o=bi.Ur[i];if(o)return"true"===o.toLowerCase();if(!window.localStorage)return!1;let n=localStorage.getItem(i);if(n)return bi.Ur[i]=n,s&&localStorage.removeItem(i),"true"===n.toLowerCase();if(n="false",bi.Mr.has(i))switch(bi.Mr.get(i)){case Ii.Fastfood:this.Wr===Qi.Fastfood&&(n="true");break;case Ii.MSITandFastfood:this.Wr!==Qi.Fastfood&&this.Wr!==Qi.MSIT||(n="true");break;case Ii.AllRings:n="true";break;default:n="false",bi.Fo&&bi.Fo.ULS.Ci(592975123,t.H,e.Warning,i+" set to false due EnabledEnvironment=None")}return bi.Ur[i]=n,"true"===n.toLowerCase()}catch(t){return!1}}static dispose(){bi.Ur={}}}bi.fromWacVisioFrameBRS="Visio_BRS",bi.instantCreateNewLocalStorageKey="BRS_IsInstantCreateNewEnabled",bi.backgroundEditSessionEnabledKey="BRS_IsUnifiedBackgroundEditAppEnabled",bi.hostCacheForEmbedViewEnabledBRSKey="BRS_HostCacheForEmbedViewEnabled",bi.InstantForAllTemplatesEnabledBRSKey="BRS_InstantForAllTemplatesEnabled",bi.AppShellPrebootEnabledBRSKey="BRS_AppShellPrebootEnabled",bi.FastViewForMRUFixEnabledBRSKey="BRS_FastViewForMRUFixEnabled",bi.ReloadOnScriptFailMaxLimitBRSKey="BRS_ReloadOnScriptFailMaxLimit",bi.CoCommentingAcrossViewAndEditEnabled="BRS_CoCommentingAcrossViewAndEditEnabled",bi.WOPITokenRefreshIsEnabledForViewer="BRS_WOPITokenRefreshIsEnabledForViewer",bi.IsToastUserFixEnabledBRSKey="BRS_IsToastUserFixEnabled",bi.IsContextAppRefreshFixEnabledBRSKey="BRS_IsContextAppRefreshFixEnabled",bi.IsAtMentionsEnabled="BRS_IsAtMentionsEnabled",bi.IsFormulaeSerializationRollbackEnabled="BRS_IsFormulaeSerializationRollbackEnabled",bi.IsFastViewCacheInTeamsDisabled="BRS_IsFastViewCacheInTeamsDisabled",bi.IsSaveAndCloseRequestInvokedInTeamsEnabled="BRS_IsSaveAndCloseRequestInvokedInTeamsEnabled",bi.IsTeamsBackgroundFrameFixEnabled="BRS_IsTeamsBackgroundFrameFixEnabled",bi.TypeScriptLocalStorageEnabled="BRS_TypeScriptLocalStorageEnabled",bi.JsapiV1DiagnosticFixEnabled="BRS_JsapiV1DiagnosticFixEnabled",bi.DTEEnabledBRSKey="BRS_DTEEnabled",bi.DTEEnabledForPlan0BRSKey="BRS_DTEEnabledForPlan0",bi.DTESharingFixEnabledBRSKey="BRS_DTESharingFixEnabled",bi.DTESafariFixEnabledBRSKey="BRS_DTESafariFixEnabled",bi.DisableDTEForUnsupportedFileTypesEnabledBRSKey="BRS_DisableDTEForUnsupportedFileTypesEnabled",bi.IsLongPoleInfraEnabled="BRS_IsLongPoleInfraEnabled",bi.Fluent2StyleIsEnabled="BRS_Fluent2StyleIsEnabled",bi.VisioWebVsdEditEnabled="BRS_VisioWebVsdEditEnabled",bi.IsInfiniteCanvasEnabled="BRS_IsInfiniteCanvasEnabled",bi.IsInfiniteCanvasPLTFixEnabled="BRS_IsInfiniteCanvasPLTFixEnabled",bi.Wr=void 0,bi.Fo=void 0,bi.Ur={},bi.Mr=new Map([[bi.instantCreateNewLocalStorageKey,Ii.AllRings],[bi.backgroundEditSessionEnabledKey,Ii.AllRings],[bi.InstantForAllTemplatesEnabledBRSKey,Ii.Fastfood],[bi.IsToastUserFixEnabledBRSKey,Ii.AllRings],[bi.IsContextAppRefreshFixEnabledBRSKey,Ii.Fastfood],[bi.IsAtMentionsEnabled,Ii.AllRings],[bi.JsapiV1DiagnosticFixEnabled,Ii.AllRings],[bi.Fluent2StyleIsEnabled,Ii.Fastfood]]),bi.handleVisioBRS=(i,s)=>{if(window.localStorage&&i){const o=!!i.IsInstantCreateNewEnabled;localStorage.setItem(bi.instantCreateNewLocalStorageKey,o.toString());const n=!!i.IsUnifiedBackgroundEditAppEnabled;localStorage.setItem(bi.backgroundEditSessionEnabledKey,n.toString());const r=!!i.IsToastUserFixEnabled;localStorage.setItem(bi.IsToastUserFixEnabledBRSKey,r.toString());const a=!!i.IsContextAppRefreshFixEnabled;localStorage.setItem(bi.IsContextAppRefreshFixEnabledBRSKey,a.toString());const h=!!i.HostCacheForEmbedViewEnabled;localStorage.setItem(bi.hostCacheForEmbedViewEnabledBRSKey,h.toString());const c=!!i.InstantForAllTemplatesEnabled;localStorage.setItem(bi.InstantForAllTemplatesEnabledBRSKey,c.toString());const d=!!i.AppShellPrebootEnabled;localStorage.setItem(bi.AppShellPrebootEnabledBRSKey,d.toString());const l=i.VisioReloadOnScriptFailMaxLimit?i.VisioReloadOnScriptFailMaxLimit:0;localStorage.setItem(bi.ReloadOnScriptFailMaxLimitBRSKey,l.toString());const u=!!i.CoCommentingAcrossViewAndEditEnabled;localStorage.setItem(bi.CoCommentingAcrossViewAndEditEnabled,u.toString());const p=!!i.DTEEnabled;localStorage.setItem(bi.DTEEnabledBRSKey,p.toString());const m=!!i.DTEEnabledForPlan0;localStorage.setItem(bi.DTEEnabledForPlan0BRSKey,m.toString());const w=!!i.DTESafariFixEnabled;localStorage.setItem(bi.DTESafariFixEnabledBRSKey,w.toString());const f=!!i.DisableDTEForUnsupportedFileTypesEnabled;localStorage.setItem(bi.DisableDTEForUnsupportedFileTypesEnabledBRSKey,f.toString());const g=!!i.DTESharingFixEnabled;localStorage.setItem(bi.DTESharingFixEnabledBRSKey,g.toString());const v=!!i.WOPITokenRefreshIsEnabledForViewer;localStorage.setItem(bi.WOPITokenRefreshIsEnabledForViewer,v.toString());const S=!!i.IsAtMentionsEnabled;localStorage.setItem(bi.IsAtMentionsEnabled,S.toString());const I=!!i.IsFastViewCacheInTeamsDisabled;localStorage.setItem(bi.IsFastViewCacheInTeamsDisabled,I.toString());const b=!!i.IsSaveAndCloseRequestInvokedInTeamsEnabled;localStorage.setItem(bi.IsSaveAndCloseRequestInvokedInTeamsEnabled,b.toString());const _=!!i.IsTeamsBackgroundFrameFixEnabled;localStorage.setItem(bi.IsTeamsBackgroundFrameFixEnabled,_.toString());const T=!!i.IsFormulaeSerializationRollbackEnabled;localStorage.setItem(bi.IsFormulaeSerializationRollbackEnabled,T.toString());const C=!!i.TypeScriptLocalStorageEnabled;localStorage.setItem(bi.TypeScriptLocalStorageEnabled,C.toString());const A=!!i.JsapiV1DiagnosticFixEnabled;localStorage.setItem(bi.JsapiV1DiagnosticFixEnabled,A.toString());const E=!!i.IsLongPoleInfraEnabled;localStorage.setItem(bi.IsLongPoleInfraEnabled,E.toString());const F=!!i.Fluent2StyleIsEnabled;localStorage.setItem(bi.Fluent2StyleIsEnabled,F.toString());const y=!!i.VisioWebVsdEditEnabled;localStorage.setItem(bi.VisioWebVsdEditEnabled,y.toString());const V=!!i.IsInfiniteCanvasEnabled;localStorage.setItem(bi.IsInfiniteCanvasEnabled,V.toString());const P=!!i.IsInfiniteCanvasPLTFixEnabled;localStorage.setItem(bi.IsInfiniteCanvasPLTFixEnabled,P.toString()),s.ULS.Ci(595691654,t.H,e.Info,`Received BRS settings from visio frame and storing it in local storage. BRS values:${i}`)}else s.ULS.Ci(595691671,t.H,e.Info,"Received BRS settings from visio frame but local storage is not supported or values are null.")};const _i="/v/";function Ti(t){const i=t.toLocaleLowerCase();return i.indexOf("visioview=consumptionview&embed=1")>=0?gi.EMBED_VIEW:i.indexOf("visioview=consumptionview&interactivepreview=1")>=0?gi.INTERACTIVE_PREVIEW:i.indexOf("visioview=consumptionview")>=0?gi.VIEW:i.indexOf("visioview=editview&new=1")>=0?gi.EDIT_NEW:i.indexOf("visioview=editview")>=0?gi.EDIT:gi.INVALID}function Ci(t){return b(t,si,"1")}function Ai(t){return t.toLocaleLowerCase().indexOf("embed=1")>=0}function Ei(t){return t.toLocaleLowerCase().indexOf("interactivepreview=1")>=0}function Fi(t){return(bi.IsInfiniteCanvasPLTFixEnabled||bi.getBRSValue(bi.IsInfiniteCanvasEnabled))&&(t===gi.EDIT||t===gi.EDIT_NEW)}function yi(t){t&&history.replaceState({},"",t)}function Vi(t,i){return!!(t.sessionInformation&&t.sessionInformation.WdParams&&t.sessionInformation.WdParams[i])}function Pi(t,i){return t.sessionInformation&&t.sessionInformation.WdParams&&t.sessionInformation.WdParams[i]?t.sessionInformation.WdParams[i]:null}function Ri(t,i,e){const s=document.createElement("canvas");if(!s.getContext||!s.getContext("2d"))return"";s.width=i,s.height=e;const o=s.getContext("2d");return null==o?"":(o.drawImage(t,0,0),s.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,""))}function xi(){return performance.timing?performance.timing.navigationStart:0}function Wi(){return performance.navigation?performance.navigation.redirectCount:0}function Ui(){let t=window.location.href;t=S(t,Bt),t=S(t,$t),bi.getBRSValue(bi.WOPITokenRefreshIsEnabledForViewer)&&t&&(t=S(t,qt)),bi.getBRSValue(bi.DTEEnabledBRSKey)&&t&&(t=S(t,Kt),t=S(t,Zt)),bi.getBRSValue(bi.VisioWebVsdEditEnabled)&&(t=S(t,mi)),yi(t)}class Mi{static Create(t,i,e,s){if(Mi.Dr(t,i,e)){const o=t+"_"+i,n=Mi.getHashCode(i),r=Mi.getHashCode(e);Mi.mn=new Mi(n,r,o,s)}return Mi.mn}static dispose(){Mi.mn=null}SaveDocument(i,s){try{if(!s||s.length<=0||!i||i.length<=0)return this.Fo.ULS.Ci(595903506,t.H,e.Warning,"Unexpected data provided to save document in cache. Removing the item."),void localStorage.removeItem(this.kr);const o=M(),n={ImageData:s,DocView:i,DocVersion:this.Or},r=JSON.stringify(n);this.encrypt(r,this.Br,this.$r,this.Nr,this.Hr).then((i=>{try{i.DocVersion=this.Or,i.LastAccessTime=M(),localStorage.setItem(this.kr,JSON.stringify(i));const s=M();this.Fo.ULS.Ci(595903646,t.H,e.Info,"[VO_Perf] Save Document Cache Time Taken: "+(s-o))}catch(i){this.Fo.ULS.Ci(595910981,t.H,e.Warning,`Failure trying to save data in localStorage: ${F(i)}`)}}),(i=>{this.Fo.ULS.Ci(595907478,t.H,e.Warning,`Failure to encrypt: ${F(i)}`)}))}catch(i){this.Fo.ULS.Ci(595907479,t.H,e.Warning,`Failure to SaveDocument: ${F(i)}`)}}DeleteDocument(){try{localStorage.removeItem(this.kr)}catch(i){this.Fo.ULS.Ci(595904288,t.H,e.Warning,`Failure to DeleteDocument: ${F(i)}`)}}IsCacheAvailable(){return null!=this.Lr}static EvictStaleCache(i,s,o){try{if(!window.localStorage)return void o.ULS.Ci(595903507,t.H,e.Info,"localStorage is not supported by Browser. Skipping Eviction.");const n=M(),r=[];for(let t=0;t<localStorage.length;t+=1){const i=localStorage.key(t);if(i.substring(0,this.Jr.length)===this.Jr){const t=localStorage.getItem(i);if(t){const e=JSON.parse(t);if(e){const s=e.LastAccessTime;s?r.push({key:i,lastAccessTime:s,data:t}):localStorage.removeItem(i)}else localStorage.removeItem(i)}else localStorage.removeItem(i)}}r.sort(((t,i)=>i.lastAccessTime-t.lastAccessTime));const a=[];let h=0,c=0;for(let t=0;t<r.length;t+=1)h+=2*r[t].data.length,h>i&&M()-r[t].lastAccessTime>s?(localStorage.removeItem(r[t].key),c+=1,h-=2*r[t].data.length):a.push(r[t]);a.sort(((t,i)=>t.lastAccessTime-i.lastAccessTime)),h=0;let d=0;for(let t=0;t<a.length;t+=1)h+=2*a[t].data.length,h>i&&(localStorage.removeItem(a[t].key),d+=1,h-=2*a[t].data.length);const l=M();o.ULS.Ci(595903508,t.H,e.Info,`[VO_Perf] Evict Stale Cache Time Taken: ${l-n}, Ist iteration evicted items: ${c}, 2nd iteration evicted items: ${d}`)}catch(i){o.ULS.Ci(595904090,t.H,e.Warning,`Failure to Evict Stale Cache: ${F(i)}`)}}GetDocVersion(){return this.IsCacheAvailable()?this.Or:""}DecryptAndValidate(i,s){try{const o=M();this.decrypt(this.Lr,this.Br,this.$r,this.Nr).then((n=>{try{let r;r=JSON.parse(n);const a=M();this.Fo.ULS.Ci(595903648,t.H,e.Info,"[VO_Perf] Decrypt and validate cache Time Taken: "+(a-o)),r.DocVersion===this.Or?i(r.DocView,r.ImageData):(this.Fo.ULS.Ci(595907480,t.H,e.Warning,"Document version unexpected mismatch."),s())}catch(i){this.Fo.ULS.Ci(595907481,t.H,e.Warning,`Failure to deserialize the decrypted text: ${F(i)}`),s()}}),(i=>{this.Fo.ULS.Ci(595907482,t.H,e.Warning,`Failure to decrypt: ${F(i)}`),s()}))}catch(i){this.Fo.ULS.Ci(595907483,t.H,e.Warning,`Failure to DecryptAndValidate: ${F(i)}`),s()}}loadCache(){try{const t=localStorage.getItem(this.kr);if(t){let i;i=JSON.parse(t),i.DocVersion===this.Or&&(this.Lr=i)}}catch(i){this.Fo.ULS.Ci(595910982,t.H,e.Warning,`Failure trying to load data from localStorage: ${i}`)}}encode64(t){return btoa(new Uint8Array(t).reduce(((t,i)=>t+String.fromCharCode(i)),""))}decode64(t){const i=window.atob(t),e=i.length,s=new Uint8Array(new ArrayBuffer(e));for(let t=0;t<e;t+=1)s[t]=i.charCodeAt(t);return s}async genEncryptionKey(t,i,e){const s={name:"PBKDF2",hash:"SHA-256",salt:(new TextEncoder).encode("VisioBrowserCacheSalt"),iterations:1e3},o={name:i,length:e},n=(new TextEncoder).encode(t),r=await crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey(s,r,o,!1,["encrypt","decrypt"])}async encrypt(t,i,e,s,o){const n={name:e,length:s,iv:crypto.getRandomValues(new Uint8Array(o))},r=await this.genEncryptionKey(i,e,s);return{DocumentData:this.encode64(await crypto.subtle.encrypt(n,r,(new TextEncoder).encode(t))),DocVersion:void 0,DataHash:void 0,IV:n.iv,LastAccessTime:void 0}}async decrypt(t,i,e,s){const o={name:e,length:s,iv:new Uint8Array(this.Hr)};for(let i=0;i<this.Hr;i+=1)o.iv[i]=t.IV[i];const n=await this.genEncryptionKey(i,e,s),r=await crypto.subtle.decrypt(o,n,this.decode64(t.DocumentData));return(new TextDecoder).decode(r)}static getHashCode(t){let i=0;const e=t.length;let s=0;if(e>0)for(;s<e;)i=(i<<5)-i+t.charCodeAt(s)|0,s+=1;return i}constructor(t,i,e,s){this.$r="AES-GCM",this.Nr=256,this.Hr=12,this.Lr=null,this.kr=Mi.Jr+t,this.Or=i,this.Br=e,this.Fo=s,this.loadCache()}}var Di;function ki(t,i){J()===$.Safari?t.style.display=i?"none":"block":t.style.visibility=i?"hidden":"visible"}function Oi(i){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(s){return i&&i.ULS.Ci(591525084,t.k,e.Info,`Trust check error: ${F(s)}`),!1}}function Bi(t){const i=window.navigator;if(i&&i.virtualKeyboard&&void 0!==i.virtualKeyboard.overlaysContent&&window===top)return i.virtualKeyboard.overlaysContent=t}Mi.cachedDocumentVersionData="cacheDocVersion",Mi.documentSaveIdleTimeInMs=4e3,Mi.cacheEvictIdleTimeInMs=8e3,Mi.maxStorageQuotaSettingName="BrowserCacheMaxQuotaInMB",Mi.minEvictTimePeriodSettingName="BrowserCacheMinEvictTimePeriodInDays",Mi.Jr="VisioCachedView_",Mi.mn=null,Mi.Dr=(t,i,e)=>{if(null!=Mi.mn&&t&&e&&i){const s=t+"_"+i,o=Mi.getHashCode(e);if(Mi.mn.Br===s&&Mi.mn.Or===o)return!1}return!!(window.crypto&&crypto.subtle&&window.localStorage)&&"TextEncoder"in window&&!!e&&!!i&&!!t&&e.length>0&&t.length>0&&i.length>0},function(t){t.Gr="access_token",t.jr="access_token_ttl",t.zr="wac_token",t.qr="bundleSrc",t.Kr="bundleStaleness",t.Xr="DocID",t.Zr="SiteID",t.Yr="WebID",t.Qr="ETag",t.ta="feature_status",t.ia="fileExtension",t.ea="fileGetUrl",t.sa="customFontCatalogUrl",t.oa="fileName",t.na="fileSize",t.ra="forceSLR",t.aa="frameHeightPx",t.ha="frameWidthtPx",t.ca="highContrast",t.da="highDpi",t.la="host_diagnostics",t.ua="hostName",t.pa="huictrls",t.ma="owner_id",t.wa="sc",t.fa="softBlockedBrowser",t.ga="templateUrl",t.va="touchMode",t.Sa="user_id",t.Ia="hfck",t.ba="hfcv",t._a="timeZoneId",t.Ta="darkCssMedia",t.Ca="forcedColors",t.Aa="prefersContrast",t.Ea="caae",t.Fa="meetingId",t.ya="meetingTitle",t.Va="meetingType",t.Pa="scheduledStartTime",t.Ra="scheduledEndTime",t.xa="isPresenter",t.Wa="meetingOrganizerId",t.Ua="meetingJoinUrl",t.Ma="isMeetingTeamsRoom",t.Da="jsapibuild",t.ka="owlver",t.Oa="owlro",t.Ba="caaemode",t.$a="traceparent",t.Na="tracestate",t.Ha="supports_zipit",t.La="sipcn",t.Ja="devcs",t.Ga="dceit",t.ja="frameInnerHeightPx",t.za="frameInnerWidthPx"}(Di||(Di={}));const $i=(t,i,e,s,o)=>t!==it.vs?Promise.reject("Wrong flow"):new Promise((t=>{Bi(i.overlayContent),e.container&&e.container.postMessage(yt.Qn,void 0),t({completion:"success"})}));let Ni=!1,Hi=!1;function Li(i){if(!Ni)try{Ni=!0,Hi=!1,function(t){t.innerApplicationFrame&&(t.innerApplicationFrame.src="about:blank",window.setTimeout((()=>{t.innerApplicationFrame&&t.innerApplicationFrame.parentElement&&t.innerApplicationFrame.parentElement.removeChild(t.innerApplicationFrame),t.onFrameRemoved&&t.onFrameRemoved()}),0))}(i),function(i){const s={disposeStartTime:i.disposeStartTime,disposeEndTime:M(),forceAppUnload:i.forceAppUnload,appUnloadTimedOut:i.appUnloadTimedOut};if(i.forceAppUnloadStartTime&&(s.appUnloadStartTime=i.forceAppUnloadStartTime),i.forceAppUnloadEndTime&&(s.appUnloadEndTime=i.forceAppUnloadEndTime),i.appUnloadedMessageValues){const t=i.appUnloadedMessageValues,e=Number(t.hostMessageReceived);i.forceAppUnloadStartTime&&!isNaN(e)&&(s.hostToAppPostMessageLatency=e-i.forceAppUnloadStartTime);const o=Number(t.appMessageSent);!isNaN(o)&&i.forceAppUnloadEndTime&&(s.appToHostPostMessageLatency=i.forceAppUnloadEndTime-o);const n=Number(t.appUnloadStart),r=Number(t.appUnloadEnd);if(isNaN(n)||isNaN(r)||(s.appUnloadLatency=r-n),t.serverTimings){const i=t.serverTimings;for(const t in i)s["st-"+t.toString()]=i[t]}}i.logger.ULS.Ci(595855436,t.k,e.Info,"App disposed "+JSON.stringify(s)),i.logger.ULS.flushOnClose()}(i),i.onDisposed&&i.onDisposed()}catch(s){i.logger.ULS.Ci(595714434,t.k,e.Error,`Error disposing: ${F(s)}`)}}var Ji,Gi;function ji(t,i){i&&i.Diagnostics&&Object.keys(i.Diagnostics).forEach((e=>t[e]=i.Diagnostics[e]))}!function(t){t.BrowserEvent="BrowserEvent",t.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",t.PageChanged="PageChanged",t.ZoomChanged="ZoomChanged",t.ContentRefreshBegin="ContentRefreshBegin",t.ContentRefreshEnd="ContentRefreshEnd",t.AppClosed="UI_Close",t.UserEdit="Edit_Notification",t.FileRename="File_Rename",t.FileShare="UI_Sharing",t.ShowFileVersions="UI_FileVersions",t.UIWorkflow="UI_Workflow",t.IsDisabled="IsDisabled",t.AccessibilityLoopComplete="App_AccessibilityLoopComplete",t.Unloaded="Unloaded",t.Disposed="Disposed",t.SwitchMode="App_SwitchMode",t.DocumentReboot="DocReboot",t.WopiInfoFromUrl="WopiInfoFromUrl",t.DavUrlFromIds="DavUrlFromIds",t.ModeSwitched="ModeSwitched",t.CreateNewDocument="App_CreateNewDocument",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.SetOverlayContent="SetOverlayContent",t.MoveToFolder="MoveToFolder",t.SharedFilePicker="SharedFilePicker"}(Ji||(Ji={})),function(t){t.bootWithoutWopiInfo="",t.unifiedSingleFlush="Unified_SingleFlush",t.unifiedIrmEnabled="Unified_IrmEnabled",t.unifiedViewActionUrl="Unified_ViewActionUrl",t.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",t.forceSingleStepBoot="Force_SingleStepBoot",t.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",t.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",t.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect",t.wordMobileUnifiedReadRedirect="WordMobile_UnifiedReadRedirect"}(Gi||(Gi={}));const zi="WebApplicationFrame";function qi(t,i,e,s,o){let n=v(t);("teams"===n.uih&&"UnifiedUiHostTeams"!==i.UiHostIntegrationType&&"TeamsModern"!==i.UiHostIntegrationType||"owa"===n.uih)&&(n.hhdr="1");const r=t.indexOf("?"),a=-1===r?t.concat("?"):t.substring(0,r+1);i.UiLocale&&(n.ui=encodeURIComponent(i.UiLocale)),i.DataLocale&&(n.rs=encodeURIComponent(i.DataLocale)),i.HostSessionId&&(n.hid=encodeURIComponent(i.HostSessionId)),i.DisableChat&&(n.dchat="1"),i.SessionContext&&(n.sc=encodeURIComponent(i.SessionContext)),e&&e.WopiSrc&&(n.wopisrc=encodeURIComponent(e.WopiSrc)),i.CookieCompliant&&(n.mscc="1"),s&&(s.entryPoint&&(n.wdorigin=encodeURI(s.entryPoint)),s.userClickTime&&(n.wdhostclicktime=s.userClickTime.toString())),n={...n,...i.WdParams,...o};const h={};for(const t in n)h[t.toLowerCase()]=n[t];const c=[];for(const t in h)h[t]&&c.push(t.concat("=",h[t]));return a.concat(c.join("&"))}function Ki(t){return t.AccessTokenExpiry?t.AccessTokenExpiry.getTime().toString():"0"}class Xi{registerPostMessageHandlers(){this.qa.registerMessagePayloadHandler(it.Te,this.Ka),this.qa.registerMessagePayloadHandler(it.Ee,this.Xa),this.qa.registerMessagePayloadHandler(it.Ce,this.Za),this.qa.registerMessagePayloadHandler(Xi.Ya,this.Qa),this.qa.registerMessagePayloadHandler(it.cs,this.th),this.qa.registerMessagePayloadHandler(it.xe,this.ih),this.qa.registerMessagePayloadHandler(it.gs,this.eh),this.qa.registerMessagePayloadHandler(Xi.sh,this.oh),bi.getBRSValue(bi.CoCommentingAcrossViewAndEditEnabled)&&this.qa.registerMessagePayloadHandler(it.ns,this.nh),this.rh.SupportsFrameTrustCheck||this.qa.registerMessagePayloadHandler(it.Je,this.ah),this.qa.registerMessagePayloadHandler(it.je,this.hh),this.qa.registerMessagePayloadHandler(it.ze,this.dh),this.qa.registerMessagePayloadHandler(it.vs,this.lh),this.qa.registerMessagePayloadHandler(it.Qe,this.uh),this.qa.registerMessagePayloadHandler(it.ws,this.ph)}unregisterPostMessageHandlers(){this.qa.removeMessageHandler(it.Te),this.qa.removeMessageHandler(it.Ee),this.qa.removeMessageHandler(it.Ce),this.qa.removeMessageHandler(Xi.Ya),this.qa.removeMessageHandler(it.gs),this.qa.removeMessageHandler(Xi.sh),bi.getBRSValue(bi.CoCommentingAcrossViewAndEditEnabled)&&this.qa.removeMessageHandler(it.ns),this.qa.removeMessageHandler(it.Je),this.qa.removeMessageHandler(it.je),this.qa.removeMessageHandler(it.ze),this.qa.removeMessageHandler(it.vs),this.qa.removeMessageHandler(it.Qe),this.qa.removeMessageHandler(it.ws),this.qa.removeMessageHandler(it.cs),this.qa.removeMessageHandler(it.xe)}registerEventHandler(t,i){switch(t){case Ji.Unloaded:case Ji.DocumentReboot:case Ji.CreateNewDocument:case Ji.GetAuthToken:case Ji.GetCustomAuthConfig:case Ji.MoveToFolder:case Ji.SharedFilePicker:case Ji.SetOverlayContent:if(this.mr[t])throw new Error("Duplicate registration for: "+t);this.mr[t]=i;break;default:this.qa.registerMessagePayloadHandler(t,i)}}removeEventHandler(t,i){switch(t){case Ji.Unloaded:case Ji.DocumentReboot:case Ji.CreateNewDocument:case Ji.GetAuthToken:case Ji.GetCustomAuthConfig:case Ji.MoveToFolder:case Ji.SharedFilePicker:case Ji.SetOverlayContent:if(this.mr[t]!==i)throw new Error("The handler requested to be removed does not exist for the eventType: "+t);delete this.mr[t];break;default:this.qa.removeMessageHandler(t)}}showApplicationFrame(){this.vr.style.opacity="1.0"}hideApplicationFrame(){this.vr.style.opacity=Xi.mh}Dispose(i,s){this.Fo.ULS.Ci(595682585,t.H,e.Info,"VisioWopiApplication.Dispose() Entered"),i||this.vr&&this.vr.parentElement&&this.vr.parentElement.removeChild(this.vr),i?function(i,s,o,n,r,a,h){if(s.ULS.Ci(595714433,t.k,e.Important,`Starting disposing the application. unloadApp:${i}; disposed:${Ni}; unloading:${Hi}`),Ni||Hi&&i)return void s.ULS.Ci(595714908,t.k,e.Info,"Application is already disposed or unloading");const c={logger:s,postMessenger:o,innerApplicationFrame:n,onDisposed:r,onFrameRemoved:a,unloadTimeoutInMs:h||1e3,forceAppUnload:!1,disposeStartTime:M(),appUnloadTimedOut:!1};if(i&&n)return Hi=!0,c.forceAppUnload=!0,(d=c).forceAppUnloadStartTime=M(),d.logger.ULS.Ci(595855490,t.k,e.Info,"Sending postmessage to unload app"),d.logger.ULS.flush(),d.postMessenger.registerMessagePayloadHandler(it.Ts,(i=>function(i,s){i.forceAppUnloadEndTime=M(),i.appUnloadedMessageValues=s,i.logger.ULS.Ci(595855491,t.k,e.Info,"AppUnloaded received from app"),Li(i)}(d,i))),d.postMessenger.sendPostMessage(d.innerApplicationFrame,yt.er,{}),void window.setTimeout((()=>function(i){!Hi&&Ni||(i.appUnloadTimedOut=!0,i.logger.ULS.Ci(595855492,t.k,e.Info,"ApplicationUnload timed out, forcing dispose"),Li(i))}(d)),d.unloadTimeoutInMs);var d;Li(c)}(i||!1,this.Fo,this.qa,this.vr,(()=>{delete this.wh,delete this.fh,delete this.vr,this.raiseEvent(Ji.Unloaded,{})}),void 0,s):(delete this.wh,delete this.fh,delete this.vr)}raiseEvent(t,i){const e=this.mr[t];e&&e(i||{})}activate(){this.Fo.ULS.Ci(595682586,t.H,e.Info,"VisioWopiApplication.Activate() Entered"),this.gh(!1)}resetInnerApplicationFrameId(){this.vr.id=zi}getInnerApplicationFrame(){return this.vr}getInnerApplicationFramePromise(){return this.Sh}completeTwoStepFlow(i,s){this.Fo.ULS.Ci(595706829,t.H,e.Info,"VisioWopiApplication.CompleteTwoStepFlow()");try{this.Ih=i,void 0!==s&&(this.bh=s),this.Ih&&this._h&&this.Th()}catch(i){this.Fo.ULS.Ci(595706830,t.H,e.Error,`VisioWopiApplication.CompleteTwoStepFlow() failed: ${F(i)}`)}}Boot(i=!1){this.Fo.ULS.Ci(596464402,t.H,e.Info,`VisioWopiApplication.Boot() isBackground:${i}`),ee.validateAppModeForBackgroundBoot(i,this.Ch);try{this.Ah(i,this.Eh,(()=>{try{this.Fh(i)}catch(t){this.yh(t,this.Vh)}}))}catch(t){this.yh(t,this.Vh)}}notifyFastPreviewFailed(){this.Ph?this.Ph=!1:this.Fo.ULS.Ci(596459906,t.H,e.Info,"Fast boot container is not available")}sendCreateNewTemplateId(t){void 0!==t&&this.Rh(Xi.xh,t)}sendWACDataPostMessage(i){this.qa.sendPostMessage(this.vr,Xi.Wh,i),this.Fo.ULS.Ci(595935318,t.H,e.Info,"Document Data Sent with Post Message.")}sendPostMessageForCommand(t,i){this.qa.postMessageForCommand(this.vr,t,i)}IsPageViewLoaded(){return this.Uh}IsBootComplete(){return this.Mh}UpdateLogger(t){this.Fo=t}PostWacToken(t,i,e){kt(t,i,this.qa,this.Fo,this.Sh,e)}constructor(i,s,o,n,r,a,h,c,d,l,p,m,w,f){this._h=!1,this.Uh=!1,this.Mh=!1,this.Ph=!1,this.Dh=!1,this.kh=!1,this.Oh=!1,this.Bh=!1,this.mr={},this.Rh=(i,s)=>{this.vr&&this.vr.contentWindow?this.qa.sendPostMessage(this.vr,i,s):this.Fo.ULS.Ci(595706831,t.k,e.Warning,"Attempted to send postmessage: "+i)},this.Ah=(i=!1,s,o)=>{this.Fo.ULS.Ci(596464673,t.H,e.Info,"VisioWopiApplication.createInnerFrame()"),this.vr=document.createElement("iframe"),this.vr.id=i?Xi.$h:zi,this.vr.name=zi,this.vr.width="100%",this.vr.height="100%",this.vr.src="",this.vr.frameBorder="0",this.vr.marginWidth="0",this.vr.marginHeight="0",this.vr.allowFullscreen=!0,this.vr.style.left="0",this.vr.style.top="0",this.vr.style.right="0",this.vr.style.bottom="0",this.gh(i),this.vr.style.position="absolute",this.vr.style.backgroundColor="transparent",this.vr.setAttribute("allowTransparency","true"),this.vr.setAttribute("loading","eager"),this.vr.title="Office Online Frame",this.vr.style.zIndex="1000",this.vr.style.setProperty("will-change","opacity"),this.vr.onload=o;const n=u(this.Nh);this.vr.setAttribute("allow",`microphone ${n}; autoplay ${n}; camera ${n}; clipboard-read ${n}; clipboard-write ${n}; keyboard-map ${n}; display-capture ${n}`),this.Vh.officeFrameCreateTime=M(),s.insertBefore(this.vr,s.firstChild),this.Hh&&this.Hh(this.vr)},this.gh=t=>{J()===$.Safari?this.vr.style.display=t?"none":"block":this.vr.style.visibility=t?"hidden":"visible"},this.Fh=(i=!1)=>{if(this.vr.onload=()=>{},this.Fo.ULS.Ci(596464674,t.H,e.Info,`VisioWopiApplication.internalBootFromWac() isBackground:${i}`),null==this.vr.contentWindow)return;this.fh=this.vr.contentWindow,this.wh=this.fh.document,this.wh.body.style.margin="0",this.wh.body.style.padding="0",this.wh.body.style.overflow="hidden",this.wh.body.style.msContentZooming="none";const s=this.wh.createElement("meta");s.charset="utf-8",this.wh.head.appendChild(s);const o=this.wh.createElement("meta");o.httpEquiv="x-ua-compatible",this.wh.head.appendChild(o);const n=this.wh.createElement("meta");n.name="viewport",n.content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no",this.wh.head.appendChild(n);const r=this.wh.createElement("form");r.id="office_form",r.name="office_form",r.target=i?"_self":zi,r.action=this.Lh,r.method="POST";const a=function(i,s){const o={};if(i.wopiInfo&&(o[Di.Gr]=i.wopiInfo.AccessToken,o[Di.jr]=Ki(i.wopiInfo),i.wopiInfo.WacToken&&(o[Di.zr]=i.wopiInfo.WacToken)),i.wopiPrecheckInfo.BundleInfo&&i.wopiPrecheckInfo.BundleInfo.Url&&i.wopiPrecheckInfo.BundleInfo.Url.length>0)if(o[Di.qr]=i.wopiPrecheckInfo.BundleInfo.Url,null!=i.wopiPrecheckInfo.BundleInfo.BundleStaleness&&void 0!==i.wopiPrecheckInfo.BundleInfo.BundleStaleness){const n=i.wopiPrecheckInfo.BundleInfo.BundleStaleness.toString();s.ULS.Ci(593503580,t.k,e.Info,"Content bundle staleness - "+n),o[Di.Kr]=n}else s.ULS.Ci(593503581,t.k,e.Info,"Content bundle staleness does not exist");if(i.wopiPrecheckInfo.FileGetUrl&&(o[Di.ea]=i.wopiPrecheckInfo.FileGetUrl),i.wopiPrecheckInfo.CustomFontCatalogUrl&&(o[Di.sa]=i.wopiPrecheckInfo.CustomFontCatalogUrl),i.wopiPrecheckInfo.FileName){const t=E(i.wopiPrecheckInfo.FileName);t&&(o[Di.ia]=t),o[Di.oa]=i.wopiPrecheckInfo.FileName}i.newFileTemplateSource&&i.newFileTemplateSource.FileSize?o[Di.na]=i.newFileTemplateSource.FileSize.toString():i.wopiPrecheckInfo.FileSize&&(o[Di.na]=i.wopiPrecheckInfo.FileSize.toString()),i.sessionInformation.UserId&&(o[Di.Sa]=i.sessionInformation.UserId),i.sessionInformation.OwnerId&&(o[Di.ma]=i.sessionInformation.OwnerId),i.sessionInformation.SessionContext&&(o[Di.wa]=i.sessionInformation.SessionContext),void 0!==i.sessionInformation.SupportsZipIt&&(o[Di.Ha]=i.sessionInformation.SupportsZipIt.toString()),i.diagnostics.HostInitDiagnostics&&(o[Di.la]=JSON.stringify({HostInitializeDiagnostics:i.diagnostics.HostInitDiagnostics,ClientDiagnostics:i.diagnostics.ClientDiagnostics})),o[Di.ta]=gt(i.featureManager,i.sessionInformation.WdParams),i.applicationCustomSettings&&i.applicationCustomSettings.HostUIControls&&(o[Di.pa]=JSON.stringify(i.applicationCustomSettings.HostUIControls)),o[Di.da]=String(window.devicePixelRatio>1.24),o[Di.fa]=String(z()),o[Di.ua]=i.sessionInformation.HostName;const n=i.newFileTemplateSource;n&&n.FileGetUrl&&(o[Di.ga]=n.FileGetUrl),n&&n.DocUniqueId?o[Di.Xr]=n.DocUniqueId:i.wopiPrecheckInfo.DocUniqueId&&(o[Di.Xr]=i.wopiPrecheckInfo.DocUniqueId),n&&n.ETag?o[Di.Qr]=n.ETag:i.wopiPrecheckInfo.ETag&&(o[Di.Qr]=i.wopiPrecheckInfo.ETag),"Templatization"!==i.sessionInformation.ContentAssemblyMode&&"DocGen"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyEdit"!==i.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==i.sessionInformation.ContentAssemblyMode||(o[Di.Ea]="1"),i.sessionInformation.ContentAssemblyMode&&(o[Di.Ba]=i.sessionInformation.ContentAssemblyMode);const r=i.sessionInformation.Meeting;r&&(r.id&&(o[Di.Fa]=r.id),r.title&&(o[Di.ya]=r.title),r.type&&(o[Di.Va]=r.type),r.scheduledStartTime&&(o[Di.Ra]=r.scheduledStartTime),r.scheduledEndTime&&(o[Di.Ra]=r.scheduledEndTime),r.joinUrl&&(o[Di.Ua]=encodeURIComponent(r.joinUrl)),r.organizerId&&(o[Di.Wa]=r.organizerId),r.isPresenter&&(o[Di.xa]=r.isPresenter.toString()),r.isMeetingTeamsRoom&&(o[Di.Ma]=r.isMeetingTeamsRoom.toString()));const a=i.sessionInformation.OwlVersion;a&&(o[Di.ka]=a);const h=i.sessionInformation.OwlRollout;h&&(o[Di.Oa]=h);const c=i.sessionInformation.SupportsInPlaceCreateNew;c&&(o[Di.La]=c.toString()),i.sessionInformation.DisableEmbedViewCodeSnippet&&(o[Di.Ja]="1"),i.sessionInformation.DisableCoEditInTeams&&(o[Di.Ga]="1"),o[Di.Da]=A();const d=i.sessionInformation.TraceParent;if(d){o[Di.$a]=d;const t=i.sessionInformation.TraceState;t&&(o[Di.Na]=t)}return o}(this.Jh,this.Fo);ee.isInstantBootMode(this.Ch,this.Nh)&&(a.hasOwnProperty(Di.Gr)&&delete a[Di.Gr],a.hasOwnProperty(Di.jr)&&delete a[Di.jr],a.hasOwnProperty(Di.zr)&&delete a[Di.zr]),a.hasOwnProperty(Di.wa)&&delete a[Di.wa];for(const t in a)this.Gh(r,t,a[t]);if(bi.getBRSValue(bi.DTEEnabledBRSKey)&&this.Gh(r,Xi.jh,this.kh.toString()),!this.rh.MetaUiHostVersion){if(this.rh.HighContrastMode&&this.Gh(r,"hcm",encodeURIComponent(this.rh.HighContrastMode)),this.rh.SupportsAccessibilityLoop&&this.Gh(r,"accloop","1"),this.rh.SupportsDocReboot){const t=this.rh.SupportsDocReboot;this.Gh(r,"sdr",!0===t?"1":t.toString())}this.rh.SupportsCreateNewDocument&&this.Gh(r,"scnd","1"),this.rh.SupportsAuthToken&&this.Gh(r,"sat","1"),window.docAspxMsalEnabled&&"onedrivecom"!==v(this.Jh.applicationUrl).uih&&(this.rh.AuthTokenStrategy="PairwiseBroker"),this.rh.AuthTokenStrategy&&this.Gh(r,"ats",this.rh.AuthTokenStrategy),this.rh.SupportsCustomAuthConfig&&this.Gh(r,"cac","1"),this.rh.TopOrigin&&this.Gh(r,"to",encodeURIComponent(this.rh.TopOrigin)),this.rh.IsDeeplyNestedAuthSupportedInTeams&&this.Gh(r,"dnaa",this.rh.IsDeeplyNestedAuthSupportedInTeams.toString()),this.rh.SupportsMoveToFolder&&this.Gh(r,"mtf","1"),this.rh.SupportsCommonFilePicker&&this.Gh(r,"sfp","1"),this.rh.SupportsDirectPrint&&this.Gh(r,"sdp","1"),this.rh.DisableOfficeAddins&&this.Gh(r,"doa","1"),this.rh.SupportsDirectDownload&&this.Gh(r,"sdd","1"),this.rh.HideHeader&&this.Gh(r,"hhdr","1"),this.rh.MetaUiHostVersion&&this.Gh(r,"muv",this.rh.MetaUiHostVersion),this.rh.HideWACOneDriveFileLocationPicker&&this.Gh(r,"hodflp","1"),this.rh.OpenLinksInNewWindow&&this.Gh(r,"onw","1"),this.rh.UseDarkTheme&&this.Gh(r,"udt","1"),bi.getBRSValue(bi.IsAtMentionsEnabled)&&this.rh.SupportsAtMentions&&this.Gh(r,"sams","1")}if(this.zh&&this.Ch===gi.VIEW){const t=decodeURIComponent(this.zh);this.Gh(r,"nav",t)}this.Gh(r,Xi.qh,"true"),this.Gh(r,Xi.Kh,"true"),this.Xh&&this.Gh(r,Mi.cachedDocumentVersionData,this.Xh.GetDocVersion()),this.Gh(r,Di.da,String(window.devicePixelRatio>Xi.highDpiThreshold)),this.Zh&&this.Gh(r,Xi.Yh,this.Zh.getTime().toString()),this.wh.body.appendChild(r),r.submit()},this.Gh=(t,i,e)=>{const s=this.wh.createElement("input");s.name=i,s.value=e,s.type="hidden",t.appendChild(s)},this.Qh=()=>{let i;i=this.rh.MetaUiHostVersion?function(t,i,e=!1){let s=t.applicationUrl,o={};if(t.sessionInformation.UseBizChatTheme&&(o.ubct="1"),o.jsApi="1",o.jsapiver="v1",e&&(o.NewSession="1"),o.corrid=t.sessionId,o.usid=t.sessionId,o.sftc="1",(t.applicationCustomSettings&&t.applicationCustomSettings.IsCore||t.sessionInformation.IsCore)&&(o.core="1"),t.sessionInformation.HideViewerToolbar&&(o.hvt="1"),t.sessionInformation.DisableFocusOnBoot&&(o.disableFocusOnBoot="1"),t.sessionInformation.HighContrastMode&&(o.hcm=encodeURIComponent(t.sessionInformation.HighContrastMode)),t.sessionInformation.SupportsAtMentions&&(o.sams="1"),t.sessionInformation.SupportsAccessibilityLoop&&(o.accloop="1"),t.sessionInformation.SupportsDocReboot){const i=t.sessionInformation.SupportsDocReboot;o.sdr=!0===i?"1":i.toString()}return t.sessionInformation.SupportsCreateNewDocument&&(o.scnd="1"),t.sessionInformation.SupportsAuthToken&&(o.sat="1"),window.docAspxMsalEnabled&&"onedrivecom"!==v(t.applicationUrl).uih&&(t.sessionInformation.AuthTokenStrategy="PairwiseBroker"),t.sessionInformation.AuthTokenStrategy&&(o.ats=t.sessionInformation.AuthTokenStrategy),t.sessionInformation.SupportsCustomAuthConfig&&(o.cac="1"),t.sessionInformation.TopOrigin&&(o.to=encodeURIComponent(t.sessionInformation.TopOrigin)),t.sessionInformation.IsDeeplyNestedAuthSupportedInTeams&&(o.dnaa="1"),t.sessionInformation.SupportsMoveToFolder&&(o.mtf="1"),t.sessionInformation.SupportsCommonFilePicker&&(o.sfp="1"),t.sessionInformation.OpenLinksInNewWindow&&(o.onw="1"),t.sessionInformation.UseDarkTheme&&(o.udt="1"),(t.sessionInformation.HideHeader||"DocGen"===t.sessionInformation.ContentAssemblyMode||"Templatization"===t.sessionInformation.ContentAssemblyMode||"ContentAssemblyEdit"===t.sessionInformation.ContentAssemblyMode||"ContentAssemblyView"===t.sessionInformation.ContentAssemblyMode)&&(o.hhdr="1"),t.sessionInformation.HideAppLauncherInHeader&&(o.halh="1"),t.sessionInformation.HideChatInHeader&&(o.hch="1"),t.sessionInformation.HideMeInHeader&&(o.hmh="1"),t.sessionInformation.HideSearchInHeader&&(o.hsh="1"),t.sessionInformation.HideWorkflowInHeader&&(o.hwfh="1"),t.sessionInformation.HideSettingsInHeader&&(o.hsth="1"),t.sessionInformation.ShowAppIconInHeader&&(o.sih="1"),t.sessionInformation.UseNeutralColorInHeader&&(o.unh="1"),t.sessionInformation.HideBreadCrumbInViewer&&(o.hbcv="1"),t.sessionInformation.HideTitleInViewer&&(o.htv="1"),t.sessionInformation.HideWACOneDriveFileLocationPicker&&(o.hodflp="1"),t.sessionInformation.NoBrowserModalDialogs&&(o.nbmd="1"),t.applicationCustomSettings&&t.applicationCustomSettings.FixDiagnosticsJson&&(o.fixdiag="1"),t.wopiPrecheckInfo.ReadOnly&&(o.readOnly="1",t.wopiPrecheckInfo.ReadOnly&&(o.mode="Read")),"DocGen"!==t.sessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==t.sessionInformation.ContentAssemblyMode||(o.readOnly="1"),t.sessionInformation.UIEmbed&&(o.uiEmbed="1"),t.sessionInformation.IsSynthetic&&(o.syn="1"),t.sessionInformation.SupportsDirectDownload&&(o.sdd="1"),t.sessionInformation.SupportsDirectPrint&&(o.sdp="1"),t.sessionInformation.DisableOfficeAddins&&(o.doa="1"),t.sessionInformation.UiHostIntegrationType&&(o.uihit=encodeURIComponent(t.sessionInformation.UiHostIntegrationType)),t.sessionInformation.MetaUiHostVersion&&(o.muv=encodeURIComponent(t.sessionInformation.MetaUiHostVersion)),t.applicationCustomSettings&&t.applicationCustomSettings.InAppDocumentPreview&&(o.InAppDocPreview="1"),t.wopiPrecheckInfo.PreseededSessionKey&&(o.preseededSessionKey=encodeURIComponent(t.wopiPrecheckInfo.PreseededSessionKey)),t.wopiPrecheckInfo.PreseededWacSessionId&&(o.preseededWacSessionId=encodeURIComponent(t.wopiPrecheckInfo.PreseededWacSessionId)),t.wopiPrecheckInfo.RequestedCallThrottling&&(o.rct=t.wopiPrecheckInfo.RequestedCallThrottling),t.wopiPrecheckInfo.ClientThrottlingProtection&&(o.ctp=t.wopiPrecheckInfo.ClientThrottlingProtection),t.applicationCustomSettings&&t.applicationCustomSettings.additionalApplicationParameters&&(o={...t.applicationCustomSettings.additionalApplicationParameters,...o}),t.rebootOverrideData&&t.rebootOverrideData.queryOverrides&&(o={...o,...t.rebootOverrideData.queryOverrides}),t.sessionInformation.AfdFlighting&&(o.afdflight=Math.floor(100*Math.random()+1).toString()),qi(s,t.sessionInformation,t.wopiInfo,t.diagnostics.HostInitDiagnostics,o)}(this.Jh,function(i,s){let o={isSingleStepBoot:i.forceSingleStepBoot,bootFlowType:i.forceSingleStepBoot?Gi.forceSingleStepBoot:Gi.bootWithoutWopiInfo,ignoreWacFramePostMessages:!1};if(i.forceSingleStepBoot,o.isSingleStepBoot){const n={singleStepBootIsRequired:!0,singleStepBootReason:o.bootFlowType,irmEnabled:i.wopiPrecheckInfo.IrmEnabled,readOnly:i.wopiPrecheckInfo.ReadOnly,ignoreWacFramePostMessages:o.ignoreWacFramePostMessages};s.ULS.Ci(596444182,t.k,n.irmEnabled?e.Warning:e.Info,JSON.stringify(n))}else s.ULS.Ci(596444183,t.k,e.Info,"Received input valid for two step flow")}(this.Jh,this.Fo)):this.Nh;const s={};return s.usid=this.tc,s.sftc="1",s.fileSrc=this.rh.HostName,s.pmOrigin=encodeURIComponent(u(window.location.href)),s.fastPreview=this.Ph?"true":"false",ee.isInstantBootMode(this.Ch,this.Nh)&&(s.instantedit="1"),this.rh.MetaUiHostVersion||(this.ic.RequestedCallThrottling&&(s.rct=this.ic.RequestedCallThrottling),this.ic.ClientThrottlingProtection&&(s.ctp=this.ic.ClientThrottlingProtection)),"DocGen"!==this.rh.ContentAssemblyMode&&"ContentAssemblyView"!==this.rh.ContentAssemblyMode||(s.readOnly="1"),"DocGen"!==this.rh.ContentAssemblyMode&&"Templatization"!==this.rh.ContentAssemblyMode&&"ContentAssemblyView"!==this.rh.ContentAssemblyMode&&"ContentAssemblyEdit"!==this.rh.ContentAssemblyMode||(s.hhdr="1"),qi(i,this.rh,this.Ih,this.ec,s)},this.Ka=t=>{this.Rh(yt.gn,{}),this._h||(this._h=!0,ji(this.Vh,t),ee.isInstantBootMode(this.Ch,this.Nh)&&this.Ih&&this.Th())},this.Th=()=>{if(this.Dh)return;this.Dh=!0,this.Fo.ULS.Ci(595706832,t.k,e.Info,"Sending wopi info to the frame.");let i="";bi.getBRSValue(bi.AppShellPrebootEnabledBRSKey)&&void 0!==this.bh&&void 0!==this.bh.TemplateSource&&void 0!==this.bh.TemplateSource.DocUniqueId&&(i=this.bh.TemplateSource.DocUniqueId);const s={WopiDetails:{WopiSrc:this.Ih.WopiSrc,AccessToken:this.Ih.AccessToken,AccessTokenTtl:Ki(this.Ih),CreateNewTemplateId:i}};this.Ih.WacToken&&(s.WopiDetails.WacToken=this.Ih.WacToken),this.oc(yt.Tn,s)},this.oc=(t,i)=>{this.nc(t,i,1)},this.rc=()=>{if(this.Fo.ULS.Ci(589611397,t.k,e.Info,"Sending comment context message to frame"),void 0!==this.ac){const t=this.ac;this.Rh(yt.Jn,t),this.ac=void 0}},this.nh=t=>{this.ac=t},this.nc=(i,s,o)=>{o>3?this.Fo.ULS.Ci(595706833,t.k,e.Error,`Attempted to call complete, but received no ack from the frame. Time: ${M()}`):(this.Fo.ULS.Ci(595706834,t.k,e.Info,`Sending completion message to frame. Attempt number: ${o}, Time: ${M()}`),this.Rh(i,s),window.setTimeout((()=>this.hc(i,s,o)),1e3))},this.hc=(i,s,o)=>{this.Oh||(this.Fo.ULS.Ci(595706835,t.k,e.Info,"SessionCompletion timed out with no ack."),this.nc(i,s,o+1))},this.eh=t=>{this.Oh=!0},this.Xa=i=>{this.Ch===gi.VIEW&&bi.getBRSValue(bi.CoCommentingAcrossViewAndEditEnabled)&&this.rc(),this.Mh||(this.Mh=!0,this.Fo.ULS.Ci(596457678,t.H,e.Info,`Switched to Visio Frame at Time: ${M()}`),ji(this.Vh,i),this.Vh.webAppFrameReinitialized=this.Bh,this.Vh&&this.Fo.ULS.Ci(596464400,t.H,e.Info,"AppInitializeDiagnostics:"+JSON.stringify(this.Vh)),this.Fo.ULS.Ci(596464675,t.H,e.Info,`${JSON.stringify(i)}`),this.cc(this.Vh,i&&i.Settings?i.Settings:null),this.qa.sendPostMessage(this.vr,yt.yn,{HostInitializeDiagnostics:this.Jh.diagnostics.HostInitDiagnostics,ClientDiagnostics:this.Jh.diagnostics.ClientDiagnostics}))},this.Za=i=>{let s;this.Mh=!0,i&&(s=i.Error),void 0===s&&(this.Fo.ULS.Ci(596453597,t.H,e.Warning,"No error information passed by the WAC Frame"),s={errorType:ct.AppInitError,errorObject:new TypeError("WacFrame")}),this.yh(s,this.Vh)},this.Qa=i=>{this.Uh||(this.Uh=!0,this.Fo.ULS.Ci(595969242,t.H,e.Info,"Page View loaded on WAC Frame"),ji(this.Vh,i))},this.th=t=>{this.raiseEvent(Ji.DocumentReboot,t)},this.ih=t=>{this.raiseEvent(Ji.CreateNewDocument,t)},this.hh=t=>{Promise?this.dc.isResourceTrustedForMessage(t).then((i=>{i?this.raiseEvent(Ji.GetAuthToken,t):this.qa.sendPostMessage(this.vr,yt.Hn,{AuthToken:"",Error:"accessDenied",RequestId:t.RequestId,IdentityType:t.IdentityType})}),(()=>{this.qa.sendPostMessage(this.vr,yt.Hn,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:t.RequestId,IdentityType:t.IdentityType})})):this.qa.sendPostMessage(this.vr,yt.Hn,{AuthToken:"",Error:'"Promise" does not exist natively in browser',RequestId:t.RequestId,IdentityType:t.IdentityType})},this.dh=t=>{this.raiseEvent(Ji.GetCustomAuthConfig,t)},this.uh=t=>{this.raiseEvent(Ji.MoveToFolder,t)},this.ph=t=>{this.raiseEvent(Ji.SharedFilePicker,t)},this.ah=i=>{const s=Oi();this.Fo.ULS.Ci(595642328,t.H,e.Info,`Top frame is trusted: ${s}`),this.qa.sendPostMessage(this.vr,yt.Je,{isTopFrameTrusted:s})},this.lh=i=>{const s=Bi(i&&i.overlayContent);this.Fo.ULS.Ci(587487433,t.k,e.Info,`Overlay content: ${s}`),this.qa.sendPostMessage(this.vr,yt.Qn,void 0)},this.Ih=i,this.Jh=s,this.ic=s.wopiPrecheckInfo,this.Eh=s.container,this.rh=s.sessionInformation,this.tc=s.sessionId,this.Nh=s.applicationUrl,this.ec=s.diagnostics.HostInitDiagnostics,this.Fo=o,this.cc=n,this.yh=r,this.oh=a,this.Ph=h,this.Xh=c,this.qa=l,this.dc=p,this.Ch=m,this.Bh=w,this.kh=f,this.mr=d,this.Vh={officeSessionId:this.tc,officeBootstrapperVersion:A()},Promise&&(this.Sh=new Promise((t=>this.Hh=t)));const g=v(window.location.href);this.zh="",bi.getBRSValue(bi.IsAtMentionsEnabled)&&(this.zh=g.nav),void 0!==this.ec?(g.teamsvisiomode&&(this.Fo.ULS.Ci(576074626,t.H,e.Warning,"Resetting user click for Teams reboot scenarios"),this.ec.userClickTime=(new Date).getTime()),this.Zh=this.ec.userClickTime?new Date(this.ec.userClickTime):void 0,this.lc=this.ec.officeInitializationTime?new Date(this.ec.officeInitializationTime):void 0):(this.Zh=void 0!==this.rh&&void 0!==this.rh.DocumentClickTime?this.rh.DocumentClickTime:void 0,this.lc=void 0!==this.rh&&void 0!==this.rh.HostInitTime?this.rh.HostInitTime:void 0),this.Zh?this.Fo.ULS.Ci(596459904,t.H,e.Info,`DocumentClickTime: ${this.Zh.getTime()}`):(this.Zh=new Date,this.Fo.ULS.Ci(595686562,t.H,e.Info,`Fallback DocumentClickTime: ${this.Zh.getTime()}`)),this.lc&&this.Fo.ULS.Ci(596459905,t.H,e.Info,`hostInitTime: ${this.lc.getTime()}`),this.Lh=this.Qh(),w||this.registerPostMessageHandlers(),Ni=!1}}var Zi,Yi,Qi;Xi.Ya="Visio_PageViewLoaded",Xi.Wh="Visio_DocumentData",Xi.xh="TemplateInfo_Ready",Xi.sh="Visio_ReadyToReceiveDocData",Xi.qh="bsdpm",Xi.Kh="dpmdv",Xi.Yh="dct",Xi.jh="wde",Xi.$h="BkgWebApplicationFrame",Xi.highDpiThreshold=1.25,Xi.mh="0.0000001",function(t){t[t.TimerBegin=0]="TimerBegin",t[t.TimerEnd=1]="TimerEnd"}(Zi||(Zi={}));class te{static RecordTelemetryData(i,s,o,n,r,a){if(!bi.getBRSValue(bi.IsLongPoleInfraEnabled))return;const h={FeatureName:i,GUID:s,ComponentName:o,EventCategory:n===Zi.TimerBegin?"BeginTimeStamp":"EndTimeStamp",MilliSecondsSinceEpoch:null!=r?r.getTime().toString():"-1",Value:null!=r?r.toUTCString():"-1"};a&&a.ULS.Ci(523375501,t.H,e.Info,JSON.stringify(h))}}function ie(t,i,e){let s;if(t?.userClickTime?s=t.userClickTime:t?.hostPageFirstFlushTime&&(s=t.hostPageFirstFlushTime),t?.officeBootstrapperStartTime&&s&&Math.floor((t.officeBootstrapperStartTime-s)/1e3)<60&&(te.RecordTelemetryData(hi,ci,oi,Zi.TimerBegin,new Date(s),e),te.RecordTelemetryData(hi,ci,oi,Zi.TimerEnd,new Date(t.officeBootstrapperStartTime),e)),t?.officeBootstrapperStartTime&&te.RecordTelemetryData(hi,ci,ni,Zi.TimerBegin,new Date(t.officeBootstrapperStartTime),e),i?.officeFrameCreateTime){const t=new Date(i.officeFrameCreateTime);te.RecordTelemetryData(hi,ci,ai,Zi.TimerBegin,t,e),te.RecordTelemetryData(hi,ci,ni,Zi.TimerEnd,t,e)}if(i?.appCompletedTime){const t=new Date(i.appCompletedTime);te.RecordTelemetryData(hi,ci,ai,Zi.TimerEnd,t,e)}if(i?.documentLoadedTime){const t=new Date(i.documentLoadedTime);te.RecordTelemetryData(hi,ci,ri,Zi.TimerEnd,t,e)}}class ee{unregisterAppLevelPostMessageHandlers(){this.uc||(this.mc&&this.mc.unregisterPostMessageHandlers(),this.wc(),this.uc=!0)}registerAppLevelPostMessageHandlers(){this.fc.activate(this.getInnerApplicationFrame()),this.gc(),this.mc&&this.mc.registerPostMessageHandlers()}isBackground(){return this.vc===Yi.Background}isActive(){return this.vc===Yi.Active}getWopiInfo(){return this.Jh.wopiInfo}getNewFileInfo(){return this.bh}GetApplicationType(){return"Visio"}GetVersion(){return A()}GetSessionId(){return this.Jh.sessionId}RegisterEventHandler(t,i){this.mc&&this.mc.registerEventHandler(t,i)}RemoveEventHandler(t,i){this.mc&&this.mc.removeEventHandler(t,i)}RegisterErrorHandler(t){throw void 0!==t&&(this.Sc=t),Error("Not Implemented")}RemoveErrorHandler(t){throw void 0!==t&&delete this.Sc,Error("Not Implemented")}PostCommand(t,i){this.mc.sendPostMessageForCommand(t,i)}Dispose(i){if(this.Fo.ULS.Ci(595682625,t.H,e.Info,`VisioApplication.Dispose() Disposing Active Frame appMode:${this.Ch}, appState:${this.vc}`),this.vc===Yi.Disposed){if(!(bi.getBRSValue(bi.IsSaveAndCloseRequestInvokedInTeamsEnabled)&&i&&this.Ic))throw new TypeError("Trying to Dispose application whose appState is Disposed");return this.Fo.ULS.Ci(529343379,t.H,e.Info,`Calling appUnloadCallback to dispose active application (Edit Background App) in appMode:${this.Ch}, appState:${this.vc}`),void this.Ic({})}this.vc=Yi.Disposed,this.bc(),this._c(i),this.Jh.sessionInformation.MetaUiHostVersion&&this.unregisterAppLevelPostMessageHandlers(),this.Fo.ULS.flushOnClose(),delete this.Tc,delete this.Cc}removeFastView(){this.Cc&&this.Jh.container&&this.Jh.container.contains(this.Cc)&&this.Jh.container.removeChild(this.Cc)}updateVisibilityMetrics(t){t&&(this.Ac=t)}activate(){if(this.Fo.ULS.Ci(595682626,t.H,e.Info,`VisioApplication.activate() Activating Background Frame appMode:${this.Ch}, appState:${this.vc}`),this.vc!==Yi.Background)throw new TypeError("Trying to activate application whose appState is not Background");if(!this.mc)throw new TypeError("VisioApplication:activate() Visio wopi Application is null");this.vc=Yi.Active,this.Ec&&(this.Ec=!1,this.Fc()),this.mc.activate()}resetInnerApplicationFrameId(){this.mc.resetInnerApplicationFrameId()}getInnerApplicationFrame(){return this.mc.getInnerApplicationFrame()}getInnerApplicationFramePromise(){if(this.yc)return this.yc.then((t=>t.getInnerApplicationFramePromise()))}Complete(i,s){if(this.Fo.ULS.Ci(596464068,t.H,e.Info,`VisioApplication.Complete() isBackground:${this.isBackground()} appMode:${this.Ch}`),bi.getBRSValue(bi.JsapiV1DiagnosticFixEnabled)&&this.Jh.diagnostics.HostInitDiagnostics&&(this.Jh.diagnostics.HostInitDiagnostics.hostCompleteCallTime=M()),this.Ih=i,this.Jh.wopiInfo=i,void 0!==s&&(this.bh=s),this.Ih&&this.Ih.AccessToken&&this.Ih.WopiSrc)if(this.Fo.ULS.Ci(596464070,t.H,e.Info,"Create VisioWopiApplication"),this.Vc)this.mc.completeTwoStepFlow(i,s),this.Pc(s);else try{this.Rc(this.isBackground()),this.xc&&(this.Fo.ULS.Ci(540922266,t.H,e.Info,"Document image/data are present in local cache"),window.setTimeout((()=>{this.Fo.ULS.Ci(540922267,t.H,e.Info,"Loading the fast view from local cache"),this.xc()}))),this.Pc(s)}catch(i){this.Fo.ULS.Ci(596464072,t.H,e.Error,`Failure trying to boot the WOPI application: ${F(i)}`),this.Jh.fnOnInitializeFailure({errorType:ct.AppInitError,errorObject:i},void 0),x(this.Jh.remoteTelemetryUrl,Tt,"bootException")}else this.Fo.ULS.Ci(596464069,t.H,e.Error,"VisioApplication Invalid WopiInfo"),this.Jh.fnOnInitializeFailure({errorType:ct.AppInitError,errorObject:new TypeError("wopiInfo")},void 0)}Fail(i){this.Fo.ULS.Ci(596464073,t.H,e.Info,`VisioApplication.Fail() Reason: ${JSON.stringify(i)}`),this.Fo.ULS.flush()}PostWacToken(t,i,e){kt(t,i,this.fc,this.Fo,this.getInnerApplicationFramePromise(),e)}static GetMinContentVersion(){return 1}static validateAppModeForBackgroundBoot(t,i){if(t&&i!==gi.EDIT)throw new TypeError("Boot() isBackground can not be true in other than Edit Mode")}addTimerTagForBoot(t){window.setTimeout((()=>this.Wc(t)),t)}Boot(){if(this.Fo.ULS.Ci(596464074,t.H,e.Info,"VisioApplication.Boot()"),this.Fo.ULS.Ci(596452560,t.H,e.Info,`Visio Application Mode: ${this.Ch} , isBackground: ${this.isBackground()}`),ee.validateAppModeForBackgroundBoot(this.isBackground(),this.Ch),this.Uc=bi.getBRSValue(bi.hostCacheForEmbedViewEnabledBRSKey,!0),this.Ch===gi.VIEW?(this.Fo.ULS.Ci(596457682,t.H,e.Info,"Enabling fast boot since this is consumption mode"),this.Mc=!0,this.Dc=!0):this.Ch!==gi.EMBED_VIEW&&this.Ch!==gi.INTERACTIVE_PREVIEW||!this.Uc?this.Ch===gi.EDIT&&-1===this.Jh.applicationUrl.indexOf("embed=1")&&(this.Mc=!0,this.Fo.ULS.Ci(594838688,t.H,e.Info,"Enabling wrs fast boot in edit mode")):(this.Fo.ULS.Ci(595198939,t.H,e.Info,"Enabling fast boot with no chrome mode for Embed View."),this.Mc=!0,this.kc=!0),(this.Mc||this.Dc)&&this.Oc()&&this.Jh.sessionInformation.HideHeader&&(this.kc=!0),this.kc&&this.Oc()&&(this.Bc=!0),this.Jh.sessionInformation&&this.Jh.sessionInformation.WdParams&&(this.Jh.sessionInformation.WdParams.wdPBIView&&(this.Fo.ULS.Ci(596464075,t.H,e.Info,"No fast boot since the session is in PBI Mode"),this.Mc=!1,this.Dc=!1),this.Jh.sessionInformation.WdParams.wdnc&&(this.Fo.ULS.Ci(596129760,t.H,e.Info,"Boot in no chrome mode"),this.kc=!0)),-1!==this.Jh.applicationUrl.indexOf("wdPBIView")&&(this.Fo.ULS.Ci(596457683,t.H,e.Info,"No fast boot since the session is in PBI Mode"),this.Mc=!1,this.Dc=!1),-1!==this.Jh.applicationUrl.indexOf("wdnc")&&(this.Fo.ULS.Ci(596129761,t.H,e.Info,"Boot in no chrome mode"),this.kc=!0),-1!==this.Jh.applicationUrl.indexOf("wdFastView")&&(this.Mc=!0,this.Dc=!0),window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(this.Fo.ULS.Ci(596452935,t.H,e.Info,"Running in High Contrast Mode, disable fast view"),this.Mc=!1,this.Dc=!1),this.Mc?this.Jh.wopiPrecheckInfo.BundleInfo?(this.Fo.ULS.Ci(596464076,t.H,e.Info,"Bundle is cached in host, try rendering the first page"),this.$c=this.Jh.wopiPrecheckInfo.BundleInfo,this.Nc(),this.Hc(!1)):this.Fo.ULS.Ci(596464077,t.H,e.Info,"Did not find the bundle information"):this.Fo.ULS.Ci(596464078,t.H,e.Info,"Fast View is disabled via configuration"),this.Vc)try{this.Rc(this.isBackground()),this.Fo.ULS.Ci(595706836,t.H,e.Info,"VisioWopiApplication created in case of instant create-new")}catch(i){this.Fo.ULS.Ci(595706837,t.H,e.Error,`Failure trying to boot the WOPI application in instant create-new: ${F(i)}`),this.Jh.fnOnInitializeFailure({errorType:ct.AppInitError,errorObject:i},void 0)}}updateModeSwitchClickTime(){this.Jh.diagnostics.AppInitDiagnostics.modeSwitchClickTime=M()}showFasttViewForEditApp(){this.Ch===gi.EDIT?this.Jh.wopiPrecheckInfo.BundleInfo?(this.Fo.ULS.Ci(595648647,t.H,e.Info,"showFasttViewForDirectToEdit(): Bundle is cached in host, try rendering the first page"),this.$c=this.Jh.wopiPrecheckInfo.BundleInfo,this.Nc(),this.xc&&this.xc()):this.Fo.ULS.Ci(595648648,t.H,e.Info,"showFasttViewForDirectToEdit(): Did not find the bundle information"):this.Fo.ULS.Ci(595648649,t.H,e.Info,"showFasttViewForDirectToEdit() called for non edit app mode")}static isInstantBootMode(t,i){if(!bi.getBRSValue(bi.instantCreateNewLocalStorageKey)||void 0===i)return!1;const e=i.toLowerCase();return-1===e.indexOf("wopisrc")&&(!(t!==gi.EDIT_NEW||!bi.getBRSValue(bi.InstantForAllTemplatesEnabledBRSKey)&&-1!==e.indexOf("wdtpl"))||bi.getBRSValue(bi.AppShellPrebootEnabledBRSKey)&&-1!==e.indexOf("wdasp"))}updateCreateNewTemplateInfo(t){void 0!==this.mc&&this.mc.sendCreateNewTemplateId(t)}constructor(i,s,o,n,r,a,h,c,d=Yi.Active,l=!1){this.Lc=!1,this.Jc=!1,this.kc=!1,this.Bc=!1,this.Gc=!1,this.jc=!1,this.Mc=!1,this.Dc=!1,this.Uc=!1,this.zc=!1,this.qc=!1,this.Kc=!1,this.Xc=!1,this.Zc=!1,this.uc=!1,this.kh=!1,this._ImageDataFormat="data:image/png;base64,{0}",this.mr={},this.Oc=()=>"teams"===this.Yc.toLowerCase(),this.gc=()=>{this.fc.registerMessagePayloadHandler(it.uo,this.Qc),this.fc.registerMessagePayloadHandler(it.ro,this.td),this.fc.registerMessagePayloadHandler(it.ho,this.ed),this.fc.registerMessagePayloadHandler(it.lo,this.sd)},this.wc=()=>{this.fc.removeMessageHandler(it.uo),this.fc.removeMessageHandler(it.ro),this.fc.removeMessageHandler(it.ho),this.fc.removeMessageHandler(it.lo)},this._c=t=>{if(!this.mc)throw new TypeError("VisioApplication:disposeWopiApplication() Visio wopi Application is null");this.mc.Dispose(t),t||(this.mc=void 0)},this.bc=()=>{Mi.dispose()},this.Wc=i=>{this.mc&&this.mc.IsBootComplete()||!this.isActive()||this.Fo.ULS.Ci(587580759,t.H,e.Warning,`Wopi Boot not completed even after ${i} milliseconds`)},this.od=()=>this.Ch===gi.EDIT||this.Ch===gi.EDIT_NEW,this.Pc=i=>{this.Ch===gi.EDIT_NEW&&(i&&i.NewFilePath?(yi(i.NewFilePath),i.UpdatedPageTitle&&(document.title=i.UpdatedPageTitle)):this.Fo.ULS.Ci(595722523,t.k,this.Vc?e.Warning:e.Info,"Either NewFileInfo or NewFilePath are not provided for a new file."))},this.td=t=>{if(-1!==this.Jh.applicationUrl.indexOf("embed"))return;let i="";t&&t.RefreshOrigin&&(i=t.RefreshOrigin);let e=window.location.href;bi.getBRSValue(bi.IsToastUserFixEnabledBRSKey)&&e&&(e=S(e,qt)),bi.getBRSValue(bi.IsContextAppRefreshFixEnabledBRSKey)&&e&&(e=S(e,Xt),e=S(e,Yt),e=S(e,Qt),e=S(e,ti)),this.Ch===gi.EDIT?e&&(e=g(e,zt,Gt,!0),i&&(e=g(e,"OR",i,!0)),yi(e)):this.Ch===gi.EDIT_NEW&&e&&(e=g(e,zt,Gt,!0),i&&(e=g(e,"OR",i,!0)),e=g(e,"wdNewAndOpenCt","0",!0),yi(e))},this.sd=i=>{let s=window.location.href;"VIEW"===i.toMode||"EDIT"===i.toMode?(s=g(s,"teamsvisiomode",i.toMode,!0),bi.getBRSValue(bi.IsFormulaeSerializationRollbackEnabled)&&this.Ch===gi.EDIT&&"1"===i.wdDisableFormulae&&(s=g(s,"wdDisableFormulae","1",!0)),window.location.href=s):this.Fo.ULS.Ci(593622414,t.H,e.Warning,"Invalid options received in Visio_DocReboot_HostNav message")},this.ed=()=>{let i=window.location.href;i=g(i,Bt,this.Jh.sessionId,!0);const s=this.Jh.sessionId;let o=1;Vi(this.Jh,$t)&&(o=parseInt(Pi(this.Jh,$t),10)+1),o>bi.getIntegerBRSValue(bi.ReloadOnScriptFailMaxLimitBRSKey,3)?this.Fo.ULS.Ci(590455010,t.H,e.Error,"Visio Boot failed for WACSessionID: "+s+" after"+o+"retries"):(i=g(i,$t,String(o),!0),this.Fo.ULS.Ci(590455011,t.H,e.Warning,"Refreshing VisioFrame for WACSessionID: "+s+", currentReloadCount: "+o+", UriLen: "+i.length),this.Fo.ULS.flush(),window.location.href=i)},this.Rc=i=>{this.mc=new Xi(this.Ih,this.Jh,this.Fo,this.nd,this.rd,this.ad,this.Lc,this.Xh,this.mr,this.fc,this.dc,this.Ch,this.isBackground(),this.kh),this.hd&&this.hd(this.mc),this.Fo.ULS.Ci(596464071,t.H,e.Info,"Boot VisioWopiApplication"),this.mc.Boot(i),this.Jc&&this.mc.hideApplicationFrame()},this.Nc=()=>{this.Fo.ULS.Ci(596464079,t.H,e.Info,"VisioApplication.ShowFirstPage()"),Ci(this.Jh.applicationUrl)||te.RecordTelemetryData(hi,ci,ri,Zi.TimerBegin,new Date,this.Fo);try{if(this.dd(this.$c),this.$c.MajorVersion<ee.GetMinContentVersion())return void this.Fo.ULS.Ci(596464080,t.H,e.Warning,`Content bundle version: ${this.$c.MajorVersion} is out of date`);this.zc=!0,this.ld(this.Jh.container),this.ud()}catch(i){this.Fo.ULS.Ci(596464081,t.H,e.Error,`Failed to boot from the host cache: ${F(i)}`)}},this.Hc=i=>{if(i){this.Fo.ULS.Ci(596121056,t.H,e.Info,"VisioApplication.TryPrefetchRemainingContent()");try{if(this.dd(this.$c),this.$c.MajorVersion<ee.GetMinContentVersion())return void this.Fo.ULS.Ci(596121057,t.H,e.Warning,`Content bundle version: ${this.$c.MajorVersion} is out of date`);this.pd()}catch(i){this.Fo.ULS.Ci(596121058,t.H,e.Error,`Failed to pre fetch interactive content from host cache: ${F(i)}`)}}},this.dd=t=>{if(void 0===t)throw new TypeError("WopiPrecheckInfo.BundleInfo");if(void 0===t.Url)throw new TypeError("WopiPrecheckInfo.BundleInfo.Url");if(void 0===t.MajorVersion)throw new TypeError("WopiPrecheckInfo.BundleInfo.MajorVersion")},this.md=()=>"",this.fd=t=>{t.setAttribute("crossorigin","anonymous")},this.gd=t=>{const i=this.vd;i.style.top=t+"px",i.style.position="absolute",i.style.height="auto",i.style.borderWidth=wi.ShapePanelBorderWidth+"px",i.style.borderRightStyle="solid",i.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",i.style.borderColor="#e1e1e1",i.style.backgroundColor="#f2f2f2",i.style.width=wi.ShapePanelWidthWithoutBorder+"px",i.style.bottom="0px",i.style.overflow="0";const e=document.createElement("div");e.style.top="50%",e.style.left="50%",e.style.position="absolute",e.style.transform="translateX(-50%) translateY(-50%)",e.style.fontSize="9pt",e.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',i.appendChild(e);const s=document.createElement("img");s.style.cssFloat="left",s.style.height="16px",s.style.width="16px",this.fd(s),void 0!==this.Sd?s.src=this.Sd.getLoadingSpinnerGif():s.style.visibility="hidden",e.appendChild(s);const o=document.createElement("div");return o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText=this.md(),e.appendChild(o),i},this.ld=t=>{this.Lc||(this.Cc=document.createElement("div"),this.Cc.id="VisioBootContainer",this.Cc.style.width="100%",this.Cc.style.height="100%",this.Cc.style.visibility="hidden",this.Cc.style.position="absolute",this.Cc.style.backgroundColor="#F3F2F1",this.Cc.style.display="block",this.Cc.style.touchAction="none",this.Jc=!1,t.appendChild(this.Cc),this.Id=document.createElement("div"),this.Id.style.top=wi.RibbonHeightConsumption+"px",this.Id.style.left="0px",this.Id.style.right="0px",this.Id.style.bottom=wi.StatusbarHeight+"px",this.Id.style.position="absolute",this.Id.style.borderTopColor="#C6C6C6",this.Id.style.borderTopWidth=wi.FishbowlBorderTop+"px",this.Id.style.borderTopStyle="solid",this.Id.style.backgroundColor=Fi(this.Ch)?"#FFFFFF":"#F9F9F9",this.Cc.appendChild(this.Id),this.bd=document.createElement("div"),this.bd.id="backgroundPage",this.Id.appendChild(this.bd),this.Tc=document.createElement("img"),this.Tc.id="foregroundPage",this.Tc.style.visibility="hidden",this.fd(this.Tc),this.bd.appendChild(this.Tc),this.kc||(this._d=document.createElement("div"),this._d.style.top="0px",this._d.style.height=wi.HeaderHeight+"px",this._d.style.left="0px",this._d.style.right="0px",this._d.style.position="absolute",bi.getBRSValue(bi.Fluent2StyleIsEnabled)?this._d.style.backgroundColor=this.Oc()?"#F3F2F1":"#FFFFFF":this._d.style.backgroundColor=this.Oc()?"#F3F2F1":"#3955A3",this.Cc.appendChild(this._d)),this.kc&&!this.Bc||(this.Td=document.createElement("div"),this.Td.style.top=(this.Bc?0:wi.HeaderHeight)+"px",this.Td.style.height="0px",this.Td.style.left="0px",this.Td.style.right="0px",this.Td.style.position="absolute",this.Td.style.backgroundColor="#E1E1E1",this.Cc.appendChild(this.Td),this.Cd=document.createElement("div"),this.Cd.style.top=(this.Bc?0:wi.HeaderHeight)+"px",this.Cd.style.height=wi.ToolbarHeightConsumption+"px",this.Cd.style.left="0px",this.Cd.style.right="0px",this.Cd.style.position="absolute",this.Cd.style.backgroundColor="#FFFFFF",this.Cc.appendChild(this.Cd)),this.vd=document.createElement("div"),this.Cc.appendChild(this.vd),this.vd.style.height="0px",this.Ad=document.createElement("div"),this.Ad.style.top=wi.RibbonHeightConsumption+wi.FishbowlBorderTop+"px",this.Ad.style.height=wi.ProgressImageHeight+"px",this.Ad.style.left="0px",this.Ad.style.right="0px",this.Ad.style.position="absolute",void 0!==this.Sd&&(this.Ad.style.backgroundImage=`url(${this.Sd.getDelayLoadingGif()})`,this.Ad.style.backgroundRepeat="repeat-x"),this.kc&&(this.Id.style.top=this.Bc?wi.ToolbarHeightConsumption+"px":"0px",this.Ad.style.top=this.Bc?wi.ToolbarHeightConsumption+"px":"0px"),this.Cc.appendChild(this.Ad),this.Ed=document.createElement("div"),this.Ed.style.bottom="0px",this.Ed.style.height=wi.StatusbarHeight+"px",this.Ed.style.left="0px",this.Ed.style.right="0px",this.Ed.style.position="absolute",this.Ed.style.borderTopColor="#C6C6C6",this.Ed.style.borderTopWidth=wi.StatusbarBorderTop+"px",this.Ed.style.borderTopStyle="solid",this.Ed.style.backgroundColor="#FFFFFF",this.Cc.appendChild(this.Ed),this.Lc=!0),this.od()&&this.Fd()},this.Fd=()=>{if(this.od()){this.Fo.ULS.Ci(596456520,t.H,e.Info,"Adjusting Boot container for Edit View"),this.kc&&this.Fo.ULS.Ci(596129762,t.H,e.Warning,"No chrome mode encountered in Edit App");const i=this.kc?wi.RibbonHeightNoChrome:wi.RibbonHeightEdit;this.kc?this.Id.style.top=wi.RibbonHeightNoChrome+"px":(this.Id.style.top=wi.RibbonHeightEdit+"px",this.Cd.style.height=wi.ToolbarLowerHeightEdit+"px",this.Cd.style.top=wi.HeaderHeight+wi.ToolbarUpperHeightEdit+"px",this.Td.style.height=wi.ToolbarUpperHeightEdit+"px",this.Td.style.backgroundColor="#F4F4F4",this.Cd.style.backgroundColor="#F4F4F4"),this.Ad.style.top=i+wi.FishbowlBorderTop+"px",this.Id.style.left=wi.ShapePanelWidthWithBorder+"px",this.Ed.style.left=wi.ShapePanelWidthWithBorder+"px",this.gd(i)}},this.yd=()=>{this.Lc&&(this.Fo.ULS.Ci(596449229,t.H,e.Info,"Disabling boot container"),this.Lc=!1,this.mc&&this.mc.showApplicationFrame(),this.Vd(),this.Xc=!0,this.Fo.ULS.Ci(595935319,t.H,e.Info,"Ready to send doc data empty response."),this.Zc&&this.mc&&this.mc.sendWACDataPostMessage(this.Pd),this.mc&&this.mc.notifyFastPreviewFailed())},this.Vd=()=>{this.Cc&&(this.Cc.style.display="none",this.Jc=!1)},this.Rd=i=>{if(this.Lc&&(this.Fo.ULS.Ci(596449230,t.H,e.Info,"Switching to Wopi App"),this.mc&&this.mc.showApplicationFrame(),window.setTimeout(this.Vd,0)),i){const s=parseInt(i[Mi.maxStorageQuotaSettingName],10),o=parseInt(i[Mi.minEvictTimePeriodSettingName],10);s>0?this.Xh&&(window.setTimeout((()=>this.Xh.SaveDocument(this.xd,this.Wd)),Mi.documentSaveIdleTimeInMs),window.setTimeout((()=>Mi.EvictStaleCache(1024*s*1024,24*o*60*60*1e3,this.Fo)),Mi.cacheEvictIdleTimeInMs)):(this.Fo.ULS.Ci(595903509,t.H,e.Info,"Evicting all cache as per app settings."),Mi.EvictStaleCache(0,0,this.Fo))}},this.ud=()=>{const i=M(),s=this.Ud(this.$c.Url,fi.FastViewJson),o=t=>this.Md(t),n=()=>this.Dd();if(this.Tc.onload=()=>{const s=M()-i;this.Fo.ULS.Ci(596464084,t.H,e.Info,`Time spent in getting Image response: ${s}(ms)`),n()},this.Tc.onerror=()=>{this.Fo.ULS.Ci(596464085,t.H,e.Error,"Failed to download the first page image"),this.zc=!1,this.qc=!1,this.yd()},(!bi.getBRSValue(bi.IsFastViewCacheInTeamsDisabled)||J()!==$.TeamsElectron)&&this.Xh&&this.Xh.IsCacheAvailable())return this.qc=!0,this.xc=()=>this.Xh.DecryptAndValidate(((t,i)=>{this.Wd=i,this.Tc.setAttribute("src",this._ImageDataFormat.replace("{0}",i)),o(t)}),(()=>{this.zc=!1,this.qc=!1,this.Xh.DeleteDocument(),this.yd()})),void(this.Uc&&(this.kd=!0));Ot.sendXmlHttpRequest("GET",s,!0,(i=>{o(i),this.Fo.ULS.Ci(596464082,t.H,e.Info,"Successfully handled doc view response")}),(()=>{this.Fo.ULS.Ci(596464083,t.H,e.Error,"Failed to get doc view response"),this.zc=!1,this.yd()}),fi.FastViewJson,this.Fo),this.Tc.src=this.Ud(this.$c.Url,fi.FastViewImage),this.kd=!0},this.pd=()=>{const i=window.devicePixelRatio>Xi.highDpiThreshold?fi.docInfoHighDpi:fi.docInfoNormal,s=this.Ud(this.$c.Url,i);Ot.sendXmlHttpRequest("GET",s,!0,(i=>{this.Fo.ULS.Ci(596121059,t.H,e.Info,`Received doc info json response. Size: ${i.length}`)}),(()=>{this.Fo.ULS.Ci(596121088,t.H,e.Error,"Failed to get doc info response")}),i,this.Fo,!0)},this.Md=i=>{try{this.xd=i,this.Od=JSON.parse(i),null==this.Od.Width&&(this.Fo.ULS.Ci(596115793,t.H,e.Info,"New format of doc view. Filling the old params."),this.Od.Width=this.Od.Pages[0].PageImage.Width,this.Od.Height=this.Od.Pages[0].PageImage.Height,this.Od.OffsetX=this.Od.Pages[0].PageImage.OffsetX,this.Od.OffsetY=this.Od.Pages[0].PageImage.OffsetY,this.Od.Scale=this.Od.Pages[0].PageImage.Scale)}catch(i){return this.Fo.ULS.Ci(596464086,t.H,e.Error,`Unable to parse JSON response: ${F(i)}`),void this.yd()}this.Bd=this.$d(this.Od.PageWidth,this.Od.PageHeight),this.Nd(this.Od.PageWidth,this.Od.PageHeight,this.Bd),this.Hd(this.Od.Height,this.Od.OffsetX,this.Od.OffsetY,this.Bd)},this.ad=i=>(this.Fo.ULS.Ci(595935320,t.H,e.Info,"WAC is ready to receive Doc Data."),this.Zc=!0,!this.Xc&&this.kd||this.mc.sendWACDataPostMessage(this.Pd),i),this.Dd=()=>{this.Gc=!0,this.jc&&this.Fc()},this.$d=(t,i)=>{const e=96*wi.FishbowlMarginInches,s=96*wi.FishbowlMarginInches,o=(this.Id.offsetWidth-e)/(96*t),n=(this.Id.offsetHeight-s)/(96*i);return Math.min(o,n)},this.Nd=(t,i,e)=>{const s=this.Id.offsetWidth-96*t*e,o=this.Id.offsetHeight-96*i*e;this.bd.style.width=96*t*e+"px",this.bd.style.height=96*i*e+"px",this.bd.style.backgroundColor="white",Fi(this.Ch)||(this.bd.style.borderColor="#C6C6C6",this.bd.style.borderWidth="1px",this.bd.style.borderStyle="solid",this.bd.style.boxShadow="0px 0px 20px #C6C6C6"),this.bd.style.position="absolute",this.bd.style.top=o/2+"px",this.bd.style.left=s/2+"px"},this.Hd=(t,i,e,s)=>{this.Tc.style.position="absolute",this.Tc.style.left=96*i*s+"px",this.Tc.style.top=this.bd.clientHeight-96*(t+e)*s+"px",this.jc=!0,this.Gc&&this.Fc()},this.Fc=()=>{if(this.mc&&this.mc.IsBootComplete())this.Fo.ULS.Ci(596129763,t.H,e.Warning,"WOPI Boot already completed, not switching to Fast View");else if(this.mc&&this.mc.IsPageViewLoaded())this.Fo.ULS.Ci(595969243,t.H,e.Warning,"WOPI Page View already loaded, not switching to Fast View");else{if(bi.getBRSValue(bi.FastViewForMRUFixEnabledBRSKey)&&this.vc!==Yi.Active)return this.Fo.ULS.Ci(592470212,t.H,e.Info,"MakeFastViewVisible called in inactive VisioApplication, skipping it for now"),void(this.Ec=!0);if(this.Ld=this.Tc.height,this.Jd=this.Tc.width,this.Tc.width=96*this.Od.Width*this.Bd,this.Tc.height=96*this.Od.Height*this.Bd,this.Tc.style.visibility="visible",this.Cc.style.display="block",this.Cc.style.visibility="visible",this.Jc=!0,this.mc&&this.mc.hideApplicationFrame(),this.Gd=new Date,this.Kc=!0,this.Fo.ULS.Ci(596453598,t.H,e.Info,`Fast View Visible (PLT) Time: ${this.Gd.getTime()}`),this.Ch===gi.EDIT&&this.jd){const i=this.Gd.getTime()-this.jd;this.Fo.ULS.Ci(596452765,t.H,e.Info,`Fast View Switch To Edit Visible (PLT) Time: ${i}`)}window.setTimeout(this.zd,di),(!this.Wd||this.Wd.length<=0)&&(this.Wd=Ri(this.Tc,this.Jd,this.Ld)),this.Pd[fi.FastViewImage]=this.Wd,this.Pd[fi.FastViewJson]=this.xd,this.Xc=!0,this.Fo.ULS.Ci(595935321,t.H,e.Info,"Doc Data is ready to send with Post Message."),this.Zc&&this.mc.sendWACDataPostMessage(this.Pd),this.Fo.ULS.Ci(595907484,t.H,e.Info,`Loaded from browser cache: ${this.qc}`)}},this.zd=()=>{this.mc&&!this.mc.IsBootComplete()&&(this.Fo.ULS.Ci(596129792,t.H,e.Warning,`WOPI boot taking too long, time since FastView: ${di}`),this.Rd(null))},this.nd=(i,s)=>{this.Fo.ULS.Ci(596457106,t.H,e.Info,`Initialization succeeded Time: ${M()}`),s&&s.VisioEarlyToolbarEnabled&&"true"===s.VisioEarlyToolbarEnabled.toString().toLowerCase()?this.Fo.ULS.Ci(595654606,t.H,e.Verbose,"Early toolbar enabled, so skipping switching to visioframe here"):this.Rd(s),i.cacheAboutToExpire=!1,this.zc&&!i.cacheHit&&(i.cacheAboutToExpire=!0),i.cacheHit=this.zc,i.documentLoadedFromWopiPrecheckInfo=this.Kc,this.Kc&&(i.documentLoadedTime=this.Gd.getTime()),this.Ac.stop();const o=this.Ac.getVisibilityChangeEvents();if(null!=o&&o.length>0){for(const t of o)if("hidden"===t?.visibility){i.documentLoadedWithTabSwitch=!0;break}this.Fo.ULS.Ci(596457107,t.H,e.Info,"Visibility Change Events:"+JSON.stringify(o))}this.Jh.pageStateObserver.dispose(),this.Jh.fnOnInitializeSuccess(this,i),this.qd(i),Z("visio",this.Fo),this.Fo.ULS.flush(),x(this.Jh.remoteTelemetryUrl,Tt,"bootSuccess")},this.rd=(i,s)=>{this.Fo.ULS.Ci(596464088,t.H,e.Error,`Initialize failed due to error ${JSON.stringify(i)}`),this.Rd(null),s.cacheHit=this.zc,s.documentLoadedFromWopiPrecheckInfo=this.Kc,this.Ac.stop(),this.Jh.pageStateObserver.dispose(),this.Jh.fnOnInitializeFailure({errorType:ct.AppInitError,errorObject:i},s),this.qd(s),this.Fo.ULS.flush(),x(this.Jh.remoteTelemetryUrl,Tt,"bootFailure")},this.Ud=(t,i)=>{if(!t||-1===t.indexOf("{0}"))throw new TypeError("invalid content URL");if(!i)throw new TypeError("invalid content id");return decodeURI(t).replace("{0}",i)},this.qd=i=>{i&&(Ci(this.Jh.applicationUrl)||ie(this.Jh.diagnostics.HostInitDiagnostics,i,this.Fo),this.Fo.ULS.Ci(595981388,t.H,e.Info,JSON.stringify({BootDiagnostics:i,hostDiagnostics:this.Jh.diagnostics.HostInitDiagnostics,navigationStartTime:xi(),isJSAPIV2:"false",localCacheHit:this.qc?"true":"false",compressedView:this.Od&&this.Od.IsCompressed?"true":"false",backgroundBoot:Ci(this.Jh.applicationUrl),appMode:this.Ch.toString()})),window._pageTimings=window._pageTimings??{},i.documentLoadedTime&&this.Jh.diagnostics.HostInitDiagnostics?.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_PLT=i.documentLoadedTime-this.Jh.diagnostics.HostInitDiagnostics?.hostInitializeCallTime),i.appCompletedTime&&this.Jh.diagnostics.HostInitDiagnostics?.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_ILT=i.appCompletedTime-this.Jh.diagnostics.HostInitDiagnostics?.hostInitializeCallTime))},this.Qc=i=>{this.Fo.ULS.Ci(595654607,t.H,e.Info,`${JSON.stringify(i)}`),(this.Mc&&this.Ch===gi.EDIT||i&&i.Settings&&i.Settings.VisioEarlyToolbarEnabled&&"true"===i.Settings.VisioEarlyToolbarEnabled.toString().toLowerCase())&&this.Rd(i.Settings)},this.Kd=new Date,this.Jh=i,this.Sd=n,this.Ac=o,this.Fo=s,this.Ch=r,this.fc=h,this.mr=a,this.vc=d,this.dc=new at(s),this.Yc=f(this.Jh.applicationUrl,"uih"),this.Yc&&(this.Yc=this.Yc.toLowerCase()),this.Ec=!1,this.kh=l,this.Fo.ULS.Ci(596457105,t.H,e.Info,`Created visio application Time: ${this.Kd.getTime()}`),this.Pd={},this.kd=!1,Promise&&(this.yc=new Promise((t=>this.hd=t)));let u=-1!==i.applicationUrl.indexOf("wdDisableBCache");i.sessionInformation&&i.sessionInformation.WdParams&&(u=void 0!==i.sessionInformation.WdParams.wdDisableBCache),u||(this.Xh=Mi.Create(i.sessionInformation.UserId,i.wopiInfo?.WopiSrc,i.wopiPrecheckInfo.ETag,s)),this.Vc=ee.isInstantBootMode(this.Ch,this.Jh.applicationUrl),this.Ic=c,this.isBackground()||this.gc()}}class se{getDelayLoadingGif(){return this.Xd?`${this.Zd}/wise/owl/delay.gif`:`${this.Zd}${_i}s/${this.Yd}_resources/1033/delay.gif`}getLoadingSpinnerGif(){return this.Xd?`${this.Zd}/wise/owl/progress.gif`:`${this.Zd}${_i}s/${this.Yd}_resources/1033/progress16.gif`}constructor(t,i){this.Xd=!!i&&function(t){return!!t.includes("wise")}(i),this.Zd=u(this.Xd&&i?i:t),this.Yd=this.Xd?"":function(t){if(!t)throw new Error("Build number not available");const i=t.split(".");if(4!==i.length)throw new Error("Build number has incorrect format");return i[0]+i[2]+i[3]}(A())}}class oe{registerEventHandler(t){this.mr.push(t)}removeEventHandler(t){if(t){const i=this.mr.indexOf(t);this.mr.splice(i,1)}}stop(){document.removeEventListener("visibilitychange",this.Qd)}getVisibilityChangeEvents(){return this.tl}dispose(){this.stop(),this.mr=[],this.tl=[]}constructor(){if(this.tl=[],this.mr=[],this.Qd=()=>{const t={visibility:document.visibilityState,time:M(),initialState:!1};this.tl.push(t);for(const i of this.mr)i&&i(t)},"hidden"===document.visibilityState){const t={visibility:document.visibilityState,time:M(),initialState:!0};this.tl.push(t)}document.addEventListener("visibilitychange",this.Qd)}}class ne{buildApplication(){return this.il(Yi.Active)}dispose(){this.el&&(this.el.Dispose(),this.el=null),this.sl()}constructor(i,s,o,n,r,h,c){if(this.el=null,this.ol=null,this.nl=null,this.rl=null,this.al=null,this.mr={},this.hl=()=>{const i=this.cl;let s=i.applicationUrl;if("consumptionview"!==f(s.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");s=g(s,"VisioView","EditView",!0),s=g(s,si,"1",!0),i.applicationUrl=g(s,ei,"1",!0);const[o,n]=y();i.sessionId=o;const r=N({remoteUlsEndpoint:this.cl.applicationBasePath+a,sessionId:o,uploadCadenceInMs:re}),h=JSON.parse(JSON.stringify(i.sessionInformation));delete h.OwnerId,delete h.SiteId,delete h.TenantId,delete h.UserId,delete h.Upn,delete h.WebId,r.ULS.Ci(595682589,t.H,e.Info,`VisioApplicationManager - initializing background Edit session.\n      Init Time: ${M()},\n      newGuidLogging: ${JSON.stringify(n)},\n      loggableSessionInfo: ${JSON.stringify({hostSessionInformation:h})}`),this.nl=i,this.rl=r,this.al=gi.EDIT},this.il=i=>{const s=i===Yi.Background;this.Fo.ULS.Ci(595682590,t.H,e.Info,`Visio Application Manager appMode: ${this.Ch}, isBackground: ${s}`);let o=this.Fo,n=this.cl;try{const t=this.qa;let e=this.Ch;s&&(this.hl(),n=this.nl,o=this.rl,e=this.al);const r=new ee(n,o,this.Ac,this.Sd,e,this.mr,t,this.appUnloadHandler,i);return s?this.ol=r:(this.el=r,this.el.addTimerTagForBoot(Nt)),r.Boot(),r}catch(i){return this.Fo.ULS.Ci(595682591,t.H,e.Error,`Background Edit App ${ct.AppInitError}: ${F(i)}`),o&&o.ULS.flushOnClose(),void n.fnOnInitializeFailure({errorType:ct.AppInitError,errorObject:i})}},this.appUnloadHandler=()=>{this.el&&this.el.isActive()&&this.el.Dispose(!0)},this.dl=()=>{if(this.ll(yt.hr),this.Fo.ULS.Ci(595682592,t.H,e.Info,"ApplicationManager Visio ViewFrame CLTComplete PostMessage Received"),this.Ch!==gi.VIEW)throw new TypeError("Active Visio Application mode is not view but received ConsumptionCLTCompletePost Message");const i=this.el.getWopiInfo();if(!i)throw new TypeError("ApplicationManager wopiInfo is null");if(this.Fo.ULS.Ci(595682593,t.H,e.Info,"Building Background Edit VisioApplication"),this.il(Yi.Background),!this.ol)throw new TypeError("After BuildApplication backgroundEditApp is null");this.ol.Complete(i,this.el.getNewFileInfo())},this.ul=()=>{this.ol?this.sl():this.Fo.ULS.Ci(595642373,t.H,e.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")},this.pl=i=>{if(this.ll(yt.cr),this.Fo.ULS.Ci(595682594,t.H,e.Info,`ApplicationManager Received SwitchMode PostMessage from Visio View Frame appMode:${this.Ch}`),!this.ol)return this.Fo.ULS.Ci(595682466,t.H,e.Warning,"handleVisioViewFrameSwitchMode backgroundEditApp is null"),void this.ll(yt.lr);this.rl?this.ol.updateVisibilityMetrics(new oe):this.Fo.ULS.Ci(595616995,t.H,e.Warning,"handleVisioViewFrameSwitchMode bgLogger is null"),this.el.unregisterAppLevelPostMessageHandlers(),this.ol.registerAppLevelPostMessageHandlers(),this.el.removeFastView(),this.ol.updateModeSwitchClickTime(),this.ol.showFasttViewForEditApp(),this.ol.resetInnerApplicationFrameId(),this.ol.addTimerTagForBoot(Nt),this.qa.registerMessagePayloadHandler(it.no,this.ml),this.wl(yt.dr,i)},this.wl=(t,i)=>{this.fl(t,i,1)},this.fl=(i,s,o)=>{if(o>3){if(this.Fo.ULS.Ci(595650624,t.k,e.Error,`Attempted to call mode switch, but received no ack from the frame. MessageId: ${i}, Time: ${M()}`),i!==yt.dr)return void this.Fo.ULS.Ci(595650626,t.k,e.Warning,`Invalid message. MessageId: ${i}`);if(!this.gl)return this.Fo.ULS.Ci(595650625,t.k,e.Error,`Falling back to legacy way of switching for message timeout. Message: ${i}`),void this.ll(yt.lr)}this.Fo.ULS.Ci(595650627,t.k,e.Info,`Sending mode switch message to frame. MessageId: ${i}, Attempt number: ${o}, Time: ${M()}`),this.vl(i,s),window.setTimeout((()=>this.Sl(i,s,o)),1e3)},this.Sl=(i,s,o)=>{i===yt.dr?this.gl||(this.Fo.ULS.Ci(595650629,t.k,e.Info,`Timed out with no ack. MessageId: ${i}`),this.fl(i,s,o+1)):this.Fo.ULS.Ci(595650628,t.k,e.Warning,`Invalid message. MessageId: ${i}`)},this.ll=(t,i=null)=>{if(!this.el)throw new TypeError("visio Active Application is null");if(!this.el.getInnerApplicationFrame())throw new TypeError("visio Active Application Frame is null");this.qa.sendPostMessage(this.el.getInnerApplicationFrame(),t,i)},this.vl=(t,i=null)=>{if(!this.ol)throw new TypeError("visio Background Edit Application is null");if(!this.ol.getInnerApplicationFrame())throw new TypeError("visio Background Edit Application Frame is null");this.qa.sendPostMessage(this.ol.getInnerApplicationFrame(),t,i)},this.Il=()=>{if(!this.el||!this.ol)throw new TypeError("HandleEditILTCompletePostMessage visioApplicationActive or backgroundEditApp is null");this.el.Dispose(),this.el=null,this.ol.activate(),this.el=this.ol,this.Fo=this.rl,this.Ch=this.al,this.cl=this.nl,this.ol=null,this.rl=null,this.al=null,this.nl=null},this.ml=i=>{if(this.Fo.ULS.Ci(595682624,t.H,e.Info,"ApplicationManager Visio_ACK_ModeSwitch_ToHost Received on ack to Visio_SwitchMode_FromHostFrame"),this.gl=!0,i){if(i.IsSuccess)return void this.Il();this.Fo.ULS.Ci(595645409,t.H,e.Warning,`${JSON.stringify(i)}`)}this.ll(yt.lr)},this.sl=()=>{this.ol&&(this.ol.Dispose(),this.ol=null)},this.cl=i,this.Fo=s,this.Ac=o,this.Sd=n,this.Ch=r,this.qa=h,this.mr=c,this.gl=!1,this.Yc=f(this.cl.applicationUrl,"uih"),this.Yc&&(this.Yc=this.Yc.toLowerCase()),r!==gi.VIEW)throw new TypeError("VisioApplicationManager appMode is not view");this.qa.registerMessagePayloadHandler(it.so,this.dl),this.qa.registerMessagePayloadHandler(it.oo,this.pl),this.qa.registerMessagePayloadHandler(ne.bl,this.ul)}}ne.bl="Visio_DisposeBkgFrame",function(t){t[t.Active=0]="Active",t[t.Background=1]="Background",t[t.Disposed=2]="Disposed"}(Yi||(Yi={})),function(t){t[t.Fastfood=0]="Fastfood",t[t.MSIT=1]="MSIT",t[t.Production=2]="Production"}(Qi||(Qi={}));const re=6e4;var ae,he,ce;!function(t){t.Unknown="UNKNOWN",t.Initialized="INITIALIZED",t.Prebooted="PREBOOTED",t.Booting="BOOTING",t.Booted="BOOTED",t.Failed="FAILED",t.Disposing="DISPOSING",t.Disposed="DISPOSED"}(ae||(ae={})),function(t){t.appReboot="appReboot",t.boot="boot",t.closeTab="closeTab",t.createNew="createNew",t.dispose="dispose",t.frameTrust="frameTrust",t.getAuthToken="getAuthToken",t.getHostKeyValue="getHostKeyValue",t.handleBootState="handleBootState",t.postWacToken="postWacToken",t.rename="rename",t.setOverlayContent="setOverlayContent",t.storeHostKeyValue="storeHostKeyValue",t.switchMode="switchMode",t.updateBootComplete="updateBootComplete",t.setWacFlightValue="setWacFlightValue"}(he||(he={})),function(t){t.AccessibilityLoopCompleted="AccessibilityLoopCompleted",t.ActionCompleted="ActionCompleted",t.BrowserEvent="BrowserEvent",t.CAAEMessage="CAAEMessage",t.Close="Close",t.InitEnd="InitEnd",t.Conversation="Conversation",t.CopyAndEdit="CopyAndEdit",t.CreateNewDocument="CreateNewDocument",t.Download="Download",t.PreDownloadFileInClient="PreDownloadFileInClient",t.Edit="Edit",t.Error="Error",t.FileEmbed="FileEmbed",t.FileProperties="FileProperties",t.FileRenamed="FileRenamed",t.FileVersions="FileVersions",t.FrameStateChanged="FrameStateChanged",t.FrameTrust="FrameTrust",t.GetAccessToken="GetAccessToken",t.GetAuthToken="GetAuthToken",t.GetCustomAuthConfig="GetCustomAuthConfig",t.GetWopiInfoFromUrl="GetWopiInfoFromUrl",t.GetDavUrlFromIds="GetDavUrlFromIds",t.ModeSwitched="ModeSwitched",t.MoveToFolder="MoveToFolder",t.OpenInMobileApp="OpenInMobileApp",t.OpenInBrowser="OpenInBrowser",t.OpenInClient="OpenInClient",t.PageChanged="PageChanged",t.PushState="PushState",t.Reboot="Reboot",t.RedeemForCommenting="RedeemForCommenting",t.RefreshSessionInfo="RefreshSessionInfo",t.ReplyWithChanges="ReplyWithChanges",t.ReportAbuse="ReportAbuse",t.SharedFilePicker="SharedFilePicker",t.SaveStatus="SaveStatus",t.Share="Share",t.ShareForm="ShareForm",t.SignIn="SignIn",t.SplashScreenShown="SplashScreenShown",t.UserAccessAndPermissions="UserAccessAndPermissions",t.UserActivity="UserActivity",t.UserEditActivity="UserEditActivity",t.Workflow="Workflow",t.ZoomChanged="ZoomChanged",t.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",t.LoadingStatus="LoadingStatus",t.SwitchNotebook="SwitchNotebook",t.FailedBootCheckFileInfo="FailedBootCheckFileInfo",t.GetTeamsUsers="GetTeamsUsers",t.SendTeamsUserMention="SendTeamsUserMention",t.NavigateBackToHost="NavigateBackToHost",t.GetClientUrlComplete="GetClientUrlComplete",t.GetWebUrlComplete="GetWebUrlComplete",t.CopyLinkComplete="CopyLinkComplete",t.SendConversationId="SendConversationId",t.CloseTeamsConversation="CloseTeamsConversation",t.PageLoaded="PageLoaded",t.FrameChanged="FrameChanged",t.PrintRedirect="PrintRedirect",t.RequestFullScreen="RequestFullScreen",t.ShowCopilotBottomBar="ShowCopilotBottomBar",t.ExternalDocumentShare="ExternalDocumentShare",t.AddNAATrustedOrigins="AddNAATrustedOrigins"}(ce||(ce={}));const de={[Ft.boot]:{_l:he.boot},[Ft.createNew]:{_l:he.createNew},[Ft.dispose]:{_l:he.dispose},[Ft.postWacToken]:{_l:he.postWacToken},[Ft.rename]:{_l:he.rename},[Ft.switchMode]:{_l:he.switchMode},[it.Ae]:{_l:he.handleBootState},[it.Ve]:{_l:he.closeTab},[it.Je]:{_l:he.frameTrust},[it.je]:{_l:he.getAuthToken},[it.qe]:{_l:he.getHostKeyValue},[it.cs]:{_l:he.appReboot},[it.So]:{_l:he.setWacFlightValue},[it.vs]:{_l:he.setOverlayContent},[it._s]:{_l:he.storeHostKeyValue},[it.Es]:{_l:he.updateBootComplete},[Ft.blurFocus]:{Tl:yt.Sn},[Ft.continueAccessibilityLoop]:{Tl:yt.Cn},[Ft.grabFocus]:{Tl:yt.An},[Ft.moveToFolder]:{Tl:yt.Qe},[Ft.popState]:{Tl:yt.Pn},[Ft.sendChannelId]:{Tl:yt.Rn},[Ft.sendConvId]:{Tl:yt.xn},[Ft.teamsUsersReply]:{Tl:yt.Wn},[Ft.teamsUserMentionReply]:{Tl:yt.Un},[Ft.backButtonPressed]:{Tl:yt.Mn},[Ft.searchInvoked]:{Tl:yt.Dn},[Ft.bootInterrupted]:{Tl:yt.kn},[Ft.getClientUrl]:{Tl:yt.On},[Ft.getWebUrl]:{Tl:yt.Bn},[Ft.sendAccessToken]:{Tl:yt.Nn},[Ft.sendAuthToken]:{Tl:yt.Hn},[Ft.sendHWRTelemetry]:{Tl:yt.ar},[Ft.sendCustomAuthConfig]:{Tl:yt.Ln},[Ft.sendDavUrl]:{Tl:yt.Kn},[Ft.sendEmbeddedViewUrl]:{Tl:yt.Gn},[Ft.sendFrameTrustResult]:{Tl:yt.Je},[Ft.sendSessionInfo]:{Tl:yt.jn},[Ft.sendUserAccessAndPermissions]:{Tl:yt.zn},[Ft.sendWopiInfo]:{Tl:yt.qn},[Ft.signalShared]:{Tl:yt.rr},[Ft.completeSharedFilePicker]:{Tl:yt.ws},[it.be]:{Cl:ce.AccessibilityLoopCompleted},[it._e]:{Cl:ce.ActionCompleted},[it.Fe]:{Cl:ce.BrowserEvent},[it.Ws]:{Cl:ce.CAAEMessage},[it.ye]:{Cl:ce.Close},[it.Pe]:{Cl:ce.Conversation},[it.Re]:{Cl:ce.CopyAndEdit},[it.xe]:{Cl:ce.CreateNewDocument},[it.Ue]:{Cl:ce.Download},[it.Me]:{Cl:ce.PreDownloadFileInClient},[it.De]:{Cl:ce.Edit},[it.ke]:{Cl:ce.Error},[it.Oe]:{Cl:ce.FileEmbed},[it.Be]:{Cl:ce.FileProperties},[it.$e]:{Cl:ce.FileRenamed},[it.He]:{Cl:ce.FileVersions},[it.Ge]:{Cl:ce.GetAccessToken},[it.Xe]:{Cl:ce.GetDavUrlFromIds},[it.ze]:{Cl:ce.GetCustomAuthConfig},[it.Ke]:{Cl:ce.GetWopiInfoFromUrl},[it.Le]:{Cl:ce.FrameStateChanged},[it.Ye]:{Cl:ce.ModeSwitched},[it.Qe]:{Cl:ce.MoveToFolder},[it.ts]:{Cl:ce.OpenInMobileApp},[it.es]:{Cl:ce.OpenInBrowser},[it.ss]:{Cl:ce.OpenInClient},[it.os]:{Cl:ce.PageChanged},[it.hs]:{Cl:ce.PushState},[it.ds]:{Cl:ce.RedeemForCommenting},[it.ls]:{Cl:ce.RefreshSessionInfo},[it.us]:{Cl:ce.ReplyWithChanges},[it.ws]:{Cl:ce.SharedFilePicker},[it.ps]:{Cl:ce.ReportAbuse},[it.fs]:{Cl:ce.SaveStatus},[it.Ss]:{Cl:ce.Share},[it.Is]:{Cl:ce.ShareForm},[it.bs]:{Cl:ce.SignIn},[it.ys]:{Cl:ce.UserAccessAndPermissions},[it.Vs]:{Cl:ce.UserActivity},[it.Ps]:{Cl:ce.UserEditActivity},[it.Rs]:{Cl:ce.Workflow},[it.xs]:{Cl:ce.ZoomChanged},[it.Hs]:{Cl:ce.AcquireOAuthTokenTeams},[it.Ze]:{Cl:ce.LoadingStatus},[it.Ls]:{Cl:ce.SwitchNotebook},[it.Js]:{Cl:ce.FailedBootCheckFileInfo},[it.Gs]:{Cl:ce.GetTeamsUsers},[it.js]:{Cl:ce.SendTeamsUserMention},[it.zs]:{Cl:ce.NavigateBackToHost},[it.qs]:{Cl:ce.GetClientUrlComplete},[it.Ks]:{Cl:ce.GetWebUrlComplete},[it.Xs]:{Cl:ce.CopyLinkComplete},[it.Zs]:{Cl:ce.SendConversationId},[it.Ys]:{Cl:ce.CloseTeamsConversation},[it.Qs]:{Cl:ce.PageLoaded},[it.fo]:{Cl:ce.InitEnd},[it.vo]:{Cl:ce.SplashScreenShown},[it.Io]:{Cl:ce.PrintRedirect},[it.bo]:{Cl:ce.RequestFullScreen},[it._o]:{Cl:ce.ShowCopilotBottomBar},[it.To]:{Cl:ce.ExternalDocumentShare},[it.Co]:{Cl:ce.AddNAATrustedOrigins}};class le{get diagnostics(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}}raiseEvent(i,s){this.logger.ULS.Ci(574654541,t.k,e.Info,`Raising event: ${i}`);try{this.Al(i,s)}catch(i){this.logger.ULS.Ci(593506838,t.k,e.Error,`Event handler error: ${F(i)}`)}}addActionHandler(t,i){this.El[t]||(this.El[t]=[]),this.El[t].push(i)}removeActionHandler(t,i){const e=this.El[t];if(e&&e.length>0){const t=e.indexOf(i);t>-1&&e.splice(t,1)}}run(i,s,o){if(this.state===ae.Disposed&&this.backgroundSession)return this.logger.ULS.Ci(525203609,t.k,e.Info,`Redirecting to background session: ${i}`),this.backgroundSession.run(i,s,o);const n=[],r=this.El[i];if(r&&r.length>0)n.push(this.Fl(i,s));else{const r=de[i];if(r){const a=r._l,h=r.Tl;if(a){this.logger.ULS.Ci(574654542,t.k,e.Info,`Running flow: ${a}`);const r=this.yl[a](i,s,this,this.Vl[a],o).catch((t=>(this.Pl(a,t),{completion:"failure",errorSource:"jsapi",error:t})));n.push(r)}else h&&(this.container&&this.container.postMessage(h,s),n.push(Promise.resolve({completion:"success"})))}else n.push(Promise.resolve({completion:"failure"})),this.logger.ULS.Ci(593500189,t.k,e.Warning,`Unhandled command: ${i}`)}return Promise.race(n)}dispose(){if(this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.Ai.dispose(),this.pageStateObserver.dispose(),this.authTokenTrustValidator.dispose(),this.El={},!this.pendingReboot){const t=this.application.sessions,i=t.indexOf(this.session);i>-1&&t.splice(i,1)}}constructor(i,s,o,n,r,a,h){this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.appBootState="Unknown",this.pendingReboot=!1,this.skipWopiValidation=!1,this.skipFileNameCheck=!1,this.appContext={},this.isLoggerFromOwl=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.remoteTelemetryUrl="",this.El={},this.onMessage=i=>{const s=i.MessageId,o=i.Values||{},n=this.El[s];if(n&&n.length>0)this.Fl(s,o);else{const n=de[s];if(n){const r=n._l,a=n.Cl;r?(this.logger.ULS.Ci(574654543,t.k,e.Info,`Running flow: ${r}`),this.yl[r](s,o,this,this.Vl[r]).catch((t=>{this.Pl(r,t)}))):a&&(a===ce.Share&&(o.sendTimeAsClickTime=i.SendTime),this.raiseEvent(a,o))}}},this.Pl=(i,s)=>{this.logger.ULS.Ci(596459925,t.k,e.Error,`${i} flow error: ${F(s)}`),this.remoteTelemetryUrl&&x(this.remoteTelemetryUrl,this.appInfo.name,"flowException")},this.Fl=(i,s)=>{this.logger.ULS.Ci(574654544,t.k,e.Info,`Dispatching action: ${i}`);const o=this.El[i].slice().reverse();for(let n=o.length-1;n>-1;n-=1)try{o[n](i,s)}catch(s){this.logger.ULS.Ci(596444186,t.k,e.Error,`${i} action handler error: ${F(s)}`)}return Promise.resolve({completion:"success"})},this.state=ae.Unknown;const[c,d]=y();this.isLoggerFromOwl=!!o.logger,this.logger=o.logger??N(),this.logger.ULS.Ci(593506837,t.k,e.Info,JSON.stringify(d)),this.sessionId=c,this.hostSessionId=o.hostSessionId,this.host=i.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=i.user,this.bootstrapperUrl=i.bootstrapperUrl,this.ui=i.ui||{},this.viewMode=i.viewMode,this.application=n,this.appInfo=s,this.session=r,this.featureManager=ft(i.host.capabilities&&i.host.capabilities.isFeatureEnabledCallback,this.logger),this.Ai=new mt(s.name,this.logger),this.preloader=s.preloader,[this.yl,this.Vl]=a(this.featureManager),this.Al=h,this.clientDiagnostics=Q(),this.pageStateObserver=new vt(this.logger,!0),this.authTokenTrustValidator=new at(this.logger)}}class ue{get id(){return this.Rl.sessionId}get diagnostics(){return this.Rl.diagnostics}run(t,i,e){return this.Rl.run(t,i,e)}boot(t,i){return this.Rl.run(Ft.boot,t,i)}dispose(t){return this.Rl.run(Ft.dispose,void 0,t)}constructor(t,i,e,s,o,n){!function(t){if(!t)throw new TypeError("SessionInitParams");if(!t.hostSessionId)throw new TypeError("HostSessionId")}(e),this.Rl=new le(t,i,e,s,this,n,((t,i)=>o({type:t,data:i,session:this}))),this.Rl.state=ae.Initialized}}class pe{setTargetOrigin(i){const s=u(i).toLowerCase();this.gr&&this.gr!==s&&this.Fo.ULS.Ci(593232847,t.k,e.Warning,`Updating origin: [${T(this.gr)}]->[${T(s)}]`),this.gr=s,this._r=p(s,2),this.Tr=c(s),this.Cr=d(s)}setTargetFrame(t,i){this.xl=t,this.Sr=!!i}setMessageHandler(t){this.Wl=t}removeMessageHandler(){this.Wl=void 0}postMessage(i,s,o){if(!this.xl||!this.xl.contentWindow)return void this.Fo.ULS.Ci(593232848,t.k,e.Error,"Missing target to send message: "+i);this.Fo.ULS.Ci(593232849,t.k,e.Info,"Sending message: "+i);const n={MessageId:i,SendTime:M(),CorrelationId:o,Values:s};this.xl.contentWindow.postMessage(JSON.stringify(n),this.gr)}dispose(){window.removeEventListener("message",this.Ul,!1),this.Wl=void 0}constructor(i,s,o,n){this.gr="",this._r="",this.Tr=!1,this.Cr=!1,this.Sr=!1,this.Ar=!1,this.Ul=i=>{let s,o=!1,n=!0,r="",a=!1;if(this.xl&&this.xl.contentWindow&&(o=!0,n=i.source===this.xl.contentWindow),i.origin&&(r=p(i.origin,2).toLowerCase(),a=r===this._r,!a&&this.Vr&&(r=p(i.origin).toLowerCase(),a=this.Vr.includes(r))),!this.Tr&&(!this.Cr||a&&n)||this.Fo.ULS.Ci(593232850,t.k,e.Info,"Window: available["+o+"] valid["+n+"]; Origin: valid["+a+"] expected["+this._r+"] actual["+r+"]"),!a||this.Sr&&!n)return;try{if("string"!=typeof i.data)return void this.Fo.ULS.Ci(505771930,t.k,e.Info,"Event data is not of type string");s=JSON.parse(i.data)}catch(i){return void this.Fo.ULS.Ci(593232851,t.k,e.Info,`Failed to parse event data: ${F(i)}`)}const h=s.MessageId;if(h){if(this.Fo.ULS.Ci(593232854,t.k,e.Info,`Received message: ${h}, correlation: ${s.CorrelationId}`),h!==it.Ee&&h!==it.Ze||this.setTargetOrigin(i.origin),s.Values&&s.Values.ackExpected&&this.postMessage(yt.fn,void 0,s.CorrelationId),this.Ar&&h===it.po)return window._pageTimings=window._pageTimings??{},void(window._pageTimings[s.Values.name]=s.Values.time);if(this.Wl)try{this.Wl(s)}catch(i){this.Fo.ULS.Ci(594556386,t.k,e.Error,`Message handler error: ${F(i)}`)}else this.Fo.ULS.Ci(591933923,t.k,e.Error,"No message handler")}else(this.Tr||this.Cr)&&this.Fo.ULS.Ci(593232853,t.k,e.Info,"Missing message id")},this.Fo=s,this.setTargetOrigin(i),this.Vr=n,o&&this.setMessageHandler(o),this.Ar=!!window.location?.search?.match(/wdpa=1/gi)||"1"===xt("EnableMetricLogging"),window.addEventListener("message",this.Ul,!1)}}class me{get element(){return this.Ml}get frameId(){return this.Dl}get formId(){return this.kl}get isTopFrameTrusted(){return this.Ol}boot(i,s,o,n,r,a,h){this.Fo=o,this.qa=new pe(i,o,this.Wl,n.additionalReceivingDomainList);const c=n.useAdditionalDiv,d=n.permissionsPolicy;this.Bl&&!c?(this.Bl.setAttribute("allow",d),this.Fo.ULS.Ci(588793045,t.k,e.Info,"Wac frame reused")):(this.Bl=function(t,i,e,s,o,n,r,a,h,c){t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.height="100%",t.style.width="100%";const d=t.ownerDocument,l=d.createElement("iframe");if(l.id=i,l.name=i,l.src="",l.title="Office on the web Frame",l.marginWidth="0",l.marginHeight="0",l.style.top="0",l.style.bottom="0",l.style.left="0",l.style.right="0",l.style.height="100%",l.style.width="100%",l.style.display="block",l.style.position="absolute",l.style.backgroundColor="transparent",l.style.border="none",l.frameBorder="0",l.setAttribute("allowfullscreen","true"),l.setAttribute("allowTransparency","true"),l.setAttribute("allow",e),ki(l,r),s&&(t.style.minHeight=s,l.style.minHeight=s),o&&(t.style.minWidth=o,l.style.minWidth=o),a&&l.setAttribute("role","none"),n){const i=d.createElement("div");i.style.top="0",i.style.bottom="0",i.style.left="0",i.style.right="0",i.style.height="100%",i.style.width="100%",i.style.backgroundColor="#393a3d",i.style.backfaceVisibility="hidden",s&&(i.style.minHeight=s),o&&(i.style.minWidth=o),i.appendChild(l),t.appendChild(i)}else t.appendChild(l);return h&&l.addEventListener("load",h,{once:!0}),c&&l.addEventListener("error",c,{once:!0}),l}(this.Ml,this.Dl,d,n.minHeight,n.minWidth,c,n.isInvisible,n.setNoneRole,a,h),this.Fo.ULS.Ci(588793046,t.k,e.Info,"Wac frame created")),r(),this.qa.setTargetFrame(this.Bl,n.enforceSameWindow),c&&(this.$l=this.Bl.parentElement),n.useFrameFixForTeams&&o.ULS.Ci(509143245,t.k,e.Info,"Frame fix enabled for teams uiHost"),function(t,i,e){m(i,Di.aa,String(e?window.outerHeight:t.offsetHeight)),m(i,Di.ha,String(e?window.outerWidth:t.offsetWidth)),m(i,Di.va,String(G())),m(i,Di.ca,String(j())),m(i,Di.ra,String(q())),m(i,Di.Ta,String(function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch{return!1}}())),m(i,Di.Aa,String(function(){try{return window.matchMedia("(prefers-contrast: more)").matches}catch{return!1}}())),m(i,Di.Ca,String(function(){try{return window.matchMedia("(forced-colors: active)").matches||window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}())),m(i,Di.ja,String(window.innerHeight)),m(i,Di.za,String(window.innerWidth))}(this.Bl,s,n.useFrameFixForTeams),s.parentOrigin=window.origin||"",this.Nl=function(t,i,e,s,o){const n=t.ownerDocument,r=n.createElement("form");r.id=e,r.name=e,r.action=s,r.target=i,r.method="POST";for(const t in o){const i=n.createElement("input");i.type="hidden",i.name=t,i.value=o[t],r.appendChild(i)}return t.appendChild(r),r}(this.Ml,this.Dl,this.kl,i,s),this.Nl.submit()}setVisibility(t){this.Bl&&ki(this.Bl,t)}setMessageHandler(t){this.Wl=t,this.qa&&this.qa.setMessageHandler(t)}setWrapperPostMessage(t){this.Hl=t}removeMessageHandler(){this.Wl=void 0,this.qa&&this.qa.removeMessageHandler()}postMessage(t,i){this.Hl?this.Hl(t,i):this.qa&&this.qa.postMessage(t,i)}dispose(t,i){return new Promise((e=>{if(this.Nl&&(this.Ml.removeChild(this.Nl),this.Nl=void 0),this.qa&&(this.qa.dispose(),this.qa=void 0,this.Wl=void 0),this.Hl&&(this.Hl=void 0),this.Fo=void 0,!this.Bl||!this.$l&&t)e();else{const t=()=>{this.$l?(this.$l.removeChild(this.Bl),this.Ml.removeChild(this.$l)):this.Ml.removeChild(this.Bl),this.Bl=void 0,this.$l=void 0,e()};i?t():(this.Bl.src="about:blank",window.setTimeout(t,0))}}))}constructor(t,i){!function(t){if(!t||!t.appendChild)throw TypeError("Container")}(t),this.Ml=t,this.Dl=i,this.kl=i+"_Form",this.Ol=Oi()}}class we{get name(){return this.Ll.name}get version(){return A()}addEventListener(t){this.Jl.add(t)}removeEventListener(t){this.Jl.remove(t)}createContainer(t){const i=`WacFrame_${this.Ll.name}_${this.containers.length}`,e=new me(t,i);return this.containers.push(e),e}createSession(t){const i=new ue(this.Gl,this.Ll,t,this,this.jl,this.zl);return this.sessions.push(i),i}dispose(t){const i=this.sessions.map((i=>i.dispose(t).catch((t=>{}))));return Promise.all(i).then((t=>(this.Jl.removeAll(),this.sessions=[],this.containers=[],{completion:"success"})))}constructor(t,i,e){this.sessions=[],this.containers=[],this.jl=t=>{this.Jl.dispatch(t)},function(t){if(!t)throw new TypeError("ApplicationInitParams");const i=t.host;if(!i||!i.storageHostName)throw new TypeError("HostInfo");const e=t.user;if(!e||null==e.id)throw new TypeError("UserInfo")}(t),this.Gl=t,this.Ll=i,this.zl=e,this.Jl=new lt,function(t){if(t&&(C.BUILD_NUMBER=t,t.includes("."))){const i=t.split(".");C.BUILD_NUMBER_MINOR=parseInt((i[0]||"").concat((i[1]||"").padStart(3,"0")),10)}}(t.host.owlVersion)}}const fe=(i,s,o,n,r)=>i!==it.cs?Promise.reject("Wrong flow"):new Promise((i=>{let n;if(o.pendingReboot=!0,s.queryOverrides)try{n=JSON.parse(s.queryOverrides)}catch(i){o.logger.ULS.Ci(592217694,t.k,e.Error,`Failed to parse queryOverrides: ${n}`)}o.raiseEvent(ce.Reboot,{...s,previousSessionId:o.sessionId,queryOverrides:n}),i({completion:"success"})}));function ge(t){return!(!(t&&t.source&&t.accessToken)||!t.expiry&&0!==t.expiry)}function ve(t){const i={};m(i,"jsapi","1"),m(i,"jsapiver","v2"),m(i,"corrid",t.sessionId),m(i,"usid",t.sessionId),m(i,"newsession","1"),m(i,"sftc","1"),t.hostSessionId&&m(i,"hid",encodeURIComponent(t.hostSessionId));const e=t.host;e.uiHostName&&m(i,"uih",e.uiHostName),e.uiHostIntegrationType&&m(i,"uihit",encodeURIComponent(e.uiHostIntegrationType)),e.metaUiHostVersion&&m(i,"muv",encodeURIComponent(e.metaUiHostVersion)),e.topOrigin&&m(i,"to",encodeURIComponent(e.topOrigin)),e.isDeeplyNestedAuthSupportedInTeams&&m(i,"dnaa","1");const s=e.capabilities;s&&(s.accessibilityLoop&&m(i,"accloop","1"),s.rebootDoc&&m(i,"sdr",s.rebootDoc.toString()),s.createNewDoc&&m(i,"scnd","1"),s.authToken&&m(i,"sat","1"),window.docAspxMsalEnabled&&"onedrivecom"!==e.uiHostName&&(s.authTokenStrategy="PairwiseBroker"),s.authTokenStrategy&&m(i,"ats",s.authTokenStrategy),s.customAuthConfig&&m(i,"cac","1"),s.refreshAccessToken&&m(i,"rat","1"),s.atMentions&&m(i,"sams","1"),s.moveToFolder&&m(i,"mtf","1"),s.noBrowserModalDialogs&&m(i,"nbmd","1"),s.commonFilePicker&&m(i,"sfp","1"),s.directDownload&&m(i,"sdd","1"),s.directPrint&&m(i,"sdp","1"),s.disableOfficeAddins&&m(i,"doa","1"));const o=t.ui;o.language&&m(i,"ui",encodeURIComponent(o.language)),o.uiEmbed&&m(i,"uiembed","1"),(o.hideHeader||"DocGen"===o.contentAssemblyMode||"Templatization"===o.contentAssemblyMode||"ContentAssemblyEdit"===o.contentAssemblyMode||"ContentAssemblyView"===o.contentAssemblyMode)&&m(i,"hhdr","1"),o.highContrast&&m(i,"hcm",encodeURIComponent(o.highContrast)),o.hideFileLocationPicker&&m(i,"hodflp","1"),o.hideAppLauncherInHeader&&m(i,"halh","1"),o.hideChatInHeader&&m(i,"hch","1"),o.hideMeInHeader&&m(i,"hmh","1"),o.hideSearchInHeader&&m(i,"hsh","1"),o.hideWorkflowInHeader&&m(i,"hwfh","1"),o.hideSettingsInHeader&&m(i,"hsth","1"),o.showAppIconInHeader&&m(i,"sih","1"),o.useNeutralColorInHeader&&m(i,"unh","1"),o.openLinksInNewWindow&&m(i,"onw","1"),o.useDarkTheme&&m(i,"udt","1"),"DocGen"!==o.contentAssemblyMode&&"ContentAssemblyView"!==o.contentAssemblyMode||m(i,"readOnly","1");const n=t.wopi;n&&n.source&&m(i,"wopisrc",encodeURIComponent(n.source));const r=t.bootParams;r&&(r.dataLanguage&&m(i,"rs",encodeURIComponent(r.dataLanguage)),r.readOnly&&(m(i,"readonly","1"),m(i,"mode","Read")),r.disableChat&&m(i,"dchat","1"),r.cookieCompliant&&m(i,"mscc","1"),r.useBizChatTheme&&m(i,"ubct","1"),r.isNewFile&&(m(i,"new","1"),r.isFromHostTemplate&&m(i,"wdtpl","fromhost"))),t.user.isLicensed&&m(i,"islicenseduser","1"),t.user.isSynthetic&&m(i,"syn","1"),t.actNavId&&m(i,"actnavid",t.actNavId),t.sessionContext&&m(i,"sc",encodeURIComponent(t.sessionContext));const a=t.wdParams;if(a)for(const t in a)m(i,t,a[t]);const h=t.preseededSession;h&&(h.key&&m(i,"preseededsessionkey",encodeURIComponent(h.key)),h.id&&m(i,"preseededwacsessionid",encodeURIComponent(h.id)));const c=t.throttling;c&&(c.protection&&m(i,"ctp",c.protection),c.request&&m(i,"rct",c.request));const d=t.hostInitDiagnostics;d&&(d.entryPoint&&m(i,"wdorigin",encodeURI(d.entryPoint)),d.userClickTime&&m(i,"wdhostclicktime",d.userClickTime.toString()));const l=t.rebootOverride;return l&&l.previousSessionId&&m(i,"wdprevioussession",l.previousSessionId),w(i,"region"),t.bootParams?.afdFlighting&&m(i,"afdflight",Math.floor(100*Math.random()+1).toString()),i}function Se(t,i,e){let s={...v(t.appUrl),...ve(t),...e};const o=t.rebootOverride;return o&&o.queryOverrides&&(s={...s,...o.queryOverrides}),function(t,i,e){const s=[];for(const t in e)e[t]&&s.push(t+"="+e[t]);return t+i+(s.length>0?"?"+s.join("&"):"")}(t.appBasePath,i,s)}const Ie="sideLoadingIsEnabled";const be="Boot_HeartBeat",_e="_FrameError";class Te{setFrameError(){this.ql=!0}setTimeoutStage(t){this.Kl=t,this.Xl=be+"_"+t+(this.ql?_e:"")}restart(){const i=this.Zl.getValue(B.ki,!1);this.Yl=U()+(this.Ql?this.Ql:this.Zl.getValue(B.Pi,6e5));const s=this.Tr?3e3:5e3;this.tu=window.setInterval((()=>{i&&this.Fo.ULS.Ci(595724178,t.k,e.Info,this.Xl),U()>this.Yl&&(this.stop(),this.iu(),this.eu&&this.eu())}),this.Zl.getValue(B.Di,s)),this.su.push(window.setTimeout(this.iu,this.Zl.getValue(B.Ri,3e4),1)),this.su.push(window.setTimeout(this.iu,this.Zl.getValue(B.xi,12e4),2)),this.su.push(window.setTimeout(this.iu,this.Zl.getValue(B.Wi,18e4),3))}stop(){this.Yl=0,this.tu&&(window.clearInterval(this.tu),this.tu=void 0),this.su.forEach((t=>{window.clearTimeout(t)})),this.su=[]}constructor(i,s,o,n,r){this.Yl=0,this.su=[],this.Tr=!1,this.Xl=be,this.ql=!1,this.Kl="FrameCreated",this.iu=i=>{const s="Boot_NotComplete_"+(i||"Final")+"_"+this.Kl+(this.ql?_e:"");this.Fo.ULS.Ci(594901218,t.k,e.Warning,s),this.Fo.ULS.flush()},this.Tr=i,this.Zl=s,this.Fo=o,this.eu=n,this.Ql=r,this.restart()}}const Ce=(i,s,o,n,h)=>i!==Ft.boot?Promise.reject("Wrong flow"):new Promise((i=>{const d=M();var l;o.state=ae.Booting,o.pendingReboot=!1,function(t,i,e=!1){if(!t)throw new TypeError("SessionBootParams");const s=t.appUrl,o=t.appBaseUrl;if(!s&&!o)throw new TypeError("Either appUrl or appBaseUrl should exist");if(s&&"string"!=typeof s)throw new TypeError("AppUrl");if(o&&"string"!=typeof o)throw new TypeError("AppBaseUrl");const n=t.file;if(!n||!e&&!n.name)throw new TypeError("FileInfo");const r=t.container;if(!r||!(r instanceof me)&&!r.appendChild)throw new TypeError("Container");if(!i&&!ge(t.wopi))throw new TypeError("WopiInfo")}(s,o.skipWopiValidation,o.skipFileNameCheck),o.intent=s.intent,o.file=s.file,o.customFontCatalogUrl=s.customFontCatalogUrl,o.wopi=s.wopi,o.contentBundle=s.contentBundle,o.newFileTemplate=s.newFileTemplate,o.ownerId=s.ownerId,o.sessionContext=s.sessionContext,o.actNavId=s.actNavId,o.preseededSession=s.preseededSession,o.throttling=s.throttling,o.meeting=s.meeting,o.tenantId=s.tenantId,o.wdParams=(l=s.wdParams,function(t,i){const e={};return i&&Object.keys(i).forEach((t=>{e[t.toLowerCase()]=i[t]})),t.split("&").forEach((t=>{if(/^wd\w+=.+/i.test(t)){const i=t.split("=");e[i[0].toLowerCase()]=i[1]}})),e}(window.location.search?.substring(1)||"",l)),o.pinnedTarget=s.pinnedTarget,o.rebootOverride=s.rebootOverride,o.bootParams=s.bootParams||{},o.hostInitDiagnostics={...s.diagnostics,hostInitializeCallTime:d};let p=!1;const w=o.preseededSession;o.appInfo.usePreseededSessionId&&w&&w.id&&(o.sessionId=w.id,p=!0);let g=!1;const v=s.hostGeneratedSessionId;if(!p&&v&&(o.sessionId=v,g=!0),o.Ai.getValue(B.Bi,!1)&&function(t){const i=window.performance.timing;i&&(t.hostPageNavigationStartTime||(t.hostPageNavigationStartTime=i.navigationStart),t.hostPageFetchStartTime||(t.hostPageFetchStartTime=i.fetchStart),t.hostPageRequestStartTime||(t.hostPageRequestStartTime=i.requestStart),t.hostPageResponseStartTime||(t.hostPageResponseStartTime=i.responseStart),t.hostPageResponseEndTime||(t.hostPageResponseEndTime=i.responseEnd),t.hostPageDomCompleteTime||(t.hostPageDomCompleteTime=i.domComplete));const e=window.performance.navigation;if(e&&(void 0===t.hostPageRedirectCount&&(t.hostPageRedirectCount=e.redirectCount),!t.hostPageNavigationType)){let i="UNKNOWN";switch(e.type){case 0:i="NAVIGATE";break;case 1:i="RELOAD";break;case 2:i="BACK_FORWARD";break;case 255:i="RESERVED"}t.hostPageNavigationType=i}}(o.hostInitDiagnostics),s.appUrl){const t=s.appUrl;o.appUrl=t;const i=o.bootParams;if(b(t,"new")&&(i.isNewFile=!0),!i.dataLanguage){const e=_(t,"rs");e&&(i.dataLanguage=e)}const e=o.ui;if(b(t,"uiembed")&&(e.uiEmbed=!0),!e.language){const i=_(t,"ui");i&&(e.language=i)}if(!o.hostInitDiagnostics.entryPoint){const i=_(t,"wdorigin");i&&(o.hostInitDiagnostics.entryPoint=i)}if(!o.host.uiHostName){const i=_(t,"uih");i&&(o.host.uiHostName=i)}}else o.appUrl="";let S;if(o.appBaseUrl=s.appBaseUrl?s.appBaseUrl.toLowerCase():u(s.appUrl).toLowerCase(),o.appBaseUrl=function(t,i){if(!i||-1===r.indexOf(i.toLowerCase()))return t;const e=t.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return e?`${e[1]}${i}-${e[3]}`:t}(o.appBaseUrl,f(o.appUrl,"region")),o.Ai.updateEnvironment(o.appBaseUrl),n.initializeAppContext(o,i,s),o.appBasePath=n.buildAppBasePath(o),s.rebootOverride&&(p||g||([o.sessionId,S]=y()),o.pageStateObserver=new vt(o.logger,!0),o.authTokenTrustValidator=new at(o.logger)),o.logger.ULS.Ci(38580693,t.k,e.Info,`User session id: ${o.sessionId}, is preseeded: ${p}, is host generated: ${g}`),o.remoteTelemetryUrl=n.buildRemoteTelemetryUrl(o),x(o.remoteTelemetryUrl,o.appInfo.name,"init"),!o.isLoggerFromOwl){let t=o.Ai.getValue(B.Vi,"").toString();t||(t=o.appBasePath+a),o.logger.configure({remoteUlsEndpoint:t,sessionId:o.sessionId})}if(o.Ai.initializePeriodicFetch(o.appBasePath,o.sessionId),S&&o.logger.ULS.Ci(590966790,t.k,e.Info,JSON.stringify(S)),function(i){try{const s=i.hostInitDiagnostics;i.logger.ULS.Ci(558155803,t.k,e.Info,"HostInitDiagnostics: "+(s?JSON.stringify(s):"N/A")),i.logger.ULS.Ci(596444237,t.k,e.Important,JSON.stringify({session:Y(i),client:i.clientDiagnostics}))}catch(s){i.logger.ULS.Ci(558155804,t.k,e.Error,`Failed to log init info: ${F(s)}`)}}(o),n.onContextReady&&n.onContextReady(o),o.appInitDiagnostics={officeSessionId:o.sessionId,officeBootstrapperVersion:A(),hostName:o.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",(()=>{o.logger.ULS.Ci(504411206,t.k,e.Important,"documentLoadedWithTabSwitch changed on document visibility event"),o.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),window.addEventListener("visibilitychange",(()=>{o.logger.ULS.Ci(504411205,t.k,e.Important,"documentLoadedWithTabSwitch changed on window visibility event"),o.appInitDiagnostics.documentLoadedWithTabSwitch=!0}),{once:!0}),!o.container){const t=s.container;o.container=t instanceof me?t:o.application.createContainer(t)}o.container.setMessageHandler(o.onMessage);const T=!!n.ignoreCompletionMessage&&n.ignoreCompletionMessage(o),C=(i,s)=>{o.successTime=M(),T||(o.container.postMessage(yt.bn,void 0),X(o.appInitDiagnostics,s.Diagnostics)),o.Ai.addSettingsChangeListener(o.logger.settingsChangeHandler),n.onSuccess&&n.onSuccess(o,s),o.logger.ULS.Ci(596448985,t.k,e.Important,JSON.stringify(o.diagnostics)),x(o.remoteTelemetryUrl,o.application.name,"bootSuccess"),o.logger.ULS.flush(),o.container.postMessage(yt.yn,{HostInitializeDiagnostics:o.hostInitDiagnostics,ClientDiagnostics:o.clientDiagnostics}),o.state=ae.Booted,P({completion:"success"}),Z(o.appInfo.name,o.logger)},V=(i,s)=>{o.failureTime=M(),n.onFailure&&n.onFailure(o,s.Error),o.logger.ULS.Ci(596448986,t.k,e.Error,JSON.stringify({error:s.Error,diagnostics:o.diagnostics})),x(o.remoteTelemetryUrl,o.application.name,"bootFailure"),o.logger.ULS.flush(),o.state=ae.Failed,P({completion:"failure",error:s.Error,errorSource:"app",documentLoadedWithTabSwitch:o.appInitDiagnostics?.documentLoadedWithTabSwitch}),Z(o.appInfo.name,o.logger)},P=t=>{T||(o.bootHeartBeat&&o.bootHeartBeat.stop(),o.removeActionHandler(it.Ee,C),o.removeActionHandler(it.Ce,V)),i(t)};h&&h.subscribe((()=>{P({completion:h.reason||"cancelled",documentLoadedWithTabSwitch:o.appInitDiagnostics?.documentLoadedWithTabSwitch})})),T||(o.addActionHandler(it.Ee,C),o.addActionHandler(it.Ce,V)),function(t){(function(t){return"wdjs"in t||"wd1js"in t})(t)&&("true"!==window.sessionStorage.getItem(Ie)?Wt(Ie,"false",0):function(t,i){const e=xt(t);return"true"===e||"false"!==e&&!1}(Ie)||Wt(Ie,"true",1))}(o.wdParams);const R=n.buildBootRequestParams(o),W=Se(o,R.appPageName,R.queryParamsOverrides),U=function(i,s){const o=function(i){const s={};m(s,"highdpi",String(window.devicePixelRatio>1.24)),m(s,"softblockedbrowser",String(z())),m(s,"hostname",i.hostName),m(s,"feature_status",gt(i.featureManager,i.wdParams)),m(s,"jsapibuild",A());const o=i.wopi;o&&(m(s,"access_token",o.accessToken),m(s,"access_token_ttl",o.expiry.toString()),o.wacToken&&m(s,"wac_token",o.wacToken));const n=i.customFontCatalogUrl;n&&m(s,"customfontcatalogurl",n);const r=i.contentBundle;if(r){if(r.url){m(s,"bundlesrc",r.url);const o=r.staleness,n=null!=o;n&&m(s,Di.Kr,o.toString()),i.logger.ULS.Ci(577783775,t.k,e.Info,"Content bundle staleness: "+(n?o:"N/A"))}r.bundleUrlNoAuth&&m(s,"bundleurlnoauth",r.bundleUrlNoAuth),r.bundleCode&&m(s,"bundlecode",r.bundleCode)}const a=i.file,h=a.name;if(h){m(s,"filename",h);const t=E(h);t&&m(s,"fileextension",t)}a.getUrl&&m(s,"filegeturl",a.getUrl),a.downloadCode&&m(s,"filedownloadcode",a.downloadCode),a.urlNoAuth&&m(s,"fileurlnoauth",a.urlNoAuth),a.size&&m(s,"filesize",a.size.toString()),a.eTag&&m(s,"etag",a.eTag),a.cTag&&m(s,"revid",a.cTag),a.uniqueId&&m(s,"docid",a.uniqueId),void 0!==a.immutableReason&&m(s,"immutableReason",a.immutableReason.toString()),void 0!==a.supportsZipIt&&m(s,"supports_zipit",a.supportsZipIt.toString());const c=i.newFileTemplate;c&&(c.getUrl&&m(s,"templateurl",c.getUrl),c.size&&m(s,"filesize",c.size.toString()),c.eTag&&m(s,"etag",c.eTag),c.uniqueId&&m(s,"docid",c.uniqueId)),i.user.id&&m(s,"user_id",i.user.id),i.ownerId&&m(s,"owner_id",i.ownerId),i.sessionContext&&m(s,"sc",i.sessionContext);const d=i.ui;d.controls&&m(s,"huictrls",JSON.stringify(d.controls)),"Templatization"!==d.contentAssemblyMode&&"DocGen"!==d.contentAssemblyMode&&"ContentAssemblyEdit"!==d.contentAssemblyMode&&"ContentAssemblyView"!==d.contentAssemblyMode||m(s,"caae","1"),d.contentAssemblyMode&&m(s,"caaemode",d.contentAssemblyMode);const l=i.meeting;l&&(l.id&&m(s,"meetingId",l.id),l.title&&m(s,"meetingTitle",l.title),l.type&&m(s,"meetingType",l.type),l.scheduledStartTime&&m(s,"scheduledStartTime",l.scheduledStartTime),l.scheduledEndTime&&m(s,"scheduledEndTime",l.scheduledEndTime),l.isPresenter&&m(s,"isPresenter",l.isPresenter.toString()),l.organizerId&&m(s,"meetingOrganizerId",l.organizerId),l.joinUrl&&m(s,"meetingJoinUrl",encodeURIComponent(l.joinUrl)),l.isMeetingTeamsRoom&&m(s,"isMeetingTeamsRoom",l.isMeetingTeamsRoom.toString()));const u=i.host;u.owlVersion&&m(s,"owlver",u.owlVersion),u.owlRollout&&m(s,"owlro",u.owlRollout);const p=u.capabilities;return p&&(p.supportsInPlaceCreateNew&&m(s,"sipcn",p.supportsInPlaceCreateNew.toString()),p.disableEmbedViewCodeSnippet&&m(s,"devcs","1"),p.disableCoEditInTeams&&m(s,"dceit","1")),s}(i);return Object.keys(s).forEach((t=>{s[t]?o[t]=s[t]:delete o[t]})),o}(o,R.postDataOverrides);if(o.bootstrapperUrl&&o.preconnector&&o.preconnector.shouldPreconnect(o.hostName)&&o.preconnector.preconnect(o.bootstrapperUrl),o.bootstrapperUrl&&o.preloader&&o.preloader.shouldPreload(W,o.host.origin,o))try{n.beforePreload&&n.beforePreload(o);let i=o.bootstrapperUrl;o.featureManager.isFeatureEnabled(wt.qo)&&(o.logger.ULS.Ci(590966791,t.k,e.Info,"HTTP2 preload enabled"),i=I(i)),o.preloader.preload(i,o.ui.language,o.logger,o.featureManager)}catch(i){o.logger.ULS.Ci(590966792,t.k,e.Error,"Error preloading")}n.beforeContainerBoot&&n.beforeContainerBoot(o,W),o.container.boot(W,U,o.logger,n.buildContainerBootParams(o),(()=>{o.appInitDiagnostics.officeFrameCreateTime=M(),o.appBootState="FrameCreated"}),(()=>{o.appInitDiagnostics.officeFrameLoadTime=M(),o.logger.ULS.Ci(506012820,t.k,e.Important,"Frame loaded"),"FrameCreated"===o.appBootState&&(o.appBootState="FrameLoaded",o.bootHeartBeat&&o.bootHeartBeat.setTimeoutStage(o.appBootState))}),(()=>{o.appInitDiagnostics.officeFrameErrorTime=M(),o.logger.ULS.Ci(506012819,t.k,e.Error,"Frame error"),o.bootHeartBeat&&o.bootHeartBeat.setFrameError()})),T?C(it.Ee,{Diagnostics:{bootSuccessWithoutCompletionMessage:!0}}):(o.bootHeartBeat=new Te(c(o.appBaseUrl),o.Ai,o.logger,(()=>{o.timeoutTime=M(),n.onTimeout&&n.onTimeout(o),x(o.remoteTelemetryUrl,o.application.name,"bootTimeout"),P({completion:"timeout",error:{documentLoadedWithTabSwitch:o.appInitDiagnostics.documentLoadedWithTabSwitch},timeoutStage:o.appBootState}),h&&h.cancel()}),h&&n.overrideBootTimeout?Math.min(h.timeoutInMs,n.overrideBootTimeout(o)):h?h.timeoutInMs:n.overrideBootTimeout?n.overrideBootTimeout(o):void 0),n.beforeBootCompletionMessage&&n.beforeBootCompletionMessage(o))})).catch((t=>{throw o.failureTime=M(),n.onException&&n.onException(o,t),o.remoteTelemetryUrl&&x(o.remoteTelemetryUrl,o.application.name,"bootException"),o.bootHeartBeat&&o.bootHeartBeat.stop(),{error:t.toString(),errorStack:t.stack}})),Ae=(i,s,o)=>new Promise((s=>{o.logger.ULS.Ci(590111070,t.k,e.Error,`Unsupported flow: ${i}`),s({completion:"failure"})})),Ee=(i,s,o,n,r)=>i!==Ft.createNew?Promise.reject("Wrong flow"):new Promise((a=>{const h={wopiPendingInitializeTime:M()},c=!!(n&&n.parallelizeStartSessionRequest&&n.buildStartSessionRequestParams)&&n.parallelizeStartSessionRequest(o);let d,l,u=!1,p=!1,m=!1,w=!1,f=!1,g=!1;if(J()===$.IE||n&&n.fallBackToSingleStepBootFlow&&n.fallBackToSingleStepBootFlow(o,s))return void function(){o.logger.ULS.Ci(578074079,t.k,e.Info,"Waiting for WOPI info to start boot");const i=(i,a)=>{if(u)o.logger.ULS.Ci(578074080,t.k,e.Warning,"completeCreateNew already called");else{if(u=!0,h.wopiPendingCompleteTime=M(),"failure"===a.state)return V(a.reason),o.state=ae.Failed,void n({completion:"failure"});Fe(a.newFile),o.run(Ft.boot,{...s,wopi:a.wopi},r).then((t=>{n(t)}))}};o.addActionHandler(Ft.completeCreateNew,i);const n=t=>{o.removeActionHandler(Ft.completeCreateNew,i),a(t)};r&&r.subscribe((()=>{n({completion:"cancelled"})}))}();const v=(i,s)=>{u?o.logger.ULS.Ci(587236372,t.k,e.Warning,"completeCreateNew already called"):(u=!0,h.wopiPendingCompleteTime=M(),"failure"!==s.state?(d=s.wopi,ge(d)?(o.wopi=d,o.logger.ULS.Ci(587286030,t.k,e.Info,"WOPI info received. Access token: "+JSON.stringify({length:d.accessToken.length,expiry:d.expiry})+", current state: "+JSON.stringify({parallelizeStartSessionRequest:c,wacFrameLoaded:p,wacCanAcceptStartSessionResponse:m})),!c||p&&!m?p&&C():I(),p&&o.container&&o.container.postMessage(yt.tr,void 0),Fe(s.newFile)):S("InvalidWopiInfo")):S(s.reason))},S=t=>{V(t),p&&o.container&&o.container.postMessage(yt.Yn,void 0)},I=()=>{o.logger.ULS.Ci(587233056,t.k,e.Info,"Making parallelized StartSession request");const s=n.buildStartSessionRequestParams(o,i,d),r=Se(o,s.appPageName,s.queryParamsOverrides),a="access_token="+encodeURIComponent(d.accessToken)+"&access_token_ttl="+encodeURIComponent(d.expiry.toString());h.startSessionStartTime=M(),function(t,i,e,s){const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(o&&4===o.readyState){if(void 0===o.status||0===o.status)return;try{s&&s(o)}finally{null!=o&&(o.onreadystatechange=()=>{})}}},o.open("POST",t);for(const t in e)o.setRequestHeader(t,e[t]);o.send(i)}(r,a,{"Content-Type":"application/x-www-form-urlencoded"},b)},b=i=>{const s=M();h.startSessionCompleteTime=s,o.logger.ULS.Ci(587233057,t.k,e.Info,`StartSession request completed. Status code: ${i.status}, time: ${s}`),l={RequestStatus:i.status,ResponseText:i.responseText},p&&m?T():o.logger.ULS.Ci(587233058,t.k,e.Info,"StartSession response not yet sent: "+JSON.stringify({wacFrameLoaded:p,wacCanAcceptStartSessionResponse:m,wopiInfoSent:f,startSessionResponseSent:g}))},_=(i,s)=>{h.readyMessageReceiveTime=M(),o.container&&o.container.postMessage(yt.gn,void 0),p||(p=!0,m=s.CanAcceptStartSessionComplete,o.logger.ULS.Ci(587321567,t.k,e.Info,"App ready: "+JSON.stringify({parallelizeStartSessionRequest:c,wacCanAcceptStartSessionResponse:m,startSessionResponseAvailable:!!l,wopiInfoAvailable:!!d})),u&&o.container&&o.container.postMessage(d?yt.tr:yt.Yn,void 0),c&&m?T():C(),X(o.appInitDiagnostics,s.Diagnostics))},T=()=>{g||f||!l||(200===l.RequestStatus?(g=!0,h.completeMessageCreateTime=M(),A(yt._n,{StartSessionResponse:l,Diagnostics:h},3)):C())},C=()=>{g||f||!d||(f=!0,h.completeMessageCreateTime=M(),n&&n.sendCreateNewWopiInfo?n.sendCreateNewWopiInfo(o):A(yt.Tn,{WopiDetails:{WopiSrc:d.source,AccessToken:d.accessToken,AccessTokenTtl:d.expiry.toString()},Diagnostics:h},3))},A=(i,s,n)=>{const r=M();n<=0?o.logger.ULS.Ci(587233165,t.k,e.Error,`Attempted to complete but no ack. Time: ${r}`):(o.logger.ULS.Ci(587233166,t.k,e.Info,`Sending complete message. Retries left: ${n-1}, Time: ${r}`),h.completeMessageSendTime=r,o.container&&o.container.postMessage(i,s),window.setTimeout(E,1e3,i,s,n-1))},E=(i,s,n)=>{w||(o.logger.ULS.Ci(587233167,t.k,e.Info,`Timeout session complete ack. Retries left: ${n}`),A(i,s,n))},F=(t,i)=>{w=!0},y=t=>{o.removeActionHandler(Ft.completeCreateNew,v),o.removeActionHandler(it.Te,_),o.removeActionHandler(it.gs,F),a(t)};function V(i){o.logger.ULS.Ci(596444188,t.k,e.Warning,"Fail with reason: "+(i?JSON.stringify(i):"N/A"))}o.addActionHandler(Ft.completeCreateNew,v),o.addActionHandler(it.Te,_),o.addActionHandler(it.gs,F),r&&r.subscribe((()=>{y({completion:"cancelled"})})),o.skipWopiValidation=!0,o.skipFileNameCheck=!0,o.wopi=void 0,o.run(Ft.boot,s,r).then((t=>{o.skipWopiValidation=!1,o.wopi=d,y(t)}))}));function Fe(t){t&&(t.path&&history.replaceState({},"",t.path),t.title&&(document.title=t.title))}class ye{get isCancelled(){return this.ou}get timeoutInMs(){return this.nu}get reason(){return this.ru}cancel(){this.au(!1)}subscribe(t){this.ou?t():this.hu.push(t)}constructor(t){this.ou=!1,this.ru="",this.hu=[],this.au=t=>{this.ou||(this.ou=!0,this.ru=t?"timeout":"cancelled",this.hu.map((t=>t())),this.hu=[])},this.nu=t,window.setTimeout((()=>this.au(!0)),t)}}function Ve(t){return new ye(t)}const Pe=(i,s,o,n,r)=>i!==Ft.dispose?Promise.reject("Wrong flow"):new Promise((i=>{o.logger.ULS.Ci(595714433,t.k,e.Important,"start disposing the application");const a=o.host.requireExplicitUnload,h={disposeStartTime:M(),forceAppUnload:a};o.state=ae.Disposing;const c=()=>{o.state=ae.Disposed,i({completion:"success"})},d=i=>{n&&n.disposeAppSpecificResources&&n.disposeAppSpecificResources(o,s),o.dispose(),h.disposeEndTime=M(),function(i,s,o){if(o){const t=Number(o.hostMessageReceived);s.appUnloadStartTime&&!isNaN(t)&&(s.hostToAppPostMessageLatency=t-s.appUnloadStartTime);const i=Number(o.appMessageSent);!isNaN(i)&&s.appUnloadEndTime&&(s.appToHostPostMessageLatency=s.appUnloadEndTime-i);const e=Number(o.appUnloadStart),n=Number(o.appUnloadEnd);if(isNaN(e)||isNaN(n)||(s.appUnloadLatency=n-e),o.serverTimings){const t=o.serverTimings;for(const i in t)s["st-"+i.toString()]=t[i]}}i.logger.ULS.Ci(592524822,t.k,e.Info,"App disposed: "+JSON.stringify(s)),i.logger.ULS.flushOnClose()}(o,h,i),o.container?o.container.dispose(o.pendingReboot,a).then(c):c()};if(a){h.appUnloadStartTime=M();const t=(t,i)=>{h.appUnloadEndTime=M(),d(i)};o.addActionHandler(it.Ts,t),(r||new ye(5e3)).subscribe((()=>{o.state===ae.Disposing&&(h.appUnloadTimedOut=!0,d())})),o.container&&o.container.postMessage(yt.er,void 0)}else d()})),Re=(i,s,o,n,r)=>i!==it.Je?Promise.reject("Wrong flow"):new Promise((i=>{if(o.host.capabilities&&o.host.capabilities.frameTrustCheck)o.raiseEvent(ce.FrameTrust,s);else{const i=!!o.container&&o.container.isTopFrameTrusted;o.logger.ULS.Ci(592445957,t.k,e.Info,`Top frame is trusted: ${i}`),o.container&&o.container.postMessage(yt.Je,{isTopFrameTrusted:i})}i({completion:"success"})})),xe=(t,i,e,s,o)=>t!==it.je?Promise.reject("Wrong flow"):new Promise((t=>{e.authTokenTrustValidator.isResourceTrustedForMessage(i).then((s=>{s?e.raiseEvent(ce.GetAuthToken,i):(e.container.postMessage(yt.Hn,{AuthToken:"",Error:"accessDenied",RequestId:i.RequestId,IdentityType:i.IdentityType}),t({completion:"success"}))}),(s=>{e.container.postMessage(yt.Hn,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:i.RequestId,IdentityType:i.IdentityType}),t({completion:"failure",error:s})}))})),We=(i,s,o,n,r)=>i!==it.Ae?Promise.reject("Wrong flow"):new Promise((i=>{const r=s&&s.state?s.state:"Unknown";o.logger.ULS.Ci(592839750,t.k,e.Info,`Boot state: [${r}]`),r!==o.appBootState&&(o.appBootState=r,o.bootHeartBeat&&o.bootHeartBeat.setTimeoutStage(r)),n&&n.beforeComplete&&n.beforeComplete(r),i({completion:"success"})})),Ue=(i,s,o,n,r)=>{if(i!==Ft.postWacToken)return Promise.reject("Wrong flow");const a=U();return o.logger.ULS.Ci(507774685,t.k,e.Important,"postWacToken flow initiated"),new Promise((i=>{const n=(i,s)=>{o.logger.ULS.Ci(507597017,t.k,e.Info,`postWacToken flow completed in ${U()-a} ms`),window.clearInterval(c),window.clearTimeout(d);const n={completion:"success"};s&&void 0!==s.TokenAlreadySet&&(n.data={TokenAlreadySet:s.TokenAlreadySet}),r(n)},r=t=>{o.removeActionHandler(it.wo,n),i(t)},h=()=>o.container?.postMessage(yt.pr,s);o.addActionHandler(it.wo,n),h();const c=window.setInterval(h,100),d=window.setTimeout((()=>{window.clearInterval(c),o.logger.ULS.Ci(507844190,t.k,e.Warning,"postWacToken flow timed out after 60000 milliseconds"),r({completion:"timeout"})}),6e4)}))},Me=(i,s,o,n,r)=>i!==it.So?Promise.reject("Wrong flow"):new Promise((i=>{const n=s.flightKey,r=s.flightValue;var a;o.logger.ULS.Ci(507343134,t.It,e.Info,`setWacFlightValue ${n}: ${r}`),a=s,localStorage.setItem(a.flightKey,a.flightValue.toString()),i({completion:"success"})}));function De(i,s){i.ULS.Ci(42524822,t.k,e.Info,`LogFeatureUsage: ${s.toString()}`)}const ke={[vi.BOOTSTART]:596464066,[vi.BACKGROUND_MODESWITCH_BOOTSTART]:596464066,[vi.BOOTSUCCESS]:596457106,[vi.BOOTFAILED]:596464088,[vi.BOOTEXCEPTION]:596464072,[vi.BOOTTIMEOUT]:587580759};function Oe(i,s){switch(s){case vi.BOOTSTART:case vi.BACKGROUND_MODESWITCH_BOOTSTART:case vi.BOOTSUCCESS:case vi.BOOTFAILED:case vi.BOOTEXCEPTION:case vi.BOOTTIMEOUT:i.ULS.Ci(ke[s],t.k,e.Warning,s.toString());break;default:i.ULS.Ci(523298252,t.k,e.Info,"UKNOWN RELIABILITY MILESTONE")}i.ULS.flush()}function Be(i,s,o){Ui(),Ci(i.appUrl)||(De(i.logger,Si.JSAPIV2),Oe(i.logger,vi.BOOTSTART));const n=i.appContext,r=bi.getBRSValue(bi.DTEEnabledBRSKey);n.wasDefaultedtoEdit=!1,r&&!Ci(i.appUrl)&&function(i,s){const o=i.appContext,n=f(window.location.href,"action");let r=!1;const a=i.host.uiHostName,h=a&&"teams"===a.toLowerCase();if(h){const t=Ti(i.appUrl)===gi.VIEW;i.rebootOverride||(r=t)}const c=Ai(i.appUrl)||Ei(i.appUrl);if(bi.getBRSValue(bi.DisableDTEForUnsupportedFileTypesEnabledBRSKey)){if(null===i.file||void 0===i.file||!i.file.name)return void i.logger.ULS.Ci(507110738,t.k,e.Error,"Missing file name in the context");const s=E(i.file.name);if("vsdx"!==s)return void i.logger.ULS.Ci(507110737,t.k,e.Info,"Not defaulting to edit for  "+s+"file type.")}bi.getBRSValue(bi.DTESafariFixEnabledBRSKey)&&J()===$.Safari||("default"===n||r||bi.getBRSValue(bi.DTESharingFixEnabledBRSKey)&&!s?.bootParams?.readOnly&&!c&&!h&&0===n.length)&&"true"===localStorage.getItem("enableDTE")&&(i.appUrl=g(i.appUrl,"VisioView","EditView",!0),o.wasDefaultedtoEdit=!0)}(i,o),n.appMode=Ti(i.appUrl),n.resource=new se(i.appBaseUrl,i.bootstrapperUrl),n.appFramePageViewLoaded=!1,n.fastViewPostMessageToWacFrameState={appFrameReadyToReceiveFastViewData:!1,jsapiAlreadySentFastViewDataToWacFrame:!1,jsapiReadyToSendFastViewDataToWacFrame:!1},n.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},n.fastViewBrowserCache=Mi.Create(i.user.id,i.wopi?.source,i.file?.eTag,i.logger),n.sessionBootParams=o,n.commentContext=void 0,n.modeSwitchAckReceived=!1;const a=i.host.uiHostName,h=a&&"teams"===a.toLowerCase();(i.wdParams?.wdnc||bi.getBRSValue(bi.hostCacheForEmbedViewEnabledBRSKey)&&(n.appMode===gi.EMBED_VIEW||n.appMode===gi.INTERACTIVE_PREVIEW))&&(n.fastViewInfo.noChromeMode=!0),h&&i.ui?.hideHeader&&(n.appMode===gi.VIEW||n.appMode===gi.EMBED_VIEW||n.appMode===gi.INTERACTIVE_PREVIEW||n.appMode===gi.EDIT&&-1===i.appUrl.indexOf("embed=1"))&&(n.fastViewInfo.noChromeMode=!0),h&&n.fastViewInfo.noChromeMode&&(n.fastViewInfo.noChromeWithToolbar=!0),f(window.location.href,"teamsvisiomode")&&i.hostInitDiagnostics&&(i.hostInitDiagnostics.userClickTime=(new Date).getTime())}function $e(t){return t.appBaseUrl+_i}function Ne(t){return i=t.appBasePath,e=t.sessionId,i+h+(e?"?usid="+e:"");var i,e}function He(i,s=!1){if(Xe(i,s)){Ci(i.appUrl)||te.RecordTelemetryData(hi,ci,ri,Zi.TimerBegin,new Date,i.logger);try{!function(i){const{imageElement:s,fishBowlElement:o,pageElement:n,fastViewContainer:r}=function(t){const i=t.appContext;if(!t.container)return;const e=Ke(t),s=function(){const t=document.createElement("div");return t.id="VisioFastViewContainer",t.style.width="100%",t.style.height="100%",t.style.visibility="hidden",t.style.position="absolute",t.style.backgroundColor="#F3F2F1",t.style.display="block",t.style.touchAction="none",t.style.zIndex="1",t}(),o=function(t,i,e,s){const o=document.createElement("div");return o.style.top=e?wi.ToolbarHeightConsumption+"px":i?"0px":wi.RibbonHeightConsumption+"px",o.style.left="0px",o.style.right="0px",o.style.bottom=wi.StatusbarHeight+"px",o.style.position="absolute",o.style.borderTopColor="#C6C6C6",o.style.borderTopWidth=wi.FishbowlBorderTop+"px",o.style.borderTopStyle="solid",o.style.backgroundColor=Fi(s)?"#FFFFFF":"#F9F9F9",t.appendChild(o),o}(s,e.noChromeMode,e.noChromeWithToolbar,i.appMode),n=function(t){const i=document.createElement("div");return i.id="backgroundPage",t.appendChild(i),i}(o),r=function(t){const i=document.createElement("img");return i.id="foregroundPage",i.style.visibility="hidden",i.setAttribute("crossorigin","anonymous"),t.appendChild(i),i}(n);!e.noChromeMode&&function(t,i){const e=document.createElement("div");e.style.top="0px",e.style.height=wi.HeaderHeight+"px",e.style.left="0px",e.style.right="0px",e.style.position="absolute",bi.getBRSValue(bi.Fluent2StyleIsEnabled)?e.style.backgroundColor="#FFFFFF":e.style.backgroundColor=i.ui&&i.ui.useNeutralColorInHeader?"#F3F2F1":"#3955A3",t.appendChild(e)}(s,t),(!e.noChromeMode||e.noChromeWithToolbar)&&function(t,i){const e=document.createElement("div");e.style.top=(t?0:wi.HeaderHeight)+"px",e.style.height="0px",e.style.left="0px",e.style.right="0px",e.style.position="absolute",e.style.backgroundColor="#E1E1E1",e.id="visio_fastview_toolbar_upper",i.appendChild(e);const s=document.createElement("div");s.style.top=(t?0:wi.HeaderHeight)+"px",s.style.height=wi.ToolbarHeightConsumption+"px",s.style.left="0px",s.style.right="0px",s.style.position="absolute",s.style.backgroundColor="#FFFFFF",s.id="visio_fastview_toolbar",i.appendChild(s)}(e.noChromeWithToolbar,s);const a=function(t,i){const e=i.appContext,s=document.createElement("div");return e.fastViewInfo.noChromeWithToolbar?s.style.top=wi.ToolbarHeightConsumption+"px":e.fastViewInfo.noChromeMode?s.style.top="0px":s.style.top=wi.RibbonHeightConsumption+wi.FishbowlBorderTop+"px",s.style.height=wi.ProgressImageHeight+"px",s.style.left="0px",s.style.right="0px",s.style.position="absolute",i.appContext.resource&&(s.style.backgroundImage=`url(${i.appContext.resource.getDelayLoadingGif()})`,s.style.backgroundRepeat="repeat-x"),t.appendChild(s),s}(s,t),h=function(t){const i=document.createElement("div");return i.style.height="0px",t.appendChild(i),i}(s),c=function(t){const i=document.createElement("div");return i.style.bottom="0px",i.style.height=wi.StatusbarHeight+"px",i.style.left="0px",i.style.right="0px",i.style.position="absolute",i.style.borderTopColor="#C6C6C6",i.style.borderTopWidth=wi.StatusbarBorderTop+"px",i.style.borderTopStyle="solid",i.style.backgroundColor="#FFFFFF",t.appendChild(i),i}(s);return i.appMode===gi.EDIT&&function(t,i,e,s,o,n){(function(t,i,e,s){const o=s?wi.RibbonHeightNoChrome:wi.RibbonHeightEdit;t.style.top=o+"px",e.style.top=o+wi.FishbowlBorderTop+"px",t.style.left=wi.ShapePanelWidthWithBorder+"px",i.style.left=wi.ShapePanelWidthWithBorder+"px"})(t,e,s,o),function(t,i,e){t.style.top=i.style.top,t.style.position="absolute",t.style.height="auto",t.style.borderWidth=wi.ShapePanelBorderWidth+"px",t.style.borderRightStyle="solid",t.style.boxShadow="2px 1px 4px 0 rgba(0,0,0,0.13)",t.style.borderColor="#e1e1e1",t.style.backgroundColor="#f2f2f2",t.style.width=wi.ShapePanelWidthWithoutBorder+"px",t.style.bottom="0px",t.style.overflow="0",function(t,i){const e=document.createElement("div");e.style.top="50%",e.style.left="50%",e.style.position="absolute",e.style.transform="translateX(-50%) translateY(-50%)",e.style.fontSize="9pt",e.style.fontFamily='"Segoe UI", Arial, Verdana, sans-serif',t.appendChild(e);const s=document.createElement("img");s.style.cssFloat="left",s.style.height="16px",s.style.width="16px",s.setAttribute("crossorigin","anonymous"),i.appContext.resource?s.src=i.appContext.resource.getLoadingSpinnerGif():s.style.visibility="hidden",e.appendChild(s);const o=document.createElement("div");o.style.cssFloat="left",o.style.paddingLeft="10px",o.innerText="",e.appendChild(o)}(t,e)}(i,t,n)}(o,h,c,a,e.noChromeMode,t),t.container.element.appendChild(s),{fastViewContainer:s,fishBowlElement:o,pageElement:n,imageElement:r,shapePanelElement:h}}(i),a=Ke(i);a.fishBowlElement=o,a.imageElement=s,a.pageElement=n,a.fastViewContainer=r;const h=i.appContext;h.fastViewBrowserCache&&h.fastViewBrowserCache.IsCacheAvailable()?h.fastViewBrowserCache.DecryptAndValidate(((s,o)=>{try{a.imageElement.setAttribute("src","data:image/png;base64,{0}".replace("{0}",o)),a.imageLoaded=!0,a.docViewResponseText=s,a.docViewLoaded=!0,a.fastviewContentLoadedFromLocalcache=!0,a.fastViewImageDataFromCache=o,Je(i)}catch(s){i.logger.ULS.Ci(508045407,t.k,e.Error,"doc view parsing failed from cache with exception: "+F(s)),Le(i)}}),(()=>{i.logger.ULS.Ci(508045406,t.k,e.Error,"fastview browser cache decryption and validation failed"),h.fastViewBrowserCache.DeleteDocument(),Le(i)})):(function(i){const s=Ke(i),{imageElement:o}=s;o.onload=()=>{s.imageLoaded=!0,Je(i)},o.onerror=()=>{i.logger.ULS.Ci(523531992,t.k,e.Error,"Fast View image request failed in JSAPI bootstrapper"),Le(i)},o.src=Ge(i.contentBundle?.url,fi.FastViewImage)}(i),function(i){const s=Ge(i.contentBundle?.url,fi.FastViewJson),o=Ke(i);Ot.sendXmlHttpRequest("GET",s,!0,(s=>{try{o.docViewResponseText=s,o.docViewLoaded=!0,Je(i)}catch(s){i.logger.ULS.Ci(508045405,t.k,e.Error,"doc view usage failed with exception: "+F(s)),Le(i)}}),(()=>{i.logger.ULS.Ci(508045404,t.k,e.Error,"doc view request failed in JSAPI bootstrapper"),Le(i)}),fi.FastViewJson,i.logger)}(i))}(i)}catch(s){i.logger.ULS.Ci(523531990,t.k,e.Error,`Failed to boot from the host cache: ${F(s)}`),Le(i)}}}function Le(t){const i=Ke(t);i.fastViewContainer&&i.fastViewContainer.parentElement&&i.fastViewContainer.parentElement.removeChild(i.fastViewContainer),i.fastViewcontainerVisible=!1,t.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,Ze(t)}function Je(i){try{const s=Ke(i),o=JSON.parse(s.docViewResponseText);if(s.fastViewCacheHit=!0,s.docViewLoaded&&s.imageLoaded&&i.state===ae.Booting&&!i.appContext.appFramePageViewLoaded){const n=function(t,i,e,s){const o=(e-96*wi.FishbowlMarginInches)/(96*t),n=(s-96*wi.FishbowlMarginInches)/(96*i);return Math.min(o,n)}(o.PageWidth,o.PageHeight,s.fishBowlElement.offsetWidth,s.fishBowlElement.offsetHeight);!function(t,i,e){const s=Ke(t),o=e.PageWidth,n=e.PageHeight,{fishBowlElement:r,pageElement:a}=s,h=r.offsetWidth-96*o*i,c=r.offsetHeight-96*n*i;a.style.width=96*o*i+"px",a.style.height=96*n*i+"px",a.style.backgroundColor="white";Fi(t.appContext.appMode)||(a.style.borderColor="#C6C6C6",a.style.borderWidth="1px",a.style.borderStyle="solid",a.style.boxShadow="0px 0px 20px #C6C6C6"),a.style.position="absolute",a.style.top=c/2+"px",a.style.left=h/2+"px"}(i,n,o),s.imageElement.style.position="absolute",s.imageElement.style.left=96*o.OffsetX*n+"px",s.imageElement.style.top=s.pageElement.clientHeight-96*(o.Height+o.OffsetY)*n+"px",s.defaultImageHeight=s.imageElement.height,s.defaultImageWidth=s.imageElement.width,s.imageElement.width=96*o.Width*n,s.imageElement.height=96*o.Height*n,s.imageElement.style.visibility="visible",s.fastViewContainer.style.display="block",s.fastViewContainer.style.visibility="visible",s.fastviewShownFromHostCache=!0,s.fastViewPLTTime=M(),s.fastViewcontainerVisible=!0,i.appContext.fastViewPostMessageToWacFrameState.jsapiReadyToSendFastViewDataToWacFrame=!0,function(i){const s=Ke(i);setTimeout((()=>{s.fastViewcontainerVisible&&(i.logger.ULS.Ci(523089178,t.k,e.Warning,`[setTimeoutForRemovalOfFastView] Removing fastview screen as its > ${di} millisec.`),je(i))}),di)}(i),Ze(i)}else s.docViewLoaded&&s.imageLoaded&&i.logger.ULS.Ci(523531993,t.k,e.Info,"FastView not shown. Conditions: "+JSON.stringify({SessionState:i.state,appFramePageViewLoaded:i.appContext.appFramePageViewLoaded}))}catch(s){i.logger.ULS.Ci(508045403,t.k,e.Error,"fastview creation failed with exception: "+F(s))}}function Ge(t,i){if(!t||-1===t.indexOf("{0}"))throw new TypeError("invalid content URL");if(!i)throw new TypeError("invalid content id");return decodeURI(t).replace("{0}",i)}function je(t){window.setTimeout((()=>Le(t)),0)}function ze(t){const i=Ke(t),e=t.appInitDiagnostics;e.documentLoadedFromWopiPrecheckInfo=i.fastviewShownFromHostCache,i.fastviewShownFromHostCache&&(e.documentLoadedTime=i.fastViewPLTTime),e.cacheAboutToExpire=!1,i.fastViewCacheHit&&!e.cacheHit&&(e.cacheAboutToExpire=!0),e.cacheHit=i.fastViewCacheHit,Ci(t.appUrl)&&(e.webAppFrameReinitialized=!0);const s=t.hostInitDiagnostics;s&&void 0===s.hostPageRedirectCount&&(s.hostPageRedirectCount=Wi())}function qe(i){const s=i.appInitDiagnostics;if(!s)return;const o=i.appContext,n=Ke(i);Ci(i.appUrl)||ie(i.hostInitDiagnostics,s,i.logger);let r=!1;try{r=JSON.parse(n.docViewResponseText)?.IsCompressed}catch(t){}i.logger.ULS.Ci(595981388,t.k,e.Info,JSON.stringify({BootDiagnostics:s,hostDiagnostics:i.hostInitDiagnostics,navigationStartTime:xi(),isJSAPIV2:"true",localCacheHit:n.fastviewContentLoadedFromLocalcache,compressedView:r?"true":"false",backgroundBoot:Ci(i.appUrl),appMode:o.appMode.toString()})),s.documentLoadedWithTabSwitch&&i.logger.ULS.Ci(596457107,t.k,e.Info,"DOCUMENTLOADEDWITHTABSWITCH"),i.logger.ULS.Ci(596457681,t.k,e.Info,JSON.stringify({hostInitDiagnostics:i.hostInitDiagnostics??"N/A"})),window._pageTimings=window._pageTimings??{},s.documentLoadedTime&&i.hostInitDiagnostics?.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_PLT=s.documentLoadedTime-i.hostInitDiagnostics?.hostInitializeCallTime),s.appCompletedTime&&i.hostInitDiagnostics?.hostInitializeCallTime&&(window._pageTimings.Visio_Perf_ILT=s.appCompletedTime-i.hostInitDiagnostics?.hostInitializeCallTime)}function Ke(t){return t.appContext.fastViewInfo}function Xe(t,i){const e=t.appContext;return!(!t.contentBundle||!t.contentBundle.url)&&(!!t.container&&(!(t.wdParams?.wdPBIView||t.appUrl.indexOf("wdPBIView")>=0)&&(!window.matchMedia("screen and (-ms-high-contrast: active)").matches&&(e.appMode===gi.VIEW||!(e.appMode!==gi.EMBED_VIEW&&e.appMode!==gi.INTERACTIVE_PREVIEW||!bi.getBRSValue(bi.hostCacheForEmbedViewEnabledBRSKey))||e.appMode===gi.EDIT&&!Ai(t.appUrl)&&(!Ci(t.appUrl)||i)))))}function Ze(i,s=!1){const o=i.appContext.fastViewPostMessageToWacFrameState,n=Ke(i);if(o.jsapiAlreadySentFastViewDataToWacFrame||!o.appFrameReadyToReceiveFastViewData)return;if(o.appFrameReadyToReceiveFastViewData&&s){const s={[fi.FastViewImage]:void 0,[fi.FastViewJson]:void 0};return i.container&&i.container.postMessage(yt.ur,s),o.jsapiAlreadySentFastViewDataToWacFrame=!0,void i.logger.ULS.Ci(523368192,t.k,e.Info,"[sendFastViewDataToVisioAppFrame] force sending empty postmessage for fastview data after 5 sec wait time.")}if(o.appFrameReadyToReceiveFastViewData&&!o.jsapiReadyToSendFastViewDataToWacFrame)return i.logger.ULS.Ci(523368193,t.k,e.Info,"[sendFastViewDataToVisioAppFrame] wac appframe is waiting for fastview data. jsapi is not yet ready to send it. Setting up 5 sec timer to revert if not done automatically. "),void setTimeout((()=>Ze(i,!0)),5e3);const r=n.fastviewContentLoadedFromLocalcache?n.fastViewImageDataFromCache:Ri(n.imageElement,n.defaultImageWidth,n.defaultImageHeight);let a=n.docViewResponseText,h={[fi.FastViewImage]:r,[fi.FastViewJson]:a};i.container&&i.container.postMessage(yt.ur,h),o.jsapiAlreadySentFastViewDataToWacFrame=!0,i.logger.ULS.Ci(523368194,t.k,e.Info,"[sendFastViewDataToVisioAppFrame] Sent fastview data to wac appframe. ")}function Ye(t){const i=t.appContext,e={},s={};let o=f(window.location.href,"teamsvisiomode");!i.wasDefaultedtoEdit&&t.host&&t.host.metaUiHostVersion&&!o&&t.rebootOverride?.mode&&(o=t.rebootOverride.mode),o&&t.appUrl.indexOf("embed=1")<0&&(o.toLocaleLowerCase()===Gt&&i.appMode!==gi.EDIT&&(m(e,Ht,Jt),m(e,ei,"1"),i.appMode=gi.EDIT),o.toLocaleLowerCase()===jt&&i.appMode!==gi.VIEW&&(m(e,Ht,Lt),i.appMode=gi.VIEW));const n=t.host.uiHostName;if(n&&"teams"===n.toLowerCase()&&m(e,ii,"true"),m(e,"pmOrigin",encodeURIComponent(u(window.location.href))),t.hostName&&m(e,"filesrc",encodeURIComponent(t.hostName)),i.appMode!==gi.EDIT_NEW||t.wopi||m(e,"instantedit","1"),w(e,"sams"),bi.getBRSValue(bi.IsAtMentionsEnabled)){const e=f(window.location.href,"nav");e&&i.appMode===gi.VIEW&&m(s,"nav",decodeURIComponent(e)),t.host.capabilities&&t.host.capabilities.atMentions&&m(s,"sams","1")}let r;return t.contentBundle?.url&&(m(s,"bsdpm","true"),m(s,"dpmdv","true")),t.hostInitDiagnostics&&(r=t.hostInitDiagnostics.userClickTime,r||(r=t.hostInitDiagnostics.hostInitializeCallTime)),r||(r=(new Date).getTime()),m(s,"dct",r.toString()),m(s,"wde",i.wasDefaultedtoEdit.toString()),m(s,"highdpi",String(window.devicePixelRatio>1.25)),Xe(t,!1)?m(e,"fastPreview","true"):m(e,"fastPreview","false"),Ci(t.appUrl)&&w(e,"newsession"),{appPageName:"visioframe.aspx",queryParamsOverrides:e,postDataOverrides:s}}var Qe;function ts(t,i){const e=Ke(t);if(!i)return;if(e.fastviewSavedToBrowserCache)return;const s=parseInt(i[Mi.maxStorageQuotaSettingName].toString(),10),o=parseInt(i[Mi.minEvictTimePeriodSettingName].toString(),10);if(window.setTimeout((()=>Mi.EvictStaleCache(1024*s*1024,24*o*60*60*1e3,t.logger)),Mi.cacheEvictIdleTimeInMs),!e.fastviewShownFromHostCache)return;const n=e.fastviewContentLoadedFromLocalcache?e.fastViewImageDataFromCache:Ri(e.imageElement,e.defaultImageWidth,e.defaultImageHeight);n&&(window.setTimeout((()=>t.appContext.fastViewBrowserCache?.SaveDocument(e.docViewResponseText,n)),Mi.documentSaveIdleTimeInMs),e.fastviewSavedToBrowserCache=!0)}function is(t,i,e,s,o,n,r=0){r>=pi&&o(`[workWithRetry] max recursion depth of ${pi} reached. Stopping retry and failing`),i()||(e()?(s(),t(),setTimeout((()=>is(t,i,e,s,o,n,r+1)),n())):o("[workWithRetry] max retries configured reached. Stopping retry and failing"))}function es(i,s){i.bootHeartBeat?.restart();let o=0;i.container?.setVisibility(!1),is((()=>{i.container&&i.container.postMessage(yt.dr,s)}),(()=>i.appContext.modeSwitchAckReceived),(()=>o<li),(()=>{o++}),(s=>{i.logger.ULS.Ci(522840264,t.k,e.Info,`[handleBootBackgroundClient] ${s}. Falling back to legacy switch`);const o=i.appContext.activeSession;o&&o.run(Qe.cu,void 0)}),(()=>ui))}function ss(i){!function(i){i.addActionHandler(it.io,((t,e)=>{bi.handleVisioBRS(e,i.logger)})),i.addActionHandler(it.eo,((t,i)=>{!function(t){if(t&&t.License){const i=bi.getBRSValue(bi.DTEEnabledForPlan0BRSKey);"plan1"===t.License||i&&"plan0"===t.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false")}}(i)})),i.addActionHandler(it.ao,((t,e)=>{i.appContext.appFramePageViewLoaded=!0;const s=i.appInitDiagnostics;e&&e.Diagnostics&&Object.keys(e.Diagnostics).forEach((t=>s[t]=e.Diagnostics[t]))})),i.addActionHandler(it.ho,(s=>{!function(i){let s=window.location.href;s=g(s,Bt,i.sessionId,!0);const o=i.sessionId;let n=1;i.wdParams?.[$t]&&(n=parseInt(i.wdParams[$t],10)+1),n>bi.getIntegerBRSValue(bi.ReloadOnScriptFailMaxLimitBRSKey,3)?i.logger.ULS.Ci(523531988,t.H,e.Error,"Visio Boot failed for WACSessionID: "+o+" after"+n+"retries"):(s=g(s,$t,String(n),!0),i.logger.ULS.Ci(523531989,t.H,e.Warning,"Refreshing VisioFrame for WACSessionID: "+o+", currentReloadCount: "+n+", UriLen: "+s.length),i.logger.ULS.flush(),window.location.href=s)}(i)})),bi.getBRSValue(bi.CoCommentingAcrossViewAndEditEnabled)&&i.addActionHandler(it.ns,((t,e)=>{!function(t,i){t.appContext.commentContext=i}(i,e)})),i.addActionHandler(it.lo,((s,o)=>{!function(i,s){let o=window.location.href;"VIEW"===s.toMode||"EDIT"===s.toMode?(o=g(o,"teamsvisiomode",s.toMode,!0),bi.getBRSValue(bi.IsFormulaeSerializationRollbackEnabled)&&i.appContext.appMode===gi.EDIT&&"1"===s.wdDisableFormulae&&(o=g(o,"wdDisableFormulae","1",!0)),window.location.href=o):i.logger.ULS.Ci(593622414,t.H,e.Warning,"Invalid options received in Visio_DocReboot_HostNav message")}(i,o)})),i.addActionHandler(it.uo,((t,e)=>{!function(t,i){je(t),ts(t,i.Settings)}(i,e)})),i.addActionHandler(it.do,(t=>{i.appContext.fastViewPostMessageToWacFrameState.appFrameReadyToReceiveFastViewData=!0,Ze(i)}))}(i),i.appContext.appMode===gi.VIEW?function(i){i.addActionHandler(it.oo,((s,o)=>{!function(i,s){i.logger.ULS.Ci(526455301,t.k,e.Info,"[handleModeSwitchFromViewerFrame] Received switch mode post message from frame with App mode : "+i.appContext?.appMode.toString()),i.container&&i.container.postMessage(yt.cr,void 0),i.backgroundSession?(i.backgroundSession.run(Qe.du,void 0),i.backgroundSession.run(Qe.lu,s)):i.container&&i.container.postMessage(yt.lr,void 0)}(i,o)})),i.addActionHandler(it.so,(s=>{!function(i){i.logger.ULS.Ci(526455300,t.k,e.Info,"[handleViewModeCLT] View mode CLT complete message received"),i.container&&i.container.postMessage(yt.hr,void 0),function(t){return!!bi.getBRSValue(bi.backgroundEditSessionEnabledKey)&&(!t.host.metaUiHostVersion||bi.getBRSValue(bi.IsTeamsBackgroundFrameFixEnabled))}(i)&&function(i){const s=i.appContext;if(s.appMode!==gi.VIEW)throw new TypeError("Booting up background editor in non viewer session");if(!s.sessionBootParams)return;const o={...s.sessionBootParams};let n=o.appUrl;if(void 0===n)throw new TypeError("applicationUrl is empty");if("consumptionview"!==f(n.toLowerCase(),"visioview"))throw new TypeError("applicationUrl does not have VisioView=ConsumptionView query param");n=g(n,"VisioView","EditView",!0),n=g(n,si,"1",!0),o.appUrl=g(n,ei,"1",!0);const[r]=y();o.hostGeneratedSessionId=r,o.preseededSession=void 0,i.logger.ULS.Ci(521176415,t.k,e.Info,`[createBackgroudEditorSession] edit session associated: ${r}`),o.rebootOverride=void 0,i.backgroundSession=i.application.createSession({hostSessionId:i.hostSessionId}),i.backgroundSession.boot(o),i.backgroundSession.run(Qe.uu,i.session)}(i)}(i)})),i.addActionHandler(Qe.cu,(t=>{i.container&&i.container.postMessage(yt.lr,void 0)})),i.addActionHandler(it.co,(s=>{!function(i){i.backgroundSession?i.backgroundSession.dispose():i.logger.ULS.Ci(523531987,t.H,e.Warning,"handleVisioViewDisposeBkgFrame backgroundEditApp is null")}(i)}))}(i):function(i){i.addActionHandler(Qe.lu,((t,e)=>{es(i,e)})),i.addActionHandler(Qe.uu,((t,e)=>{i.appContext.activeSession=e})),i.addActionHandler(it.no,((s,o)=>{!function(i,s){if(i.logger.ULS.Ci(526455302,t.k,e.Info,"[handleModeSwitchAckFromEditor] Received mode switch ack from Editor"+s),i.appContext.modeSwitchAckReceived=!0,!s?.IsSuccess){const t=i.appContext.activeSession;return void(t&&t.run(Qe.cu,void 0))}const o=i.appContext;o?.activeSession?.run(Ft.dispose,{notDisposeBackgroundSession:!0},void 0),De(i.logger,Si.JSAPIV2),Oe(i.logger,vi.BOOTSTART),i.raiseEvent(ce.FrameChanged,i.container?.frameId)}(i,o)})),i.addActionHandler(Qe.du,(t=>{i.diagnostics.appInitDiagnostics&&(i.diagnostics.appInitDiagnostics.modeSwitchClickTime=M()),He(i,!0)})),i.addActionHandler(it.ro,((t,e)=>{!function(t,i){const e=t.appContext;if(Ai(t.appUrl))return;let s="";i&&i.RefreshOrigin&&(s=i.RefreshOrigin);let o=window.location.href;bi.getBRSValue(bi.IsToastUserFixEnabledBRSKey)&&o&&(o=S(o,qt)),bi.getBRSValue(bi.IsContextAppRefreshFixEnabledBRSKey)&&o&&(o=S(o,Xt),o=S(o,Yt),o=S(o,Qt),o=S(o,ti)),e.appMode!==gi.EDIT&&e.appMode!==gi.EDIT_NEW||(o&&(o=g(o,zt,Gt,!0),s&&(o=g(o,"OR",s,!0)),e.appMode===gi.EDIT_NEW&&(o=g(o,"wdNewAndOpenCt","0",!0))),yi(o))}(i,e)}))}(i)}function os(t){He(t),ss(t)}function ns(t){return{permissionsPolicy:(i=t.appBaseUrl,`microphone ${i}; autoplay ${i}; camera ${i}; clipboard-read ${i}; clipboard-write ${i}; keyboard-map ${i}; display-capture ${i}; local-network-access ${i}`),isInvisible:t.appUrl.indexOf("backgroundsession")>-1,enforceSameWindow:!0};var i}function rs(i,s){i.appContext.appMode===gi.VIEW&&bi.getBRSValue(bi.CoCommentingAcrossViewAndEditEnabled)&&function(i){i.logger.ULS.Ci(523352026,t.k,e.Info,"Sending comment context message to frame"),void 0!==i.appContext.commentContext&&(i.container&&i.container.postMessage(yt.Jn,i.appContext.commentContext),i.appContext.commentContext=void 0)}(i),je(i),ts(i,s.Settings),ze(i),qe(i),Oe(i.logger,vi.BOOTSUCCESS)}function as(t){je(t),ze(t),qe(t),Oe(t.logger,vi.BOOTFAILED)}function hs(t,i){Oe(t.logger,vi.BOOTEXCEPTION)}function cs(t){Oe(t.logger,vi.BOOTTIMEOUT)}function ds(t){Ci(t.appUrl)&&t.bootHeartBeat?.stop()}function ls(){return Nt}function us(t,i){if(bi.getBRSValue(bi.instantCreateNewLocalStorageKey)){if(i.bootParams?.isNewFile)return!!i.wdParams?.wdTpl&&!bi.getBRSValue(bi.InstantForAllTemplatesEnabledBRSKey);if(-1!==i.appUrl?.indexOf("wdasp"))return!bi.getBRSValue(bi.InstantForAllTemplatesEnabledBRSKey)}return!0}function ps(t,i){Le(t);const e=t.appContext;e.sessionBootParams=void 0,e.appFramePageViewLoaded=!1,e.modeSwitchAckReceived=!1,Mi.dispose(),e.fastViewInfo={fastViewContainer:void 0,fishBowlElement:void 0,imageElement:void 0,pageElement:void 0,docViewLoaded:!1,imageLoaded:!1,docViewResponseText:void 0,fastViewcontainerVisible:!1,fastviewShownFromHostCache:!1,fastViewPLTTime:void 0,defaultImageWidth:void 0,defaultImageHeight:void 0,fastviewContentLoadedFromLocalcache:!1,fastViewImageDataFromCache:void 0,fastViewCacheHit:!1,noChromeMode:!1,noChromeWithToolbar:!1,fastviewSavedToBrowserCache:!1},bi.dispose(),i?.notDisposeBackgroundSession||t.backgroundSession?.dispose()}!function(t){t.lu="Visio_BootBackgroundClientApp",t.uu="Visio_SaveActiveSessionReference",t.du="Visio_ShowFastViewInBackgroundSession",t.cu="Visio_RelayFallBackToLegacySwitchToActiveSession"}(Qe||(Qe={}));const ms=()=>[{[he.appReboot]:fe,[he.boot]:Ce,[he.closeTab]:Ae,[he.createNew]:Ee,[he.dispose]:Pe,[he.frameTrust]:Re,[he.getAuthToken]:xe,[he.getHostKeyValue]:Ae,[he.handleBootState]:We,[he.postWacToken]:Ue,[he.rename]:Ae,[he.setOverlayContent]:$i,[he.setWacFlightValue]:Me,[he.storeHostKeyValue]:Ae,[he.switchMode]:Ae,[he.updateBootComplete]:Ae},{[he.boot]:{initializeAppContext:Be,buildAppBasePath:$e,buildRemoteTelemetryUrl:Ne,buildBootRequestParams:Ye,beforeContainerBoot:os,buildContainerBootParams:ns,onSuccess:rs,onFailure:as,onException:hs,onTimeout:cs,beforeBootCompletionMessage:ds,overrideBootTimeout:ls},[he.dispose]:{disposeAppSpecificResources:ps},[he.createNew]:{fallBackToSingleStepBootFlow:us}}];var ws;!function(t){t[t.NotSupported=0]="NotSupported",t[t.SameDocOnly=1]="SameDocOnly",t[t.AnyDoc=2]="AnyDoc",t[t.OtherMode=4]="OtherMode"}(ws||(ws={}));const fs=new class{GetVersion(){return A()}GetMinContentVersion(){return ee.GetMinContentVersion()}Prefetch(t){}InitializeWopiPending(i){let s,o,n=gi.INVALID;try{let[r,h]=y();if(x(At(i.ApplicationUrl,r),Tt,"init"),bi.getBRSValue(bi.AppShellPrebootEnabledBRSKey)&&this.pu)return void 0!==this.mu&&void 0!==i.NewFileTemplateSource&&void 0!==i.NewFileTemplateSource.DocUniqueId&&this.mu.updateCreateNewTemplateInfo(i.NewFileTemplateSource.DocUniqueId),this.pu=!1,this.mu;i.ApplicationUrl.indexOf("wdasp=1")>=0&&(this.pu=!0),function(t){if(void 0===t)throw new TypeError("initParams");const i=t.Container;if(void 0===i||void 0===i.appendChild)throw new TypeError("Container");const e=t.SessionInformation;if(void 0===e||void 0===e.HostName||void 0===e.HostSessionId||void 0===e.UserId)throw new TypeError("SessionInformation");const s=t.ApplicationUrl;if(void 0===s||"string"!=typeof s)throw new TypeError("ApplicationUrl");const o=t.WopiPrecheckInfo;if(void 0===o||void 0===o.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===t.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===t.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(i);const l=f(window.location.href,Bt),p=f(window.location.href,$t);l&&p&&(r=l),s=N({remoteUlsEndpoint:Et(i.ApplicationUrl)+a,sessionId:r,uploadCadenceInMs:re});const m=c(i.ApplicationUrl)?Qi.Fastfood:d(i.ApplicationUrl)?Qi.MSIT:Qi.Production;bi.initialize(m,s);const w=function(t,i,e,s,o,n=!1){t.SessionInformation.IsCore&&(t.SessionInformation.HideViewerToolbar=!0),function(t,i){const e=t.SessionInformation;if(e.WdParams||(e.WdParams={}),e.WdParams.wd)return;i.substring(1).split("&").filter((t=>{if(0===t.indexOf("wd")){const i=t.split("=");i[0].length>2&&(e.WdParams[i[0]]=i[1])}}));const s=t.RebootOverrideData;s&&s.previousSessionId&&(e.WdParams.wdprevioussession=s.previousSessionId),_t.Instance.getBooleanSetting("OneNoteHostSessionOriginFixEnabled")}(t,window.location.search);const r=o||new mt(Tt,e),a=Et(t.ApplicationUrl),h={container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:{HostInitDiagnostics:t.Diagnostics,ClientDiagnostics:Q(),AppInitDiagnostics:{officeSessionId:i,officeBootstrapperVersion:A(),hostName:t.SessionInformation.HostName},SessionTraces:{}},fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:i,applicationBasePath:a,remoteTelemetryUrl:Ct(a,i),wopiInfo:t.WopiInfo,forceSingleStepBoot:n,isCreateNew:t.WopiPrecheckInfo.IsNewFile||b(t.ApplicationUrl,"new"),featureManager:s||ft(t.FnIsFeatureEnabled,e),Ai:r,newFileTemplateSource:t.NewFileTemplateSource,rebootOverrideData:t.RebootOverrideData,pageStateObserver:new vt(e,!0)};return h.fnOnAppModeSwitched=t.FnOnAppModeSwitched,h}(i,r,s);let S=!1;this.wu=bi.getBRSValue(bi.DTEEnabledBRSKey),bi.getBRSValue(bi.IsTeamsBackgroundFrameFixEnabled)?this.fu=bi.getBRSValue(bi.backgroundEditSessionEnabledKey):this.fu=!i.SessionInformation.MetaUiHostVersion&&bi.getBRSValue(bi.backgroundEditSessionEnabledKey),i.SessionInformation.MetaUiHostVersion&&(this.mr={}),this.gu(s,w),bi.getBRSValue(bi.JsapiV1DiagnosticFixEnabled)&&w.diagnostics.HostInitDiagnostics&&(w.diagnostics.HostInitDiagnostics.hostInitializeCallTime=M(),void 0===w.diagnostics.HostInitDiagnostics.hostPageRedirectCount&&(w.diagnostics.HostInitDiagnostics.hostPageRedirectCount=Wi())),s.ULS.Ci(596457679,t.H,e.Info,`Bootstrapper Init Time: ${M()}`),s.ULS.Ci(595937312,t.H,e.Info,JSON.stringify(h));const I=function(t,i){const e={...i};delete e.UserId,delete e.OwnerId,delete e.SiteId,delete e.WebId,delete e.Upn,delete e.TenantId,delete e.UiHostTabId,delete e.OriginalWdParam,delete e.WdParams;const s=e,o=i.WdParams?JSON.parse(JSON.stringify(i.WdParams).toLowerCase()):{};s.WdParams={},["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach((t=>{o[t]&&(s.WdParams[t]=o[t])}));const n=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;return s.WdParams.wdprevioussession&&!n.test(s.WdParams.wdprevioussession)&&delete s.WdParams.wdprevioussession,s.WdParams.wdpreviouscorrelation&&!n.test(s.WdParams.wdpreviouscorrelation)&&delete s.WdParams.wdpreviouscorrelation,s.UiEmbedMode=b(t,"uiembed"),s.UiHostName=f(t,"uih")||"N/A",s.HostDomain=location?location.hostname:"",s}(w.applicationUrl,w.sessionInformation);s.ULS.Ci(596457680,t.H,e.Info,JSON.stringify({hostSessionInformation:I,clientSignals:Q()})),s.ULS.Ci(596457681,t.H,e.Info,JSON.stringify({hostInitDiagnostics:w.diagnostics.HostInitDiagnostics?w.diagnostics.HostInitDiagnostics:"N/A"}));const _=u(i.ApplicationUrl),T=new Dt(_,s);T.activate(),T.registerMessagePayloadHandler(bi.fromWacVisioFrameBRS,(t=>{bi.handleVisioBRS(t,s)})),T.registerMessagePayloadHandler(it.eo,(t=>{this.vu(t)})),w.applicationUrl.indexOf("VisioView=ConsumptionView&embed=1")>=0?n=gi.EMBED_VIEW:w.applicationUrl.indexOf("VisioView=ConsumptionView&InteractivePreview=1")>=0?n=gi.INTERACTIVE_PREVIEW:w.applicationUrl.indexOf("VisioView=ConsumptionView")>=0?n=gi.VIEW:w.applicationUrl.indexOf("VisioView=EditView&New=1")>=0?n=gi.EDIT_NEW:w.applicationUrl.indexOf("VisioView=EditView")>=0?n=gi.EDIT:(n=gi.INVALID,s.ULS.Ci(596132872,t.H,e.Error,"Invalid Visio Frame Url")),bi.getBRSValue(bi.AppShellPrebootEnabledBRSKey)&&w.applicationUrl.indexOf("wdasp=1")>=0&&(n=gi.EDIT_NEW,w.applicationUrl=g(w.applicationUrl,Ht,Jt,!0),w.applicationUrl=g(w.applicationUrl,"New","1",!1));let C=v(window.location.href).teamsvisiomode;w.sessionInformation.MetaUiHostVersion&&!C&&w.rebootOverrideData&&w.rebootOverrideData.mode&&(C=w.rebootOverrideData.mode),C&&w.applicationUrl.indexOf("embed=1")<0&&(C.toLocaleLowerCase()===Gt&&n!==gi.EDIT&&(w.applicationUrl=g(w.applicationUrl,Ht,Jt,!0),w.applicationUrl=g(w.applicationUrl,ei,"1",!0),n=gi.EDIT),C.toLocaleLowerCase()===jt&&n!==gi.VIEW&&(w.applicationUrl=g(w.applicationUrl,Ht,Lt,!0),n=gi.VIEW));const E=f(w.applicationUrl,"uih"),F=E&&"teams"===E.toLowerCase();if(this.wu){const t=f(window.location.href,"action");let e=!1;if(F){const t=v(window.location.href).teamsvisiomode;e=n===gi.VIEW&&!t}const s=Ai(w.applicationUrl)||Ei(w.applicationUrl);let o=!1;bi.getBRSValue(bi.DTESafariFixEnabledBRSKey)&&J()===$.Safari&&(o=!0),o||"default"!==t&&!e&&(!bi.getBRSValue(bi.DTESharingFixEnabledBRSKey)||i.WopiPrecheckInfo.ReadOnly||s||F||0!==t.length)||"true"===localStorage.getItem("enableDTE")&&(w.applicationUrl=g(w.applicationUrl,"VisioView","EditView",!0),n=gi.EDIT,S=!0)}if(F&&(s.ULS.Ci(545813153,t.H,e.Info,"Show Visio viewer react toolbar in Teams"),w.applicationUrl=g(w.applicationUrl,ii,"true")),bi.getBRSValue(bi.TypeScriptLocalStorageEnabled)){const t=localStorage.getItem("UseTypeScriptJS");t&&(w.applicationUrl=g(w.applicationUrl,"wdVisioTS",t))}w.applicationUrl=this.Su(w.applicationUrl);const V=new oe;if(void 0!==i.BootstrapperUrl?o=new se(i.BootstrapperUrl,i.BootstrapperUrl):s.ULS.Ci(596457563,t.H,e.Warning,"Could not determine visio resources URL"),Ui(),this.fu&&n===gi.VIEW){const i=new ne(w,s,V,o,n,T,this.mr);return s.ULS.Ci(595682587,t.H,e.Info,`Building VisioApplication in appMode ${n}`),this.mu=i.buildApplication(),this.mu}return s.ULS.Ci(595682588,t.H,e.Info,`BRS isUnifiedBackgroundAppBRSEnabled: ${this.fu}, appMode: ${n}`),void 0!==i.BootstrapperUrl&&this.Preconnect(i.BootstrapperUrl),this.mu=new ee(w,s,V,o,n,this.mr,T,void 0,Yi.Active,S),this.mu.addTimerTagForBoot(Nt),this.mu.Boot(),this.mu}catch(o){return s&&(s.ULS.Ci(596464067,t.H,e.Error,`${ct.AppInitError}: ${F(o)}`),s.ULS.flushOnClose()),void(i&&(i.ApplicationUrl&&x(At(i.ApplicationUrl,void 0),Tt,"bootException"),i.FnOnInitializeFailure&&i.FnOnInitializeFailure({errorType:ct.AppInitError,errorObject:o})))}}Preconnect(t){const i=st();i.shouldPreconnect()&&i.preconnect(t)}constructor(){this.mr={},this.pu=!1,this.gu=(i,s)=>{!function(t){return!(!Vi(t,Bt)||!Vi(t,$t))}(s)?i.ULS.Ci(596464066,t.H,e.Info,"VisioBootstrapper - initializing session. Build version: "+this.GetVersion()):i.ULS.Ci(590357217,t.H,e.Info,"VisioBootstrapper - Initializing reloaded session.  current Reload count: "+Pi(s,$t)+" Build version: "+this.GetVersion())},this.vu=t=>{if(t&&t.License){const i=bi.getBRSValue(bi.DTEEnabledForPlan0BRSKey);"plan1"===t.License||i&&"plan0"===t.License?localStorage.setItem("enableDTE","true"):localStorage.setItem("enableDTE","false")}},this.Su=t=>g(g(t,"jsApi","1"),"jsapiver","v1")}},gs=t=>new we(t,{name:"Visio"},ms);((Microsoft=void 0===Microsoft?{}:Microsoft).Office=Microsoft.Office||{}).Visio=n}();
//# sourceMappingURL=visio.boot.94013db2ba884a9677ef.js.map